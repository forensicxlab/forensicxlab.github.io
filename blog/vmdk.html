<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">ðŸ”¦ A quick walkthrough in the VMDK format | Forensicxlab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://forensicxlab.github.io/blog/vmdk"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="ðŸ”¦ A quick walkthrough in the VMDK format | Forensicxlab"><meta data-rh="true" name="description" content="After attending a conference for incident response teams, I joined a project aiming to create a forensic framework allowing acquisition and visualization of evidence from various sources: the Exhume toolkit."><meta data-rh="true" property="og:description" content="After attending a conference for incident response teams, I joined a project aiming to create a forensic framework allowing acquisition and visualization of evidence from various sources: the Exhume toolkit."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-06-14T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/MickaelWalter/"><meta data-rh="true" property="article:tag" content="VMDK,Exhume,Digital Forensics"><link data-rh="true" rel="canonical" href="https://forensicxlab.github.io/blog/vmdk"><link data-rh="true" rel="alternate" href="https://forensicxlab.github.io/blog/vmdk" hreflang="en"><link data-rh="true" rel="alternate" href="https://forensicxlab.github.io/blog/vmdk" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://forensicxlab.github.io/blog/vmdk","mainEntityOfPage":"https://forensicxlab.github.io/blog/vmdk","url":"https://forensicxlab.github.io/blog/vmdk","headline":"ðŸ”¦ A quick walkthrough in the VMDK format","name":"ðŸ”¦ A quick walkthrough in the VMDK format","description":"After attending a conference for incident response teams, I joined a project aiming to create a forensic framework allowing acquisition and visualization of evidence from various sources: the Exhume toolkit.","datePublished":"2025-06-14T00:00:00.000Z","author":{"@type":"Person","name":"mickaelwalter","description":"Infosec and technology enthousiast","url":"https://github.com/MickaelWalter/","image":"https://www.mickaelwalter.fr/content/images/2020/05/hackerman-profile.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://forensicxlab.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Forensicxlab RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Forensicxlab Atom Feed"><link rel="stylesheet" href="/assets/css/styles.98b055e0.css">
<script src="/assets/js/runtime~main.17c45b30.js" defer="defer"></script>
<script src="/assets/js/main.0493f421.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="https://www.mickaelwalter.fr/content/images/2020/05/hackerman-profile.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="ForensicXlab Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="ForensicXlab Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/thanatology">Thanatology</a><a class="navbar__item navbar__link" href="/docs/exhume">Exhume</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://github.com/forensicxlab" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://discord.gg/AqkYgR5HEg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/volweb-3-15">ðŸ“¦ VolWeb v3.15 July 2025 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology-3">ðŸ¦‰ Thanatology part 3: MBR and GPT forensics with the Exhume ToolKit.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology-2">ðŸ¦‰ Thanatology part 2: Multiple disk images formats handling using the Exhume ToolKit</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/vmdk">ðŸ”¦ A quick walkthrough in the VMDK format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology">ðŸ¦‰ Thanatology Part 1 - Introducing the Thanatology project</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/voliat">ðŸ“¦ Volatility3 : Import Address Table</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/volads">ðŸ“¦ Volatility3 : Alternate Data Stream Scan</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hibernation">ðŸ“˜ Volatility3: Modern Windows Hibernation file analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vols3">ðŸ“˜ Volatility3 - Remote analysis on cloud object-storage.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/steam">ðŸ”¦ Video Games Forensics - Steam</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keepass">ðŸ“¦ Volatility3 Windows Plugin - KeePass</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ewf">ðŸ”¦ Debunking the Expert Witness Compression Format (EWF)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vision">ðŸ§¬ Malware Analysis with VISION-ProcMon</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/anydesk">ðŸ“¦ Volatility3 Windows Plugin - AnyDesk</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/inodes">ðŸ“¦ Volatility3 Linux Plugin - Inodes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/prefetch">ðŸ“¦ Volatility3 Windows Plugin - Prefetch</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/cb-brave">ðŸ–‹ Cyberdefenders - Writeup - Brave</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/volaslib">ðŸ“˜ Using Volatility3 as a library</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/macisf">ðŸ“„ Volatility3 - ISF for MacOs</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">ðŸ”¦ A quick walkthrough in the VMDK format</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-06-14T00:00:00.000Z">June 14, 2025</time> Â· <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/mickaelwalter"><img class="avatar__photo authorImage_XqGP" src="https://www.mickaelwalter.fr/content/images/2020/05/hackerman-profile.png" alt="mickaelwalter"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/mickaelwalter"><span class="authorName_yefp">mickaelwalter</span></a></div><small class="authorTitle_nd0D" title="Infosec and technology enthousiast">Infosec and technology enthousiast</small><div class="authorSocials_rSDt"><a href="https://x.com/mickaelwalter" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/MickaelWalter" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://bsky.app/profile/mickaelwalter.bsky.social" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 226" class="authorSocialLink_owbf"><path fill="#1185FE" d="M55.491 15.172c29.35 22.035 60.917 66.712 72.509 90.686 11.592-23.974 43.159-68.651 72.509-90.686C221.686-.727 256-13.028 256 26.116c0 7.818-4.482 65.674-7.111 75.068-9.138 32.654-42.436 40.983-72.057 35.942 51.775 8.812 64.946 38 36.501 67.187-54.021 55.433-77.644-13.908-83.696-31.676-1.11-3.257-1.63-4.78-1.637-3.485-.008-1.296-.527.228-1.637 3.485-6.052 17.768-29.675 87.11-83.696 31.676-28.445-29.187-15.274-58.375 36.5-67.187-29.62 5.041-62.918-3.288-72.056-35.942C4.482 91.79 0 33.934 0 26.116 0-13.028 34.314-.727 55.491 15.172Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>After attending a conference for incident response teams, I joined a project aiming to create a forensic framework allowing acquisition and visualization of evidence from various sources: the Exhume toolkit.</p>
<p><a href="https://www.forensicxlab.com/docs/exhume" target="_blank" rel="noopener noreferrer">The Exhume Toolkit v0.1</a></p>
<p>In this quest of retrieving data from various base formats, I got involved in the understanding and implementation of a parser for the VMDK format.</p>
<p>The Virtual Machine Disk format has been created by VMware and is used by all kinds of virtual machines from all types of hypervisors. It is also used in exchange formats used to share virtual machines from one hypervisor to another.</p>
<p>Most IT experts, from cybersecurity to system administrators have heard of VMDK files. And I am no exception. But I never really understood what was behind this format. Sure, I did encounter some difficulties to access data from a VMDK file sourced from and ESXi server but I always found tools allowing to convert the file to a better suited format... Including VMDK itself.</p>
<p>At that moment I wondered why converting a VMDK file to another one could help me get access to the data for forensic purposes. And I&#x27;ve found the answer now I did some serious research on the matter.</p>
<p>The VMDK is not one file format by itself but rather a collection of formats depending on the configuration set up for the virtual machine. Many parameters can have an impact on the way the virtual machine data will be stored:</p>
<ul>
<li>Whether the disk is thin provisioned or not</li>
<li>Whether the disk image is stored in a file, a full hardware disk or a partitioned disk</li>
<li>Whether the disk is divided in several files or not</li>
<li>Whether the data is compressed or not</li>
<li>Whether the file represents a snapshot or a full disk</li>
</ul>
<p>At the beginning, there is one thing in common for all formats: the descriptor file.</p>
<p>The descriptor file bears its name well and contains the metadata about a VMDK disk allowing to read and write data to the virtual disk.</p>
<p>It is a text description, usually in a separate text file, of various parameters related to the disk itself: disk ID, adapter type, but most importantly a list of references to what is described as extents.</p>
<p>Extents are the actual files, disks or partitions containing the data on the virtual disk. They can be of various forms determined by a parameter specified on each line.</p>
<p><img decoding="async" loading="lazy" src="https://www.mickaelwalter.fr/content/images/2025/06/image-2.png" alt="" class="img_ev3q"></p>
<p>Typical scenario of a descriptor file and its associated extents</p>
<p>A descriptor file can look like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Disk DescriptorFile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    version=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    encoding=&quot;UTF-8&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    CID=fffffffe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    parentCID=ffffffff</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createType=&quot;twoGbMaxExtentFlat&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # Extent description</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    RW 2097152 FLAT &quot;Disque virtuel 2-f001.vmdk&quot; 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # The Disk Data Base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #DDB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.adapterType = &quot;lsilogic&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.geometry.cylinders = &quot;512&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.geometry.heads = &quot;128&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.geometry.sectors = &quot;32&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.longContentID = &quot;d0f5e5f69fcd0241f710a9dcfffffffe&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.uuid = &quot;60 00 C2 96 41 d4 0c 4b-bc 3a 43 31 4c d0 b4 09&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ddb.virtualHWVersion = &quot;21&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The descriptor file above specifies a disk of type <code>2GbMaxExtentFlat</code>. This means that the disk is built around extent files of maximum 2GB that contain the actual data in a flat manner (the disk data is stored in a raw form). The extent description section will notably describe the number of sectors of 512 bytes for each extent and the start sector of the extent (here 2 097 152 sectors starting at sector 0).</p>
<p>So, we have a type for the disk as a whole and a type for each extent individually. It starts with a mess for newcomers, isn&#x27;t it?</p>
<p>I won&#x27;t dive in details on disk types. Mostly they will give a bit more details on the reasons extents are segmented in a certain way (in a single file or not, full disk, partition, etc.).</p>
<p>What interests me the most today is the way data is stored in the extents. Extents can also be one of several types:</p>
<ul>
<li>Flat : the data is stored as is in the file</li>
<li>Sparse : the data is stored in &quot;grains&quot; allowing to allocate only what&#x27;s necessary</li>
<li>Zero : there is no data, just zeros (in this case, no extent path is specified)</li>
<li>VMFS : somewhat similar to flat but on ESXi servers</li>
<li>VMFSSparse : a sparse variant for ESXi servers</li>
<li>And others I won&#x27;t dive in today</li>
</ul>
<p>The VMDK descriptor is usually in the <code>&lt;name&gt;.vmdk</code> file. Extents can be in other files such as <code>&lt;name&gt;-flat.vmdk</code>, <code>&lt;name&gt;-f001.vmdk</code>, or <code>&lt;name&gt;-s001.vmdk</code>.</p>
<p>Let&#x27;s dive in the different extent types.</p>
<h1>Flat, VMFS and Zero</h1>
<p>Flat and VMFS extent types are basically the same type. They store raw data in the extent. That is, if you read data at byte 0 of the first extent, you will read the first byte of the virtual disk itself.</p>
<p>There can be some hiccups when the disk is segmented in several files in terms of how offsets must be handled (because the file is not starting at sector 0) but that&#x27;s it.</p>
<p><img decoding="async" loading="lazy" src="https://www.mickaelwalter.fr/content/images/2025/06/image-3.png" alt="" class="img_ev3q"></p>
<p>In the case of flat extents, data is stored sequentially and can be accessed by determining which sector must be retrieved. Knowing the sector number allows to determine the proper extent file and the proper offset inside the file itself</p>
<p>Flat and VMFS files cannot be thin provisioned and the combined size of such extents will be exactly the capacity of the disk with zeros located in places that have not been written yet. There is no header, no metadata including in the extents. Only the disk data.</p>
<p>Flat and VMFS files always have a separate plaintext descriptor file and are easy to identify through it as it is easy to open in a regular text editor.</p>
<p>The zero extent is only a virtual extent spitting out zeros.</p>
<h1>Sparse</h1>
<p>The sparse extent types appear when a disk is thin provisioned (when the size of the disk specified at the virtual machine creation is not fully allocated immediately).</p>
<p>The sparse extent files are binary files following a specific format. They start with the &quot;KDMV&quot; magic bytes (VDMK in little endian) and a header that will indicate the top-level metadata needed to read the file.</p>
<p>It is important to note that a sparse extent file is segmented in blocks of 512 bytes. As such, the header is 512 bytes long with padding to fill up the whole sector. All subsequent references in the file are specified in terms of sectors of this size.</p>
<p>There is a special case in <code>monolithicSparse</code> disks where the VMDK descriptor is not in a separate file but is embedded directly into the sparse extent file. In this case, the sparse file header will give the sector number where to locate the descriptor and the sector count it will take</p>
<p>The header of a sparse file contains a lot of metadata related to the way the data is organized. This is necessary because the disk contents are not organized sequentially.</p>
<p><img decoding="async" loading="lazy" src="https://www.mickaelwalter.fr/content/images/2025/06/image-4.png" alt="" class="img_ev3q"></p>
<h1>Overview of the structure of a sparse file</h1>
<p>To allow full understanding of this overview, we have to dive in the nature of a grain.</p>
<p>A grain is a group of sectors. The number of the sectors grouped in a grain is specified by a parameter in the header (it is usually set to 128).</p>
<p>So, in a sparse file the disk data is split in blocks of several 512-byte long sectors. Grains in which no data has been written are not provisioned (sparse grain) in the file and the corresponding entry in the grain table is set to 0 indicating that any byte retrieved from it should be 0.</p>
<p>Let&#x27;s talk about the grain directory and the grain table.</p>
<p>The grain directory is a list of sector numbers pointing to various grain tables that can be placed anywhere in the sparse file. Each grain table will point to the first sector (relative to the start of the file and not the disk in this case) of the corresponding grain in the file.</p>
<p>In the grain directory and grain tables, grains are sorted in the same order as on the actual disk: the first entry of the first table pointed by the directory is the first sector of the disk part sliced in this sparse file (remember that a extent file does not necessarily start at sector 0 of the disk).</p>
<p>All the sectors of a provisioned grain are written fully in the file. A typical example of that is the sector 0 of a disk partitioned with a Master Boot Record. The MBR is usually 512-byte long. In this case, the grain 0 is provisioned and will contain data only in the first sector. All the other 127 (in case, the grain size is 128) are often set to 0.</p>
<p>The primary and secondary grain directories usually exist together to ensure resiliency in case of data corruption. Despite this, there are some cases where only the secondary directory should be used. A flag indicates which on to use depending on the case.</p>
<p>The file format explained before has 2 other variants:</p>
<ul>
<li>VMFS sparse: similar to the Sparse format but with several Copy-On-Write files</li>
<li>StreamOptimized sparse file: used in exchange formats such as OVA, this is a sparse file but with grain data compressed (using ZLIB DEFLATE)</li>
</ul>
<p>In the first case, the file header format changes and contains more metadata allowing a root / children relationship between files.</p>
<p>In the second case, the file also contains markers that allow to read the file sequentially. It is still possible to refer to the data using the contents of the header rather than reading the whole file but it should be taken into account that a marker starts the grain and not the actual data. Moreover, even if when they are decompressed they have a fixed size, the compressed grains can be of variable length and may be the source of irregular repartition of grains in the file.</p>
<p>I won&#x27;t dive into these special cases as they work on the same principles as the sparse extent type.</p>
<h1>Retrieving data for forensic purposes</h1>
<p>A challenge encountered by the forensic analyst when working with VMDK file is often to be able to retrieve the disk data in a reproducible and demonstrable way. Most forensic tools require a flat VMDK image to be able to work on the data. And you now see why this is the case.</p>
<p>However, flat images are not the norm as disks are most of the time thin provisioned to spare disk space on the host. This requires a conversion of the VMDK files to a monolithic flat one.</p>
<p>VMware (now Broadcom) provides such conversion tools but they are mostly closed source and there is no warranty of the integrity of data.</p>
<p>That&#x27;s okay for most investigations but some require high levels of integrity.</p>
<p>In this case, the most sensible approach is to directly parse the original source without any attempt to convert it. This is the approach I used in my contribution to Exhume Body. It is not a complete coverage of all VMDK formats yet but feedbacks and samples will be useful for me to improve the module.</p>
<p>You can find the source here:</p>
<p><a href="https://github.com/forensicxlab/exhume_body" target="_blank" rel="noopener noreferrer">GitHub - forensicxlab/exhume_body: Exhume a body of data. Supports multiple file formats.</a></p>
<p>Don&#x27;t hesitate to rise an issue or PR to improve this module.</p>
<h1>A bit more documentation</h1>
<p><a href="https://github.com/libyal/libvmdk/blob/main/documentation/VMWare%20Virtual%20Disk%20Format%20(VMDK).asciidoc" target="_blank" rel="noopener noreferrer">libvmdk/documentation/VMWare Virtual Disk Format (VMDK).asciidoc at main Â· libyal/libvmdk</a></p>
<p><a href="https://vdc-download.vmware.com/vmwb-repository/dcr-public/2bba164b-4115-4279-9c99-40f4c14319ad/03a845fc-5345-45de-9a27-31e868d6e751/doc/vddkDataStruct.5.3.html#1020737" target="_blank" rel="noopener noreferrer">Virtual Disk Types</a></p>
<p><a href="http://sanbarrow.com/vmdk/disktypes.html" target="_blank" rel="noopener noreferrer">sanbarrow.com</a></p>
<p><a href="https://venthusiastic.wordpress.com/2014/03/12/vmdk/" target="_blank" rel="noopener noreferrer">https://venthusiastic.wordpress.com/2014/03/12/vmdk/</a></p>
<p><a href="https://az4n6.blogspot.com/2015/04/dealing-with-compressed-vmdk-files.html" target="_blank" rel="noopener noreferrer">Dealing with compressed vmdk files</a></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vmdk">VMDK</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/exhume">Exhume</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/digital-forensics">Digital Forensics</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/thanatology-2"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">ðŸ¦‰ Thanatology part 2: Multiple disk images formats handling using the Exhume ToolKit</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/thanatology"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">ðŸ¦‰ Thanatology Part 1 - Introducing the Thanatology project</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Forensicxlab</div></div></div></footer></div>
</body>
</html>