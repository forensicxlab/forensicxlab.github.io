<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">üî¶ Debunking the Cellebrite (MacQuisition) Advanced Forensics File Format Version 4 (AFF4) implementation | Forensicxlab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.forensicxlab.com/blog/exhume-aff4"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="üî¶ Debunking the Cellebrite (MacQuisition) Advanced Forensics File Format Version 4 (AFF4) implementation | Forensicxlab"><meta data-rh="true" name="description" content="In the objective of implementing the modern Apple File System (APFS) module of the exhume toolkit, a test disk image from a recent macOS system was required. In practice, acquiring physical data from modern Apple hardware (especially with T2 / security constraints) quickly narrows the tooling landscape, and Cellebrite BlackLight / MacQuisition seems to be the default choice."><meta data-rh="true" property="og:description" content="In the objective of implementing the modern Apple File System (APFS) module of the exhume toolkit, a test disk image from a recent macOS system was required. In practice, acquiring physical data from modern Apple hardware (especially with T2 / security constraints) quickly narrows the tooling landscape, and Cellebrite BlackLight / MacQuisition seems to be the default choice."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2026-02-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/k1n0ne"><meta data-rh="true" property="article:tag" content="Thanatology,Exhume,Digital Forensics,AFF4"><link data-rh="true" rel="canonical" href="https://www.forensicxlab.com/blog/exhume-aff4"><link data-rh="true" rel="alternate" href="https://www.forensicxlab.com/blog/exhume-aff4" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.forensicxlab.com/blog/exhume-aff4" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.forensicxlab.com/blog/exhume-aff4","mainEntityOfPage":"https://www.forensicxlab.com/blog/exhume-aff4","url":"https://www.forensicxlab.com/blog/exhume-aff4","headline":"üî¶ Debunking the Cellebrite (MacQuisition) Advanced Forensics File Format Version 4 (AFF4) implementation","name":"üî¶ Debunking the Cellebrite (MacQuisition) Advanced Forensics File Format Version 4 (AFF4) implementation","description":"In the objective of implementing the modern Apple File System (APFS) module of the exhume toolkit, a test disk image from a recent macOS system was required. In practice, acquiring physical data from modern Apple hardware (especially with T2 / security constraints) quickly narrows the tooling landscape, and Cellebrite BlackLight / MacQuisition seems to be the default choice.","datePublished":"2026-02-03T00:00:00.000Z","author":{"@type":"Person","name":"k1nd0ne","description":"Digital Forensics Spiderman","url":"https://github.com/k1n0ne","image":"https://avatars.githubusercontent.com/u/27780432?v=4"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.forensicxlab.com/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Forensicxlab RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Forensicxlab Atom Feed"><link rel="stylesheet" href="/assets/css/styles.02888316.css">
<script src="/assets/js/runtime~main.bb668528.js" defer="defer"></script>
<script src="/assets/js/main.c83c3a33.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/27780432?v=4"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="ForensicXlab Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="ForensicXlab Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/thanatology">Thanatology</a><a class="navbar__item navbar__link" href="/docs/exhume">Exhume</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://github.com/forensicxlab" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://discord.gg/AqkYgR5HEg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/exhume-aff4">üî¶ Debunking the Cellebrite (MacQuisition) Advanced Forensics File Format Version 4 (AFF4) implementation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology-2025">üéä Thanatology Project - 2025 wrap up and goals</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology-4">ü¶â Thanatology part 4: Filesystem Forensics with the Exhume ToolKit.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/volweb-3-15">üì¶ VolWeb v3.15 July 2025 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology-3">ü¶â Thanatology part 3: MBR and GPT forensics with the Exhume ToolKit.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology-2">ü¶â Thanatology part 2: Multiple disk images formats handling using the Exhume ToolKit</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vmdk">üî¶ A quick walkthrough in the VMDK format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thanatology">ü¶â Thanatology Part 1 - Introducing the Thanatology project</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/voliat">üì¶ Volatility3 : Import Address Table</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/volads">üì¶ Volatility3 : Alternate Data Stream Scan</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hibernation">üìò Volatility3: Modern Windows Hibernation file analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vols3">üìò Volatility3 - Remote analysis on cloud object-storage.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/steam">üî¶ Video Games Forensics - Steam</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keepass">üì¶ Volatility3 Windows Plugin - KeePass</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ewf">üî¶ Debunking the Expert Witness Compression Format (EWF)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/vision">üß¨ Malware Analysis with VISION-ProcMon</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/anydesk">üì¶ Volatility3 Windows Plugin - AnyDesk</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/inodes">üì¶ Volatility3 Linux Plugin - Inodes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/prefetch">üì¶ Volatility3 Windows Plugin - Prefetch</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/cb-brave">üñã Cyberdefenders - Writeup - Brave</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/volaslib">üìò Using Volatility3 as a library</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/macisf">üìÑ Volatility3 - ISF for MacOs</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">üî¶ Debunking the Cellebrite (MacQuisition) Advanced Forensics File Format Version 4 (AFF4) implementation</h1><div class="container_mt6G margin-vert--md"><time datetime="2026-02-03T00:00:00.000Z">February 3, 2026</time> ¬∑ <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/k-1-nd-0-ne"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/27780432?v=4" alt="k1nd0ne"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/k-1-nd-0-ne"><span class="authorName_yefp">k1nd0ne</span></a></div><small class="authorTitle_nd0D" title="Digital Forensics Spiderman">Digital Forensics Spiderman</small><div class="authorSocials_rSDt"><a href="https://x.com/k1nd0ne" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/k1nd0ne" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://bsky.app/profile/k1nd0ne.bsky.social" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 226" class="authorSocialLink_owbf"><path fill="#1185FE" d="M55.491 15.172c29.35 22.035 60.917 66.712 72.509 90.686 11.592-23.974 43.159-68.651 72.509-90.686C221.686-.727 256-13.028 256 26.116c0 7.818-4.482 65.674-7.111 75.068-9.138 32.654-42.436 40.983-72.057 35.942 51.775 8.812 64.946 38 36.501 67.187-54.021 55.433-77.644-13.908-83.696-31.676-1.11-3.257-1.63-4.78-1.637-3.485-.008-1.296-.527.228-1.637 3.485-6.052 17.768-29.675 87.11-83.696 31.676-28.445-29.187-15.274-58.375 36.5-67.187-29.62 5.041-62.918-3.288-72.056-35.942C4.482 91.79 0 33.934 0 26.116 0-13.028 34.314-.727 55.491 15.172Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>In the objective of implementing the modern Apple File System (APFS) module of the <code>[exhume</code> toolkit](<a href="https://www.forensicxlab.com/docs/exhume" target="_blank" rel="noopener noreferrer">https://www.forensicxlab.com/docs/exhume</a>), a test disk image from a recent macOS system was required. In practice, acquiring <em>physical</em> data from modern Apple hardware (especially with T2 / security constraints) quickly narrows the tooling landscape, and <strong>Cellebrite BlackLight / MacQuisition</strong> seems to be the default choice.</p>
<p>After acquiring disk image of a modern Apple computer, the output format was <strong>AFF4</strong> (Advanced Forensics File Format v4). After not being able to convert this image to a raw disk image on my operating system and, in a quest to make the digital forensics investigation platform agnostic, the next step was obvious: add AFF4 support to exhume_body and make it reliable enough to feed an APFS parser.</p>
<p>In this blog post, I describe that journey and the key findings along the way. The important part is this: <strong>MacQuisition produces an AFF4 that strongly diverges from what most public AFF4 descriptions (and many OSS parsers) that I have found assume</strong>, which makes existing implementations fail or perform poorly.</p>
<p>Let‚Äôs solve this properly.</p>
<hr>
<h1>Motivation</h1>
<p>Before going down the rabbit hole, I tried the obvious shortcut: export the AFF4 to a raw disk image and feed that to the APFS parser.</p>
<p>My first attempt was to export to raw with <a href="https://aff4-imager.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">aff4imager</a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">aff4imager </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-e</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;aff4://f47e5cb5-c0e1-4301-b382-67f73f3b02ce&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--export_dir</span><span class="token plain"> test/ ~/IMAGE.aff4</span><br></span></code></pre></div></div>
<p>However, the tool output is the following:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Compression method https://code.google.com/p/lz4/ is not supported by this implementation.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Compression method https://code.google.com/p/lz4/ is not supported by this implementation.</span><br></span></code></pre></div></div>
<p>Well, that‚Äôs‚Ä¶ not right and I couldn&#x27;t mount this aff4 image on my mac. And for this injustice, I redirected my full focus onto <strong>this specific AFF4 implementation</strong>. The following sections describe the journey and how to reliably read bytes from this MacQuisition-produced AFF4 starting from scratch. Note that my implementation needs to be tested on other images in order to make it more robust. This is not an academic paper, the next sections contain the information and conceptes I have learned and understood and therefore subjective. It could lack some information. Make sure to send me a message if some of what you are reading needs to be modified!</p>
<h1>Background on AFF4</h1>
<p>AFF4 (Advanced Forensics Format Version 4) is not just a disk image format like we saw with <a href="https://www.forensicxlab.com/blog/ewf" target="_blank" rel="noopener noreferrer">EWF</a>. It is a <strong>container + data model</strong> designed for forensic acquisition workflows.</p>
<p>AFF version 4 was completed in 2009 by Michael Cohen, Simson Garfinkel, and Bradley Schatz. The design was introduced in their paper: &quot;Extending the advanced forensic format to accommodate multiple data sources, logical evidence, arbitrary information and forensic workflow,&quot; published in Digital Investigation 6 (2009), S57‚ÄìS68. That publication shipped alongside an early reference implementation written in Python. The version later made available via aff4.org is a separate, open-source reimplementation intended to serve as a general-purpose AFF4 library.</p>
<p>A useful snapshot of the motivation and historical context appears in a 2010 Digital Investigation article (vol. 7) titled &quot;Hash based disk imaging using AFF4.&quot; The authors contrast earlier approaches to forensic imaging‚Äîfirst, raw ‚Äúbit-for-bit‚Äù acquisition (often described as dd images), and then block-based compression methods that improved storage efficiency but could increase acquisition time. They position AFF4 as a &quot;third generation&quot; forensic format: one that brings multiple image streams, arbitrary metadata, and storage virtualization directly into the file format itself.</p>
<p>Since, some digital forensics vendors were also able to develop their own implementations of AFF4 acquisition, and not a lot of documentation on the evolutions of the format since 2010 is available online.</p>
<h1>AFF4 high-level structure overview</h1>
<p>As usual, let&#x27;s start simple (and therefore in a vulgarised way) to describe an AFF4 image. At its base, AFF4 is just a ZIP file using the Zip64 extension. This is the main &quot;container&quot; for storing <strong>streams</strong> and <strong>metadata</strong> files.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/1-53ac63b335e67d7d970e39ce5f5fe78d.png" title="High level overview" width="2318" height="1432" class="img_ev3q"></p>
<p>Inside the AFF4 container directory structure, we can find a file named &quot;information.turtle&quot;. Unlike the EWF format that we have studied in earlier blog posts, AFF4 doesn&#x27;t use fixed binary headers for metadata. Instead, it is using the Resource Description Framework (RDF) serialised as &quot;Turtle&quot; (Terse RDF Triple Language). The &quot;information.turtle&quot; zip member contains the metadata needed to describe the layout of the AFF4 image. The metadata stored inside the information turtle informs our tool about record <strong>object</strong> types, attributes (sizes, chunking parameters, timestamps, tool info), and relationships between <strong>objects</strong>. I will dive into more details later.</p>
<p>Let&#x27;s talk vocabulary! in AFF4, each &quot;<strong>Object</strong>&quot; is identified with a unique <strong>URN</strong> (Uniform Resource Name).</p>
<p>In the context of this blog post, I divide AFF4 Objects into three categories: The <strong>Evidence</strong> object(s), the <strong>Map</strong> object(s) and the <strong>Image</strong> object(s). The Map &amp; Image are not stored as one blob, AFF4 models the evidence bytes as a sequential, addressable flow of bytes. We will refer to them as <strong>MapStream</strong> and <strong>ImageStream</strong></p>
<ul>
<li>The <strong>Evidence</strong> object is the thing we want to mount/read: for example, a disk image.</li>
<li>The <strong>MapStream</strong> object provides the necessary information to obtain one logical &quot;view&quot; of an acquired disk image, a partition image, a file, a carved artefact, etc.</li>
<li>The <strong>ImageStream</strong> object is the backing storage that provides the bytes for one or more views.</li>
</ul>
<p>Note that we <strong>can have multiple ImageStream objects</strong> if we perform the acquisition of multiple sources. For example, we could acquire a disk image into a first image object and the memory of the machine in another one.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-information-turtle">The information Turtle<a href="#the-information-turtle" class="hash-link" aria-label="Direct link to The information Turtle" title="Direct link to The information Turtle">‚Äã</a></h2>
<p>The information turtle gives us the important metadata between the acquired Evidence(s) layout and the generated logical AFF4 layout. This is not optional decoration: readers <em>must</em> use it to interpret the container like mentioned in the <a href="https://www.sciencedirect.com/science/article/pii/S1742287609000401" target="_blank" rel="noopener noreferrer">main article about the subject</a>. Let&#x27;s take a look at the information turtle of the Cellebrite/MacQuisition produced AFF4 image.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/4-8b476a211c50751810243d1dd1066be3.png" title="Information Turtle Example" width="2152" height="1175" class="img_ev3q"></p>
<p>In this example, a total of <strong>242837545 blocks</strong> of <strong>4096 bytes each</strong> were acquired and are representing an <strong>APFSContainerImage</strong>.</p>
<p>In the AFF4 world, the acquired blocks from the source evidence are concatenated into <strong>Chunks</strong>. In our example, the size of a chunk is 32768 bytes (= 8 * 4096 = 8 blocks). Multiple chunks are stored into <strong>Segments</strong>. In our example, the number of chunk in one Segment is 1024. In AFF4 each Segments are backed up as a file in the container (ZIP) for a total size of 53861023744 bytes (~50Gb).</p>
<p>To know the number of segments, we can use the following math: number_of_segments = total_size / size_of_one_segment.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/6-5ea62ba33925768e6c0cef08feea1364.png" title="Map target dictionnary" width="3662" height="2257" class="img_ev3q"></p>
<p>In our case: number_of_segments = 53861023744 / (1024 * 32768) = 1605 Segments !</p>
<p>That is great, we have the necessary metadata to retrieve the information about the Segments, the blocks and the URNs used to store the bytes. But now, how can I extract 512 bytes of data from offset 0x12502 &quot;from the point of view&quot; of the original evidence? AFF4 doesn&#x27;t store sparse data when using the Map object during acquisition, so it needs to keep track of the original acquired offsets and the image. We still need the <strong>Map</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-map">The Map<a href="#the-map" class="hash-link" aria-label="Direct link to The Map" title="Direct link to The Map">‚Äã</a></h2>
<p>The Map Object allows us to know the mapping between the acquired image and it&#x27;s logical representation. The map basically allows us to perform: &quot;<em><strong>If I want 512 bytes from offset 0x1215 in the original (virtual) aquired image, I need to look at offset 0x.... in the AFF4 ImageStream X</strong></em>&quot;</p>
<p>Many published examples show that the MapStream is stored in the AFF4 container (ZIP) as two records:</p>
<ul>
<li><strong>The target dictionary</strong>: Association between an ID and the name of the byte stream.</li>
<li><strong>The intervals list</strong>: A (originally) text-map composed of multiple records. Each record holds the following:<!-- -->
<ul>
<li>Virtual offset: virtual/logical start offset in the map‚Äôs logical stream;</li>
<li>Length: number of bytes in this extent (the run length);</li>
<li>Target offset: start offset in the backing target stream where those bytes come from;</li>
<li>Index: which target stream (lookup in the map‚Äôs /idx table).</li>
</ul>
</li>
</ul>
<p>In the case of our Cellebrite/MacQuisition AFF4 container:</p>
<ul>
<li>The target dictionary is stored in the ZipFile record: aff4://1ddcf287-f499-492a-ab06-7edec982b094/<strong>idx</strong></li>
<li>The intervals list is stored in the ZipFile record: aff4://1ddcf287-f499-492a-ab06-7edec982b094/<strong>map</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-cellebritemacquisition-divergence">The Cellebrite/MacQuisition divergence<a href="#the-cellebritemacquisition-divergence" class="hash-link" aria-label="Direct link to The Cellebrite/MacQuisition divergence" title="Direct link to The Cellebrite/MacQuisition divergence">‚Äã</a></h3>
<p><strong>The following was not documented anywhere I&#x27;ve looked online. This is based on the deep inspection of my acquisition image.</strong></p>
<p>MacQuisition‚Äôs AFF4 map stream is not a line-oriented &quot;text map&quot;. It is a packed binary array of fixed-size records. Each record is <strong>28 bytes</strong>, little-endian:</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/7-d14b206fa13c55232ed8c8ee341c6b56.png" title="Map records" width="1748" height="1014" class="img_ev3q"></p>
<table><thead><tr><th style="text-align:right">Byte range (inclusive-exclusive)</th><th style="text-align:right">Size</th><th>Type (LE)</th><th>Field</th><th>Meaning</th></tr></thead><tbody><tr><td style="text-align:right"><code>0..8</code></td><td style="text-align:right">8</td><td><code>u64</code></td><td><code>virtual_offset</code></td><td>Start offset in the <strong>virtual image</strong> (the reconstructed address space)</td></tr><tr><td style="text-align:right"><code>8..16</code></td><td style="text-align:right">8</td><td><code>u64</code></td><td><code>extent_len</code></td><td>Length in bytes of this mapping run (0 may be used as a sentinel/hole marker)</td></tr><tr><td style="text-align:right"><code>16..24</code></td><td style="text-align:right">8</td><td><code>u64</code></td><td><code>target_offset</code></td><td>Offset in the <strong>target stream</strong> where data is sourced from</td></tr><tr><td style="text-align:right"><code>24..28</code></td><td style="text-align:right">4</td><td><code>u32</code></td><td><code>target_index</code></td><td>Index into the adjacent <strong>idx table</strong> (string table of target URIs)</td></tr></tbody></table>
<p>For a given record:</p>
<ul>
<li>
<p>The virtual range covered is:</p>
<p><code>virtual_offset .. virtual_offset + extent_len</code></p>
</li>
<li>
<p>The corresponding bytes are read from:</p>
<p><code>target_uri[target_index]</code> at offset <code>target_offset</code></p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-idx-table-next-to-it">The <code>idx</code> table next to it<a href="#the-idx-table-next-to-it" class="hash-link" aria-label="Direct link to the-idx-table-next-to-it" title="Direct link to the-idx-table-next-to-it">‚Äã</a></h3>
<p>The map does not store the target URIs inline. It is using the member next to it (<code>.../idx</code>) which is a <strong>NUL-separated string table</strong>:</p>
<ul>
<li>Split by <code>0x00</code></li>
<li>Each string is a target URI (e.g. <code>aff4://.../data</code>)</li>
<li><code>target_index</code> in the 28-byte record selects one of these strings</li>
</ul>
<p>This reduces map size significantly when many records refer to the same target stream.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/2-6b7a445d035f2148cf99a5c192b2753c.png" title="Map target dictionnary" width="2490" height="1596" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-segments">The Segments<a href="#the-segments" class="hash-link" aria-label="Direct link to The Segments" title="Direct link to The Segments">‚Äã</a></h2>
<p>In the AFF4 world, and specifically in our case, each segment can be backed by a file in the AFF4 container (ZIP).
For example:</p>
<ul>
<li>aff4://1ddcf287-f499-492a-ab06-7edec982b094/00000001 contains the segment number 1</li>
<li>aff4://1ddcf287-f499-492a-ab06-7edec982b094/00000002 contains the segment number 2</li>
<li>etc..</li>
</ul>
<blockquote>
<p>In our case we have 1605 segments, so it will go from aff4://1ddcf287-f499-492a-ab06-7edec982b094/00000001 to aff4://1ddcf287-f499-492a-ab06-7edec982b094/00001605</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-cellebritemacaquisition-divergence">The Cellebrite/MacAquisition divergence<a href="#the-cellebritemacaquisition-divergence" class="hash-link" aria-label="Direct link to The Cellebrite/MacAquisition divergence" title="Direct link to The Cellebrite/MacAquisition divergence">‚Äã</a></h3>
<p><strong>The following is not documented anywhere I&#x27;ve looked online. This is based on the inspection of my acquisition image.</strong></p>
<p>If you come back to the metadata of the information turtle showed, you can see a property named:</p>
<p><code>aff4:compressionMethod &lt;https://code.google.com/p/lz4/&gt; ;</code></p>
<p>That means every chunk is compressed before being stored in the segments. <strong>So we actually have segments that can contain compressed chunks using the lz4 compression method</strong></p>
<p>In the case of Cellebrite/MacAquisition, and in order to keep track of the variable lengths and offsets of each compressed chunks, they also stores an <strong>index</strong> file alongside each segment member. These &quot;segments indexes&quot; are composed of <strong>12-byte entries</strong>.</p>
<p>Each entry is 12 bytes, little-endian, and it encodes (compressed offset, compressed length) for one chunk inside the corresponding segment member‚Äôs payload.</p>
<table><thead><tr><th style="text-align:right">Byte range (inclusive-exclusive)</th><th style="text-align:right">Size</th><th>Type (LE)</th><th>Field</th><th>Description</th></tr></thead><tbody><tr><td style="text-align:right"><code>0..4</code></td><td style="text-align:right">4</td><td><code>u32</code></td><td><code>lo</code></td><td>Low 32 bits of the chunk blob offset (<code>c_off</code>) within the <strong>segment member payload</strong></td></tr><tr><td style="text-align:right"><code>4..8</code></td><td style="text-align:right">4</td><td><code>u32</code></td><td><code>hi</code></td><td>High 32 bits of the chunk blob offset (<code>c_off</code>) within the <strong>segment member payload</strong></td></tr><tr><td style="text-align:right"><code>8..12</code></td><td style="text-align:right">4</td><td><code>u32</code></td><td><code>len</code></td><td>Length in bytes of the chunk blob (<code>c_len</code>) stored in the segment member</td></tr></tbody></table>
<p>So why would you compress the chunks? It&#x27;s clearly not to be able to store more chunks into each segments because from the metadata we have, the segment boundaries are stable and we just benefit from smaller members. The main reason is probably to lower disk I/O when performing data read from disk to reconstruct a chunk in memory.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/5-fd094b737b9ffe1c697fe2634ee0fa37.png" title="Map target dictionnary" width="2208" height="2257" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-read-data">How to read data<a href="#how-to-read-data" class="hash-link" aria-label="Direct link to How to read data" title="Direct link to How to read data">‚Äã</a></h2>
<p>At this point, we know the container is Zip64, and that MacQuisition‚Äôs AFF4 differs in two key places:</p>
<ul>
<li>The map is a packed binary array (28-byte records), not a line-based text map</li>
<li>The data is stored as LZ4-compressed chunks inside segment members, with a per-segment .index file to locate each compressed chunk</li>
</ul>
<p>So reading bytes can happen in the following order: virtual offset ‚Üí map interval ‚Üí target stream offset ‚Üí segment + chunk ‚Üí (offset,len) via index ‚Üí LZ4 decode ‚Üí slice.</p>
<p>In order to implement the exhume_body aff4 support, I first needed to parse the Zip64 central directory and build a dictionary of <code>member name ‚Üí {header offset; sizes; zip compression method}</code>. Not going into details on how to parse a Zip64 archive but just note that I am using it constantly to fetch information.turtle, the map members, segment members, and the per-segment .index files.</p>
<p>Then, from the Turtle RDF metadata, we extract the values that drive all addressing math:</p>
<ul>
<li>image_size</li>
<li>chunk_size</li>
<li>chunks_in_segment</li>
<li>compressionMethod (here: LZ4)</li>
<li>the URNs/base paths for the map object and the data stream</li>
</ul>
<p>As mentioned in my previous observations, Cellebrite/MacQuisition stores two adjacent map members:</p>
<ul>
<li>.../idx ‚Üí NUL-separated string table of target URIs</li>
<li>.../map ‚Üí packed 28-byte records (LE): (virtual_offset<!-- -->:u64<!-- -->, extent_len<!-- -->:u64<!-- -->, target_offset<!-- -->:u64<!-- -->, target_index<!-- -->:u32<!-- -->)</li>
</ul>
<p>I&#x27;m turning these into an in-memory interval list:</p>
<ul>
<li>each interval maps a virtual range to (target_uri, target_offset)</li>
<li>sort by virtual_offset</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reading-n-bytes-at-virtual-offset-v">Reading N bytes at virtual offset V<a href="#reading-n-bytes-at-virtual-offset-v" class="hash-link" aria-label="Direct link to Reading N bytes at virtual offset V" title="Direct link to Reading N bytes at virtual offset V">‚Äã</a></h3>
<p>The following pseudo-code algorithm is a summary of the actions performed to read N bytes at a virtual offset V.</p>
<ul>
<li>find which interval covers the current position (binary search)</li>
<li>if no interval: it‚Äôs a hole ‚Üí zero-fill</li>
<li>if interval found:<!-- -->
<ul>
<li>compute the logical offset inside the target stream:</li>
<li>logical_off = interval.target_offset + (pos - interval.virtual_offset).</li>
<li>fetch bytes from the target stream at logical_off (next section).</li>
<li>repeat until the request is satisfied.</li>
</ul>
</li>
</ul>
<h1>Integration to the exhume Toolkit</h1>
<p>Well, the final result is that exhume_body now supports aff4 as a new format and therefore all of the exhume_modules above (like exhume_filesystem, exhume_partitions, ...).</p>
<p>In order to test the implementation, you can perform the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cargo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> exhume_body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">exhume_body </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-b</span><span class="token plain"> /</span><span class="token environment constant" style="color:rgb(189, 147, 249)">PATH</span><span class="token plain">/TO/IMAGE.aff4 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> aff4 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-s</span><span class="token plain"> </span><span class="token number">512</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-offset</span><span class="token plain"> 0x0</span><br></span></code></pre></div></div>
<p>Example output:</p>
<div class="language-raw codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-raw codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Processing the file &#x27;/PATH/TO/IMAGE.aff4&#x27; in &#x27;aff4&#x27; format...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Zip64 EOCD Record located at: 0xa0344ac91</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Central Directory Total Entries: 0xc91</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Central Directory Size: 0x602c2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Central Directory: 3217 entries starting at 0xa033ea9cf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: size                     = 994662584320</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: stored                   = aff4://78a06441-793b-425d-8952-a3fff45058d1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: chunkSize                = 32768</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: chunksInSegment          = 1024</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: compressionMethod        = https://code.google.com/p/lz4/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: hash                     = 1430c174c043522ed31c52896c1effb597150437</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: hash                     = a91b7434416c73226fb348ce43808d1c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: size                     = 53861023744</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: stored                   = aff4://78a06441-793b-425d-8952-a3fff45058d1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: blockCount               = 242837545</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: blockSize                = 4096</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: dataStream               = aff4://1ddcf287-f499-492a-ab06-7edec982b094</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: size                     = 994662584320</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: APFSContainerType        = https://blackbagtech.com/aff4/Schema#APFST2ContainerType</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: ContainsExtents          = true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: ContainsUnallocated      = false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata: integrityStream          = aff4://1ddcf287-f499-492a-ab06-7edec982b094/data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--- Parsing Binary Map Stream: aff4%3A%2F%2F1ddcf287-f499-492a-ab06-7edec982b094/map ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using idx table member: aff4%3A%2F%2F1ddcf287-f499-492a-ab06-7edec982b094/idx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">idx table contains 1 target strings</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Built 81020 merged intervals. First v_off=0x0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Selected format: AFF4 / AFF4-L</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Description: AFF4 ImageStream (Zip volume).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Sector size: 512</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Evidence : /PATH/TO/IMAGE.aff4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AFF4 image_size=0xe796829000, chunk_size=0x8000, chunks_in_segment=1024, compression=Lz4, intervals=81020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000000: efbf bdef bfbd efbf bdef bfbd efbf bd3f  ...............?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000010: 7001 0000 0000 0000 0073 efbf bd00 0000  p........s......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000020: 0000 0001 0000 efbf bd00 0000 004e 5853  .............NXS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000030: 4200 1000 0029 6879 0e00 0000 0000 0000  B....)hy........</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000040: 0000 0000 0000 0000 0000 0000 0002 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000050: 0000 0000 00ef bfbd 18ef bfbd efbf bdef  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000060: bfbd efbf bd40 0eef bfbd db85 7266 c6ab  .....@......rf..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000070: 69ef bfbd 4704 0000 0000 0074 efbf bd00  i...G......t....</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000080: 0000 0000 0018 0100 005c 6c00 0001 0000  .........\l.....</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000090: 0000 0000 0019 0100 0000 0000 00ef bfbd  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000000a0: 0000 0062 3700 00ef bfbd 0000 0002 0000  ...b7...........</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000000b0: 005d 3700 0005 0000 0000 0400 0000 0000  .]7.............</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000000c0: 00ef bfbd efbf bd11 0000 0000 0001 0400  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000000d0: 0000 0000 0000 0000 0064 0000 0002 0400  .........d......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000000e0: 0000 0000 0006 0400 0000 0000 001b 0500  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000000f0: 0000 0000 001d 0500 0000 0000 001f 0500  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000100: 0000 0000 0021 0500 0000 0000 0001 0604  .....!..........</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000130: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000140: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000150: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000170: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000180: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000190: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000001a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000001b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000001c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000001d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000001e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">000001f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000200: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000210: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00000220: 0000 0000 000a                           ......</span><br></span></code></pre></div></div>
<h1>Conclusion</h1>
<p>Well, this journey was painful. But now I can read MacOs MacQuisitions and begin developing the Exhume APFS module, which was the original objective for the Thanatology project.</p>
<p>My implementation HAS TO BE CONSIDERED AS VERY SPECIFC to the Cellebrite/MacQuisition AFF4 images for now until I put my hands on more images. Feel free to test it, raise any issues you might find on Github or on the dedicated <a href="https://discord.com/invite/AqkYgR5HEg" target="_blank" rel="noopener noreferrer">Discord Server</a>.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/thanatology">Thanatology</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/exhume">Exhume</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/digital-forensics">Digital Forensics</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/aff-4">AFF4</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/thanatology-2025"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">üéä Thanatology Project - 2025 wrap up and goals</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-information-turtle" class="table-of-contents__link toc-highlight">The information Turtle</a></li><li><a href="#the-map" class="table-of-contents__link toc-highlight">The Map</a><ul><li><a href="#the-cellebritemacquisition-divergence" class="table-of-contents__link toc-highlight">The Cellebrite/MacQuisition divergence</a></li><li><a href="#the-idx-table-next-to-it" class="table-of-contents__link toc-highlight">The <code>idx</code> table next to it</a></li></ul></li><li><a href="#the-segments" class="table-of-contents__link toc-highlight">The Segments</a><ul><li><a href="#the-cellebritemacaquisition-divergence" class="table-of-contents__link toc-highlight">The Cellebrite/MacAquisition divergence</a></li></ul></li><li><a href="#how-to-read-data" class="table-of-contents__link toc-highlight">How to read data</a><ul><li><a href="#reading-n-bytes-at-virtual-offset-v" class="table-of-contents__link toc-highlight">Reading N bytes at virtual offset V</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2026 Forensicxlab</div></div></div></footer></div>
</body>
</html>