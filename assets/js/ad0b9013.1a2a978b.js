"use strict";(self.webpackChunkexhume=self.webpackChunkexhume||[]).push([[7825],{1438:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/1-f626d93f59a55d33812e49d833c3684b.png"},1644:e=>{e.exports=JSON.parse('{"permalink":"/blog/vols3","source":"@site/blog/2023-08-23-vols3/index.md","title":"\ud83d\udcd8 Volatility3 - Remote analysis on cloud object-storage.","description":"Memory forensics is a huge help when performing an investigation and during incident response. Collecting memory images and analyzing them at scale is a challenge.","date":"2023-08-23T00:00:00.000Z","tags":[{"inline":true,"label":"DFIR","permalink":"/blog/tags/dfir"},{"inline":true,"label":"Volatility","permalink":"/blog/tags/volatility"},{"inline":true,"label":"Memory Forensics","permalink":"/blog/tags/memory-forensics"}],"readingTime":8.64,"hasTruncateMarker":true,"authors":[{"name":"k1nd0ne","title":"Digital Forensics Spiderman","url":"https://github.com/k1n0ne","page":{"permalink":"/blog/authors/k-1-nd-0-ne"},"socials":{"x":"https://x.com/k1nd0ne","github":"https://github.com/k1nd0ne","bluesky":"https://bsky.app/profile/k1nd0ne.bsky.social"},"imageURL":"https://avatars.githubusercontent.com/u/27780432?v=4","key":"k1nd0ne"}],"frontMatter":{"slug":"vols3","title":"\ud83d\udcd8 Volatility3 - Remote analysis on cloud object-storage.","authors":["k1nd0ne"],"tags":["DFIR","Volatility","Memory Forensics"]},"unlisted":false,"prevItem":{"title":"\ud83d\udcd8 Volatility3: Modern Windows Hibernation file analysis","permalink":"/blog/hibernation"},"nextItem":{"title":"\ud83d\udd26 Video Games Forensics - Steam","permalink":"/blog/steam"}}')},4300:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/3-c0b447818172958593d7d702d9eaa902.png"},7189:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/2-eb572296be2691211a728fa9e99eacb4.png"},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>r});var s=n(6540);const o={},i=s.createContext(o);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:t},e.children)}},9489:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var s=n(1644),o=n(4848),i=n(8453);const a={slug:"vols3",title:"\ud83d\udcd8 Volatility3 - Remote analysis on cloud object-storage.",authors:["k1nd0ne"],tags:["DFIR","Volatility","Memory Forensics"]},r=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Object-storage",id:"object-storage",level:2},{value:"Support of object-storage in volatility3",id:"support-of-object-storage-in-volatility3",level:2},{value:"Volatility3 state of the art",id:"volatility3-state-of-the-art",level:3},{value:"Adding bucketS3 support to the FileLayer",id:"adding-buckets3-support-to-the-filelayer",level:3},{value:"Testing",id:"testing",level:3},{value:"On-Premise MIN.IO",id:"on-premise-minio",level:4},{value:"AWS remote s3 bucket using volshell",id:"aws-remote-s3-bucket-using-volshell",level:4},{value:"Google cloud bucket",id:"google-cloud-bucket",level:4},{value:"Applications",id:"applications",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"Memory forensics is a huge help when performing an investigation and during incident response. Collecting memory images and analyzing them at scale is a challenge."}),"\n",(0,o.jsx)(t.p,{children:"It is crucial to have the capability of examining memory images on storage platforms other than traditional file systems. With the emergence of cloud technologies, new forms of storage known as object storage have emerged. Enabling memory analysis on object storage provides exciting opportunities for innovation and advancement."}),"\n",(0,o.jsx)(t.p,{children:"In this article, we will go through the journey of making the volatility3 framework compatible with s3 object-storage to perform memory analysis over the network. Also, the reader will discover how this new capability can and will be applied to the VolWeb 2.0 project which is still in developpement."}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"Disclaimer :"})," All of the information about the volatility3 framework given in this blogpost are from my own understanding of the framework and of the project documentation",(0,o.jsx)(t.sup,{children:(0,o.jsx)(t.a,{href:"#user-content-fn-1-a3ad40",id:"user-content-fnref-1-a3ad40","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),". Feel free to contact me at ",(0,o.jsx)(t.a,{href:"mailto:felix.guyard@forensicxlab.com",children:"felix.guyard@forensicxlab.com"})," to correct any mistake made in the explanations."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"object-storage",children:"Object-storage"}),"\n",(0,o.jsx)(t.p,{children:"Object storage is a type of data storage architecture that manages data as objects, rather than as blocks or files like traditional storage systems. In object storage, a unique identifier is assigned to each piece of data and stored in a flat address space. These objects can contain not only the data itself, but also metadata and other attributes that provide additional information about the object. One of the key features of object storage is its scalability and it is ideal for storing big data sets like digital forensics evidence for example."}),"\n",(0,o.jsx)(t.h2,{id:"support-of-object-storage-in-volatility3",children:"Support of object-storage in volatility3"}),"\n",(0,o.jsx)(t.h3,{id:"volatility3-state-of-the-art",children:"Volatility3 state of the art"}),"\n",(0,o.jsx)(t.p,{children:"The native volatility3 framework currently provides one method for accessing data when performing the contextualization on a memory image which is direct access on a traditionnal filesystem."}),"\n",(0,o.jsx)(t.p,{children:'When an analyst is using volatility3 to extract data using a plugin, the framework is building the context "behind the scenes", which is the most critical step in the memory forensics workflow aside from the aquisition and analysis steps. This step is too often overlooked/forgotten by some investigators.'}),"\n",(0,o.jsx)(t.p,{children:'In the framework, the data contextualisation is made via "layering" and "stacking".\nEach layer in volatility3 focuses on a particular aspect of memory forensics, such as parsing specific data structures, analyzing various kinds of artifacts, or understanding specific evidence formats. The layers can be seen as individual building blocks that can be stacked on top of each other in a specific order to build the right context before extracting data for analysis. As an example, a memory image with the "vmem" format will induce the stacking of the "VmwareLayer" to be able to read such file format and extract data.'}),"\n",(0,o.jsx)(t.p,{children:'One of the layer is called the "FileLayer" or "physical". One of the usage of this layer by the framework is to know how to locate, open, read and overall access resources of the evidence provided by the investigator. The FileLayer is using what is called a "ResourceAccessor" to interface with the physical evidence.'}),"\n",(0,o.jsx)("div",{style:{backgroundColor:"white",alignItems:"center"},children:(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"alt text",src:n(1438).A+"",title:"Arch 1",width:"4037",height:"1191"})})}),"\n",(0,o.jsx)(t.h3,{id:"adding-buckets3-support-to-the-filelayer",children:"Adding bucketS3 support to the FileLayer"}),"\n",(0,o.jsxs)(t.p,{children:["The FileLayer currently support one type of resource accessor which is the ",(0,o.jsx)(t.strong,{children:"file://"})," and ",(0,o.jsx)(t.strong,{children:"http(s)://"})," url patterns. They are used to read the evidence and remote pdb files by using the urllib python3 library."]}),"\n",(0,o.jsx)(t.p,{children:"By giving the possibility to the analyst to indicate that the evidence as to be read from remote object storage we can pass this information to the context and create an other resource accessor."}),"\n",(0,o.jsx)("div",{style:{backgroundColor:"white",alignItems:"center"},children:(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"alt text",src:n(7189).A+"",title:"Arch 2",width:"5751",height:"2784"})})}),"\n",(0,o.jsx)(t.p,{children:"Here is what was done to make this possible :"}),"\n",(0,o.jsx)(t.p,{children:'Adding new mutually exclusive argument group to the framework CLI : "-s3/--amazon-bucket"/"-gs/--google-bucket"'}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'group = parser.add_mutually_exclusive_group()\n\ngroup.add_argument(\n\t"-s3",\n\t"--amazon-bucket",\n\taction=\'store_true\',\n\thelp="The file provided will come from an amazon bucket",\n)\n\ngroup.add_argument(\n\t"-gs",\n\t"--google-bucket",\n\taction=\'store_true\',\n\thelp="The file provided will come from a google bucket",\n)\n'})}),"\n",(0,o.jsx)(t.p,{children:"Next the CLI will check that the required environment variables are present to reach the bucket requested. Here is an example for Amazon S3/Minio."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'        if args.amazon_bucket:\n            # First check if the global variables are set and set the cloud location\n            try:\n                aws_access_key_id =  os.getenv("AWS_ACCESS_KEY_ID")\n                aws_secret_access_key = os.getenv("AWS_SECRET_ACCESS_KEY")\n                endpoint_url = os.getenv("AWS_ENDPOINT_URL")\n                if aws_access_key_id is None:\n                    raise ValueError("AWS_ACCESS_KEY_ID environment variable is not set")\n                if aws_secret_access_key is None:\n                    raise ValueError("AWS_SECRET_ACCESS_KEY environment variable is not set")\n                if endpoint_url is None:\n                    raise ValueError("AWS_ENDPOINT_URL environment variable is not set")\n            except ValueError as excp:\n                parser.error(str(excp))\n            except KeyError as excp:\n                parser.error(str(excp) + " environment variable is not set")\n            ctx.config["Cloud.AWS"] = "True"\n'})}),"\n",(0,o.jsx)(t.p,{children:"When stacking the various layers and attaching them to a specific requirement, the FileLayer is stacked :"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"physical_layer = physical.FileLayer(\n\tnew_context, current_config_path, current_layer_name\n)\nnew_context.add_layer(physical_layer)\n"})}),"\n",(0,o.jsx)(t.p,{children:"Notice that the FileLayer object is created. We need to enhance the FileLayer object in order for it to determine the right resource accessor by looking at the context configuration:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'class FileLayer(interfaces.layers.DataLayerInterface):\n    """a DataLayer backed by a file on the filesystem."""\n\n    def __init__(\n        self,\n        context: interfaces.context.ContextInterface,\n        config_path: str,\n        name: str,\n        metadata: Optional[Dict[str, Any]] = None,\n    ) -> None:\n        super().__init__(\n            context=context, config_path=config_path, name=name, metadata=metadata\n        )\n        if "Cloud.AWS" in self.context.config and not "pdbreader.FileLayer.location" in self.context.config:\n            self._accessor = resources.S3ResourceAccessor()\n\n        elif "Cloud.Google" in self.context.config and not "pdbreader.FileLayer.location" in self.context.config:\n            self._accessor = resources.GCResourceAccessor(self.context)\n\n        else:\n            self._accessor = resources.ResourceAccessor()\n[...]\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Then, we define our custom resource accessors, the current accessors added are supporting AWS/Minio and Google Cloud buckets. Notice the use of s3fs",(0,o.jsx)(t.sup,{children:(0,o.jsx)(t.a,{href:"#user-content-fn-2-a3ad40",id:"user-content-fnref-2-a3ad40","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})," and gcsfs",(0,o.jsx)(t.sup,{children:(0,o.jsx)(t.a,{href:"#user-content-fn-3-a3ad40",id:"user-content-fnref-3-a3ad40","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})," libraries."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:"[...]\nimport s3fs\nimport gcsfs\n[...]\nclass S3ResourceAccessor(object):\n    def __init__(\n        self,\n    ):\n        self.s3 = s3fs.S3FileSystem()\n    def open(self, url: str, mode: str = \"rb\") -> Any:\n        return self.s3.open(url, mode)\n\nclass GCResourceAccessor(object):\n    def __init__(\n        self,\n        context: interfaces.context.ContextInterface,\n    ):\n        self.s3 = gcsfs.GCSFileSystem(project=context.config['Cloud.Google.project_id'], token=context.config['Cloud.Google.application_credentials'])\n    def open(self, url: str, mode: str = \"rb\") -> Any:\n        return self.s3.open(url, mode)\n"})}),"\n",(0,o.jsx)(t.h3,{id:"testing",children:"Testing"}),"\n",(0,o.jsx)(t.p,{children:"It is now time to test the modified framework. Memory images between 1 and 8 gb were used for those tests."}),"\n",(0,o.jsx)(t.h4,{id:"on-premise-minio",children:"On-Premise MIN.IO"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"~\xbb export AWS_ENDPOINT_URL=http://127.0.0.1:9000\n~\xbb export AWS_ACCESS_KEY_ID=user\n~\xbb export AWS_SECRET_ACCESS_KEY=password\n\n~\xbb vol -s3 -f s3://20acf5e8-ab93-42ff-b87a-15065da1016c/Snapshot6.vmem windows.pslist --dump --pid 244\nVolatility 3 Framework 2.4.1\nProgress:  100.00\t\tPDB scanning finished\nPID\tPPID\tImageFileName\tOffset(V)\tThreads\tHandles\tSessionId\tWow64\tCreateTime\tExitTime\tFile output\n\n244\t4\tsmss.exe\t0xfa8002c33b30\t2\t29\tN/A\tFalse\t2020-12-27 06:18:43.000000 \tN/A\tpid.244.0x48080000.dmp\n\n"})}),"\n",(0,o.jsx)(t.h4,{id:"aws-remote-s3-bucket-using-volshell",children:"AWS remote s3 bucket using volshell"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"~\xbb export AWS_ENDPOINT_URL=\"\" # no endpoint url will point to aws by default\n~\xbb export AWS_ACCESS_KEY_ID=REDACTED\n~\xbb export AWS_SECRET_ACCESS_KEY=REDACTED\n\n~\xbb volshell -s3 -f s3://20acf5e8-ab93-42ff-b87a-15065da1016c/Snapshot6.vmem -w\nVolshell (Volatility 3 Framework) 2.5.0\nReadline imported successfully\tPDB scanning finished\n\n    Call help() to see available functions\n\n    Volshell mode        : Windows\n    Current Layer        : layer_name\n    Current Symbol Table : symbol_table_name1\n    Current Kernel Name  : kernel\n\n(layer_name) >>> from volatility3.plugins.windows import pslist\n(layer_name) >>> pslist.PsList.get_requirements()\n(layer_name) >>> display_plugin_output(pslist.PsList, kernel = self.config['kernel'])\nID\tPPID\tImageFileName\tOffset(V)\tThreads\tHandles\tSessionId\tWow64\tCreateTime\tExitTime\tFile output\n4\t0\tSystem\t0xfa80024b3890\t83\t519\tN/A\tFalse\t2020-12-27 06:18:43.000000 \tN/A\tDisabled\n244\t4\tsmss.exe\t0xfa8002c33b30\t2\t29\tN/A\tFalse\t2020-12-27 06:18:43.000000 \tN/A\tDisabled\n332\t324\tcsrss.exe\t0xfa8002e79b30\t9\t562\t0\tFalse\t2020-12-27 06:18:49.000000 \tN/A\tDisabled\n384\t376\tcsrss.exe\t0xfa8003a0f8a0\t10\t171\t1\tFalse\t2020-12-27 06:18:50.000000 \tN/A\tDisabled\n392\t324\twininit.exe\t0xfa8003a12060\t5\t80\t0\tFalse\t2020-12-27 06:18:50.000000 \tN/A\tDisabled\n428\t376\twinlogon.exe\t0xfa8003a31060\t5\t120\t1\tFalse\t2020-12-27 06:18:50.000000 \tN/A\tDisabled\n"})}),"\n",(0,o.jsx)(t.h4,{id:"google-cloud-bucket",children:"Google cloud bucket"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"~\xbb export GOOGLE_PROJECT_ID=REDACTED\n~\xbb export GOOGLE_APPLICATION_CREDENTIALS=/PATH/gcreds.json\n\n~ \xbb vol -gs -f gs://volweb/Snapshot6.vmem windows.dlllist\nVolatility 3 Framework 2.4.1\nProgress:  100.00\t\tPDB scanning finished\nPID\tProcess\tBase\tSize\tName\tPath\tLoadTime\tFile output\n\n244\tsmss.exe\t0x48080000\t0x20000\tsmss.exe\t\\SystemRoot\\System32\\smss.exe\tN/A\tDisabled\n244\tsmss.exe\t0x777e0000\t0x1a9000\tntdll.dll\tC:\\Windows\\SYSTEM32\\ntdll.dll\tN/A\tDisabled\n332\tcsrss.exe\t0x49b80000\t0x6000\tcsrss.exe\tC:\\Windows\\system32\\csrss.exe\tN/A\tDisabled\n332\tcsrss.exe\t0x777e0000\t0x1a9000\tntdll.dll\tC:\\Windows\\SYSTEM32\\ntdll.dll\tN/A\tDisabled\n[...]\n"})}),"\n",(0,o.jsx)(t.h2,{id:"applications",children:"Applications"}),"\n",(0,o.jsx)(t.p,{children:"One can ask what are the potential applications after these new additions to the framework."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Remote investigation: Memory forensics can be performed on object storage without requiring physical access to the device hosting the storage. This allows for remote investigations, making it more convenient and efficient."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Scalability: Object storage over the network offers scalability, allowing the storage capacity to be expanded easily when dealing with large data volumes. This is particularly useful when performing memory forensics on extensive datasets."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Improved Collaboration: By conducting memory forensics on object storage accessible over the network, multiple IT specialists and forensic experts can collaborate on the investigation simultaneously. This promotes knowledge sharing and enhances the chances of identifying critical evidence."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Memory Acquisition at scale : One can script memory acquisition and deploy evidence collection on multiple system by storing the result into an On-Premise solution like Minio or in a cloud solution like AWS."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:'No third party installation : Some people don\'t like to have "agent-base" solutions installed on their assets to perform memory forensics. Once the evidence are acquired, memory forensics will be performed on a dedicated environment.'}),"\n"]}),"\n"]}),"\n",(0,o.jsx)("div",{style:{backgroundColor:"white",alignItems:"center"},children:(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"alt text",src:n(4300).A+"",title:"Arch 3",width:"3845",height:"2592"})})}),"\n",(0,o.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsxs)(t.p,{children:["To conclude, the goal of this addition to the volatility3 framework is to give more capabilities to digital investigators and incident responders when performing memory forensics. The fork of the project implementing this feature is available for you to review the code : ",(0,o.jsx)(t.a,{href:"https://github.com/forensicxlab/volatility3/tree/feature/bucket-s3",children:"https://github.com/forensicxlab/volatility3/tree/feature/bucket-s3"})," ."]}),"\n",(0,o.jsx)(t.p,{children:"Like all solutions, there are downsides to remote memory forensics. Indeed performing remote memory forensics will have an impact on performances and the investigator need to choose wisely about the solution used. However with cloud-computing network performances, network memory forensics can be very efficient. In a futur blogpost, a concrete application of remote memory forensics will be demonstrated by introducing VolWeb 2.0 which is still in development at the time of writing of this article."}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["Do not hesitate to reach me at ",(0,o.jsx)(t.a,{href:"mailto:felix.guyard@forensicxlab.com",children:"felix.guyard@forensicxlab.com"})," to enhance this article or to comment on the integration to the volatility framework."]}),"\n"]}),"\n","\n",(0,o.jsxs)(t.section,{"data-footnotes":!0,className:"footnotes",children:[(0,o.jsx)(t.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{id:"user-content-fn-1-a3ad40",children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://volatility3.readthedocs.io/en/latest/index.html",children:"https://volatility3.readthedocs.io/en/latest/index.html"})," ",(0,o.jsx)(t.a,{href:"#user-content-fnref-1-a3ad40","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{id:"user-content-fn-2-a3ad40",children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://github.com/fsspec/s3fs/",children:"https://github.com/fsspec/s3fs/"})," ",(0,o.jsx)(t.a,{href:"#user-content-fnref-2-a3ad40","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{id:"user-content-fn-3-a3ad40",children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://gcsfs.readthedocs.io/en/latest/#",children:"https://gcsfs.readthedocs.io/en/latest/#"})," ",(0,o.jsx)(t.a,{href:"#user-content-fnref-3-a3ad40","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);