"use strict";(self.webpackChunkexhume=self.webpackChunkexhume||[]).push([[9684],{813:e=>{e.exports=JSON.parse('{"permalink":"/blog/inodes","source":"@site/blog/2022-09-14-inodes/index.md","title":"\ud83d\udce6 Volatility3 Linux Plugin - Inodes","description":"The filesystem is one of the most basic and important concepts in UNIX/Linux. This concept is working around the idea that \u201ceverything is a file\u201d, meaning that the hardware, regular files, directories, sockets, kernel data structures, process communications etc are represented as files with their own types. On a filesystem, a file (whatever its type) is assigned with a number called an \\"inode\\". An inode is an interface between the blocks on the filesystem and the file.","date":"2022-09-14T00:00:00.000Z","tags":[{"inline":true,"label":"DFIR","permalink":"/blog/tags/dfir"},{"inline":true,"label":"Memory Forensics","permalink":"/blog/tags/memory-forensics"},{"inline":true,"label":"VFS","permalink":"/blog/tags/vfs"},{"inline":true,"label":"Inodes","permalink":"/blog/tags/inodes"},{"inline":true,"label":"Linux","permalink":"/blog/tags/linux"}],"readingTime":5.795,"hasTruncateMarker":true,"authors":[{"name":"k1nd0ne","title":"Digital Forensics Spiderman","url":"https://github.com/k1n0ne","page":{"permalink":"/blog/authors/k-1-nd-0-ne"},"socials":{"x":"https://x.com/k1nd0ne","github":"https://github.com/k1nd0ne"},"imageURL":"https://avatars.githubusercontent.com/u/27780432?v=4","key":"k1nd0ne"}],"frontMatter":{"slug":"inodes","title":"\ud83d\udce6 Volatility3 Linux Plugin - Inodes","authors":["k1nd0ne"],"tags":["DFIR","Memory Forensics","VFS","Inodes","Linux"]},"unlisted":false,"prevItem":{"title":"\ud83d\udce6 Volatility3 Windows Plugin - AnyDesk","permalink":"/blog/anydesk"},"nextItem":{"title":"\ud83d\udce6 Volatility3 Windows Plugin - Prefetch","permalink":"/blog/prefetch"}}')},2912:(e,t,i)=>{i.d(t,{A:()=>s});const s=i.p+"assets/images/dentry-aabea27f6ed98d62e9149bddbba10ca0.png"},5868:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var s=i(813),n=i(4848),r=i(8453);const o={slug:"inodes",title:"\ud83d\udce6 Volatility3 Linux Plugin - Inodes",authors:["k1nd0ne"],tags:["DFIR","Memory Forensics","VFS","Inodes","Linux"]},l=void 0,a={authorsImageUrls:[void 0]},c=[{value:"Linux memory analysis",id:"linux-memory-analysis",level:2},{value:"Inode forensics value in memory",id:"inode-forensics-value-in-memory",level:2},{value:"The Volatility3 inode plugin",id:"the-volatility3-inode-plugin",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:['The filesystem is one of the most basic and important concepts in UNIX/Linux. This concept is working around the idea that \u201ceverything is a file\u201d, meaning that the hardware, regular files, directories, sockets, kernel data structures, process communications etc are represented as files with their own types. On a filesystem, a file (whatever its type) is assigned with a number called an "',(0,n.jsx)(t.strong,{children:"inode"}),'". An inode is an interface between the blocks on the filesystem and the file.']}),"\n",(0,n.jsxs)(t.p,{children:["When a process is running, it is interacting with the hardware, the kernel, the user\u2019s resources etc, therefore opening the required files. Linux is keeping track of the opened files inodes in memory by using the ",(0,n.jsx)(t.strong,{children:"Virtual File System"})," (VFS) and more precisely the ",(0,n.jsx)(t.strong,{children:"directory entry cache"})," (dentry). In this article, I will present how you can extract inode metadata from a modern Linux memory image using the volatility3 framework."]}),"\n",(0,n.jsx)(t.h2,{id:"linux-memory-analysis",children:"Linux memory analysis"}),"\n",(0,n.jsxs)(t.p,{children:["When performing memory forensics on a Linux memory image, the fact that a lot of distribution exist is making the memory analysis with volatility3 trickier. Volatility3 is basically trying to identify known structures in memory to create python objects that can be exploited. The framework needs ",(0,n.jsx)(t.strong,{children:"symbol tables"})," to be able to know where to find these structures and how they are defined. For example, to identify the structures inside a x64 Intel based Linux Debian machine memory dump, you'll need:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"To find the kernel debugging symbols generated at compilation time matching the kernel version."}),"\n",(0,n.jsx)(t.li,{children:"Convert the debugging symbols into symbol tables understandable by volatility3."}),"\n",(0,n.jsx)(t.li,{children:"Work with the framework to identify and extract structures from memory and get your artifacts."}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["You can learn more about theses steps here : ",(0,n.jsx)(t.a,{href:"https://volatility3.readthedocs.io/en/latest/symbol-tables.html",children:"https://volatility3.readthedocs.io/en/latest/symbol-tables.html"})]}),"\n",(0,n.jsx)(t.p,{children:'This process is easier for Windows and Mac because there is "one distribution" per OS. However, the fact that a lot of distributions for Linux exists makes this task more difficult.'}),"\n",(0,n.jsx)("div",{style:{backgroundColor:"white",alignItems:"center"},children:(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"alt text",src:i(7190).A+"",title:"Kernel Debugging Symbols",width:"3049",height:"1357"})})}),"\n",(0,n.jsx)(t.h2,{id:"inode-forensics-value-in-memory",children:"Inode forensics value in memory"}),"\n",(0,n.jsxs)(t.p,{children:["If you have ever performed digital forensic on a post-mortem Linux investigation, you may know that the inode structure on disk varies depending on the type of filesystem used. For example, Debian is by default using ",(0,n.jsx)(t.strong,{children:"ext4"})," filesystem whereas Fedora is using ",(0,n.jsx)(t.strong,{children:"XFS"})," and CentOS is using ",(0,n.jsx)(t.strong,{children:"btrfs"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["However, the fact that we are performing our analysis in memory, we are talking about extracting inode objects contained in the ",(0,n.jsx)(t.strong,{children:"directory entry cache"})," (dentry) from the ",(0,n.jsx)(t.strong,{children:"Virtual File System"})," (VFS). The VFS is an abstraction of the filesystem within the kernel which allows coexistence between the different type encountered. The fact that dentries are living in RAM and are never saved to the disk is giving us new useful forensics artifacts that may not be found on a classic \u201cdead system\u201d."]}),"\n",(0,n.jsx)(t.p,{children:"When a process is opening files, it is storing a list of file descriptors. Each file descriptor (fd) is a pointer to a structure containing the dentry cache. We can extract the file inode from this structure and get access to its metadata which are very useful forensics artifacts. We can retrieve the following:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"File size in bytes (i_size)"}),"\n",(0,n.jsx)(t.li,{children:"File permissions (i_mode)"}),"\n",(0,n.jsx)(t.li,{children:"Last modification time (mtime)"}),"\n",(0,n.jsx)(t.li,{children:"Last changed time (ctime)"}),"\n",(0,n.jsx)(t.li,{children:"Last access time (atime)"}),"\n"]}),"\n",(0,n.jsx)("div",{style:{backgroundColor:"white",alignItems:"center"},children:(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"alt text",src:i(2912).A+"",title:"How to get the dentry",width:"2064",height:"678"})})}),"\n",(0,n.jsx)(t.h2,{id:"the-volatility3-inode-plugin",children:"The Volatility3 inode plugin"}),"\n",(0,n.jsx)(t.p,{children:"To be able to extract inode metadata from memory we can identify those major steps:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Go through each process using the ",(0,n.jsx)(t.strong,{children:"pslist"})," plugin."]}),"\n",(0,n.jsxs)(t.li,{children:["For each process, extract the list of file descriptors using code from the ",(0,n.jsx)(t.strong,{children:"lsof"})," plugin."]}),"\n",(0,n.jsx)(t.li,{children:"For each file descriptor, extract the cached dentries, parse the inode metadata and return the result."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"As a result, the plugin is extracting all of the inode metadata needed to help us during our investigation (we like timestamps !)."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"~/work/DFIR/Memory Analysis/MemoryImages/debian 5.10.0-18-amd64 \xbb vol -f Debian\\ XFS.vmem -s symbols linux.inodes\nVolatility 3 Framework 2.0.1\nProgress:  100.00\t\tStacking attempts finished\nPID\tProcess\tInode\tMode\tFile\tLastChange\tLastModify\tLastAccessed\tSize\n...\n2555\tfirefox-esr\t52709413\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/places.sqlite-wal\t2022-09-11 22:05:11.000000 \t2022-09-11 22:05:11.000000 \t2022-09-11 22:05:12.000000 \t2164304\n2555\tfirefox-esr\t34057200\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/storage/permanent/chrome/idb/1451318868ntouromlalnodry--epcr.sqlite-wal\t2022-09-11 22:05:04.000000 \t2022-09-11 22:05:04.000000 \t2022-09-11 22:05:04.000000 \t0\n2555\tfirefox-esr\t52709410\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/places.sqlite\t2022-09-11 22:05:04.000000 \t2022-09-11 22:05:04.000000 \t2022-09-11 22:05:04.000000 \t5242880\n2555\tfirefox-esr\t52709413\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/places.sqlite-wal\t2022-09-11 22:05:11.000000 \t2022-09-11 22:05:11.000000 \t2022-09-11 22:05:12.000000 \t2164304\n2555\tfirefox-esr\t52709411\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/favicons.sqlite\t2022-09-11 22:05:01.000000 \t2022-09-11 22:05:01.000000 \t2022-09-11 22:05:01.000000 \t5242880\n2555\tfirefox-esr\t52709412\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/favicons.sqlite-wal\t2022-09-11 22:05:11.000000 \t2022-09-11 22:05:11.000000 \t2022-09-11 22:05:01.000000 \t1147752\n2555\tfirefox-esr\t52709414\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/content-prefs.sqlite\t2022-09-11 22:05:02.000000 \t2022-09-11 22:05:02.000000 \t2022-09-11 22:05:03.000000 \t229376\n2555\tfirefox-esr\t35077\tsrwxrwxrwx\tsocket:[35077]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t32451\tsrwxrwxrwx\tsocket:[32451]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t32393\tsrwxrwxrwx\tsocket:[32393]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t32457\tsrwxrwxrwx\tsocket:[32457]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t32455\tsrwxrwxrwx\tsocket:[32455]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t32470\tsrwxrwxrwx\tsocket:[32470]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t31746\tsrwxrwxrwx\tsocket:[31746]\t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t1970-01-01 01:00:00.000000 \t0\n2555\tfirefox-esr\t31748\tprw-------\tpipe:[31748]\t2022-09-11 22:05:02.000000 \t2022-09-11 22:05:02.000000 \t2022-09-11 22:05:02.000000 \t0\n2555\tfirefox-esr\t34057193\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/storage/permanent/chrome/idb/3870112724rsegmnoittet-es.sqlite\t2022-09-11 22:05:07.000000 \t2022-09-11 22:05:07.000000 \t2022-09-11 22:05:11.000000 \t507904\n2555\tfirefox-esr\t34057204\t-rw-r--r--\t/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/storage/permanent/chrome/idb/3870112724rsegmnoittet-es.sqlite-wal\t2022-09-11 22:05:07.000000 \t2022-09-11 22:05:07.000000 \t2022-09-11 22:05:07.000000 \t0\n...\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The fact that we have extracted timestamps makes it possible to build the timeline of the events via the integration to the ",(0,n.jsx)(t.strong,{children:"Timeliner"})," plugin."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'~/work/DFIR/Memory Analysis/MemoryImages/debian 5.10.0-18-amd64 \xbb vol -f Debian\\ XFS.vmem -s symbols timeline | more                                                                                              130 \u21b5 k1nd0ne@MacBook-Pro-de-Felix\nVolatility 3 Framework 2.0.1    Running plugin Bash...\n\nPlugin  Description     Created Date    Modified Date   Accessed Date   Changed Date\nBash    2490 (bash): "echo "hello bash history""        2022-09-11 20:04:52.000000      N/A     N/A     N/A\n...\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/extensions/langpack-fr@firefox-esr.mozilla.org.xpi"       N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/doh-rollout@mozilla.org.xpi"     N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/formautofill@mozilla.org.xpi"    N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/pictureinpicture@mozilla.org.xpi"        N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/proxy-failover@mozilla.com.xpi"  N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/screenshots@mozilla.org.xpi"     N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/webcompat@mozilla.org.xpi"       N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\nInodes  Process Privileged Cont (2626) Open "/usr/lib/firefox-esr/browser/extensions/langpack-fr@firefox-esr.mozilla.org.xpi"   N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000\n'})}),"\n",(0,n.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,n.jsxs)(t.p,{children:["To conclude, this plugin is a good way to an in depth understanding of how a Linux kernel is storing files in memory and what are the information you can extract from a Linux memory acquisitions.  This plugin was tested on a Debian with kernel version ",(0,n.jsx)(t.strong,{children:"5.10.0.18-amd64"}),". The plugin is available on the forensicxlab github repository: ",(0,n.jsx)(t.a,{href:"https://github.com/forensicxlab/volatility3_plugins",children:"https://github.com/forensicxlab/volatility3_plugins"}),".\nYou should identify each steps described before in the source code comments.\nDo not hesitate to reach me at ",(0,n.jsx)(t.a,{href:"mailto:felix.guyard@forensicxlab.com",children:"felix.guyard@forensicxlab.com"})," to make this article better, or to make a pull-request on the repository to enhance this plugin."]}),"\n",(0,n.jsx)(t.p,{children:"Happy Hunting!"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://www.kernel.org/doc/html/latest/filesystems/vfs.html",children:"https://www.kernel.org/doc/html/latest/filesystems/vfs.html"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec7.html",children:"http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec7.html"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec6.html",children:"http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec6.html"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://github.com/torvalds/linux",children:"https://github.com/torvalds/linux"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://volatility3.readthedocs.io/en/latest/index.html",children:"https://volatility3.readthedocs.io/en/latest/index.html"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},7190:(e,t,i)=>{i.d(t,{A:()=>s});const s=i.p+"assets/images/KDS-3cca088e2c3199a6ab06592d2d635712.png"},8453:(e,t,i)=>{i.d(t,{R:()=>o,x:()=>l});var s=i(6540);const n={},r=s.createContext(n);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);