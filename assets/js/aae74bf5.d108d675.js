"use strict";(self.webpackChunkexhume=self.webpackChunkexhume||[]).push([[3596],{3445:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/results-d2e8f03149ec9b844ef13b80b131b3f9.png"},3707:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>h});var n=i(5873),r=i(4848),o=i(8453);const s={slug:"prefetch",title:"\ud83d\udce6 Volatility3 Windows Plugin - Prefetch",authors:["k1nd0ne"],tags:["DFIR","Memory Forensics","Prefetch","Windows"]},a=void 0,l={authorsImageUrls:[void 0]},h=[{value:"Windows Prefetch file format",id:"windows-prefetch-file-format",level:2},{value:"Format version:",id:"format-version",level:3},{value:"Signature:",id:"signature",level:3},{value:"Original executable name and hash:",id:"original-executable-name-and-hash",level:3},{value:"The MAM signature:",id:"the-mam-signature",level:3},{value:"Volatility3 Prefetch plugin",id:"volatility3-prefetch-plugin",level:2},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["Windows prefetch files are temporary files stored in the ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.code,{children:"%SystemRoot%\\System\\Prefetch"})})," folder. This memory management feature is keeping track of the frequently running applications on a given system. We can extract some data from those files in order to get useful information for a digital forensic investigation. In this blog article, I will explain how we can use memory forensic to extract prefetch files, parse them and create in the end a volatility3 plugin."]}),"\n",(0,r.jsx)(t.h2,{id:"windows-prefetch-file-format",children:"Windows Prefetch file format"}),"\n",(0,r.jsx)(t.p,{children:"Windows prefetch files are constructed with one file header and multiple sections. In each sections different information can be found in which there can be some interesting valuable forensic artifacts. With the evolution of the Windows versions, prefetch files format changed we will see later those changes and the differences between them. Integers are stored in little-endian order, Strings in UTF-16 little-endian and Timestamp in Windows FILETIME UTC. You can see bellow a representation of a prefetch file header and how the information is stored:"}),"\n",(0,r.jsx)("div",{style:{backgroundColor:"white",alignItems:"center"},children:(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"alt text",src:i(4627).A+"",title:"Prefetch header",width:"786",height:"330"})})}),"\n",(0,r.jsx)(t.h3,{id:"format-version",children:"Format version:"}),"\n",(0,r.jsx)(t.p,{children:"For the different windows versions, the prefetch format version is different:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"17 (0x11) - Windows XP, Windows 2003"}),"\n",(0,r.jsx)(t.li,{children:"23 (0x17) - Windows Vista, Windows 7"}),"\n",(0,r.jsx)(t.li,{children:"26 (0x1a) - Windows 8.1"}),"\n",(0,r.jsx)(t.li,{children:"30 (0x1e) - Windows 10"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"signature",children:"Signature:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"SCCA - Windows XP to Windows 8.1"}),"\n",(0,r.jsx)(t.li,{children:"MAM \u2013 Windows 10/11"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"original-executable-name-and-hash",children:"Original executable name and hash:"}),"\n",(0,r.jsx)(t.p,{children:"The two information are present in the header but are also present in the prefetch filename stored on the disk (ExecutableName.EXE-Hash).pf. The hash is use to differentiate multiple execution of the same executable."}),"\n",(0,r.jsx)(t.p,{children:"Now that we have the header information, we can extract other artifacts from the file information sections."}),"\n",(0,r.jsx)(t.p,{children:"For each different file version, the prefetch file information are not located at the same offset. Here is the interesting information we can find about the executable:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Section A, B, C, and D offset and entries information \u2013 Useful to locate our artifacts"}),"\n",(0,r.jsx)(t.li,{children:"Last Execution - Latest execution time of the executable."}),"\n",(0,r.jsx)(t.li,{children:"Execution Counter \u2013 How many times the executable was run."}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Each of those information are located at different offsets. Depending on the file version, those offsets are not the same. You can find for each version the associated offsets ",(0,r.jsx)(t.a,{href:"https://github.com/libyal/libscca/blob/main/documentation/Windows%20Prefetch%20File%20(PF)%20format.asciidoc",children:"here"})]}),"\n",(0,r.jsx)(t.h3,{id:"the-mam-signature",children:"The MAM signature:"}),"\n",(0,r.jsx)(t.p,{children:"SCCA signature indicates that the file information is stored in plain text whereas the MAM signature indicates a compressed prefetch file. MAM Signature are present in Windows 10 and 11 prefetch files only and needs to be decompressed before it can be read. The compression method used is called XPRESS Huffman which is a Microsoft compression algorithm. We\u2019ll see later the python3 implementation of this algorithm used for the volatility3 plugin."}),"\n",(0,r.jsx)(t.p,{children:"If you are doing forensic on a hard drive, you probably know the Windows Prefetch Parser tool by Eric Zimmermann. However, there is no tool extracting prefetch file artifacts from memory. To this end, we are now going to see the extraction and parsing of prefetch files with volatility3."}),"\n",(0,r.jsx)(t.h2,{id:"volatility3-prefetch-plugin",children:"Volatility3 Prefetch plugin"}),"\n",(0,r.jsx)(t.p,{children:"To be able to extract the prefetch file and parse them from a memory dump, we need to go through theses major steps:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Scan for prefetch files using the \u201cfilescan\u201d plugin;"}),"\n",(0,r.jsx)(t.li,{children:"Dump each prefetch file in a bytearray;"}),"\n",(0,r.jsx)(t.li,{children:"Identify each Prefetch signature and decompress it if necessary (MAM signature);"}),"\n",(0,r.jsx)(t.li,{children:"Parse the Prefetch and extract the interesting artifacts;"}),"\n",(0,r.jsx)(t.li,{children:"Render the result."}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["When developing the plugin, I had to implement the Microsoft's XPRESS Huffman decompression algorithm in python3 to be able to read Windows 1.X prefetch files. I have used the provided Microsoft pseudo code of the algorithm available . The python3 implementation of the algorithm itself is available on the forensicxlab's github : ",(0,r.jsx)(t.a,{href:"https://github.com/forensicxlab/Xpress_LZ77Huffman",children:"https://github.com/forensicxlab/Xpress_LZ77Huffman"})," The volatility plugin is using a derived version of this algorithm, which will return the file even if the PF is incomplete so we can extract information."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"alt text",src:i(3445).A+"",title:"Prefetch header",width:"1210",height:"562"})}),"\n",(0,r.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsxs)(t.p,{children:["The plugin was tested on Windows 7, Windows 8.1 and Windows 10 vmem memory dumps. The plugin code can be found on the forensicxlab's github and will be submitted to the volatility3 community for a potential integration to the framework. You should Identify each steps described before in the source code comments. Do not hesitate to reach me at ",(0,r.jsx)(t.a,{href:"mailto:felix.guyard@forensicxlab.com",children:"felix.guyard@forensicxlab.com"}),", or to make a pull-request on the repository to enhance this plugin or this article."]}),"\n",(0,r.jsx)(t.p,{children:"Happy Hunting!"})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},4627:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/screenshot-e4464d35f4c066cc4d3d266964b3db4a.png"},5873:e=>{e.exports=JSON.parse('{"permalink":"/blog/prefetch","source":"@site/blog/2022-07-27-prefetch/index.md","title":"\ud83d\udce6 Volatility3 Windows Plugin - Prefetch","description":"Windows prefetch files are temporary files stored in the %SystemRoot%\\\\System\\\\Prefetch folder. This memory management feature is keeping track of the frequently running applications on a given system. We can extract some data from those files in order to get useful information for a digital forensic investigation. In this blog article, I will explain how we can use memory forensic to extract prefetch files, parse them and create in the end a volatility3 plugin.","date":"2022-07-27T00:00:00.000Z","tags":[{"inline":true,"label":"DFIR","permalink":"/blog/tags/dfir"},{"inline":true,"label":"Memory Forensics","permalink":"/blog/tags/memory-forensics"},{"inline":true,"label":"Prefetch","permalink":"/blog/tags/prefetch"},{"inline":true,"label":"Windows","permalink":"/blog/tags/windows"}],"readingTime":3.7,"hasTruncateMarker":true,"authors":[{"name":"k1nd0ne","title":"Digital Forensics Spiderman","url":"https://github.com/k1n0ne","page":{"permalink":"/blog/authors/k-1-nd-0-ne"},"socials":{"x":"https://x.com/k1nd0ne","github":"https://github.com/k1nd0ne"},"imageURL":"https://avatars.githubusercontent.com/u/27780432?v=4","key":"k1nd0ne"}],"frontMatter":{"slug":"prefetch","title":"\ud83d\udce6 Volatility3 Windows Plugin - Prefetch","authors":["k1nd0ne"],"tags":["DFIR","Memory Forensics","Prefetch","Windows"]},"unlisted":false,"prevItem":{"title":"\ud83d\udce6 Volatility3 Linux Plugin - Inodes","permalink":"/blog/inodes"},"nextItem":{"title":"\ud83d\udd8b Cyberdefenders - Writeup - Brave","permalink":"/blog/cb-brave"}}')},8453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>a});var n=i(6540);const r={},o=n.createContext(r);function s(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);