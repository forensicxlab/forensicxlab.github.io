"use strict";(self.webpackChunkexhume=self.webpackChunkexhume||[]).push([[4725],{901:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/1-724f00b186f3fc6032dc7c20875e1f64.png"},2048:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var s=n(2634),i=n(4848),r=n(8453);const o={slug:"hibernation",title:"\ud83d\udcd8 Volatility3: Modern Windows Hibernation file analysis",authors:["k1nd0ne"],tags:["DFIR","Volatility","Memory Forensics","Hibernation"]},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"The structure of a modern hibernation file",id:"the-structure-of-a-modern-hibernation-file",level:2},{value:"The file header",id:"the-file-header",level:3},{value:"The compression sets.",id:"the-compression-sets",level:3},{value:"Creating a volatility3 translation layer",id:"creating-a-volatility3-translation-layer",level:2},{value:"Implementation of the different compression algorithms",id:"implementation-of-the-different-compression-algorithms",level:3},{value:"Proof Of Concept",id:"proof-of-concept",level:3},{value:"Usage : Conversion",id:"usage--conversion",level:4},{value:"Example: pslist",id:"example-pslist",level:4},{value:"Example : netscan",id:"example--netscan",level:4},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"In the Digital Forensics ecosystem, the field of memory forensics can help uncover artifacts that can\u2019t be found anywhere else. That can include deleted files, network connections, running processes, rootkits, code injection, fileless malware and many more."}),"\n",(0,i.jsx)(t.p,{children:"Microsoft introduced the hibernation feature in Windows 2000, allowing systems to be powered down while preserving their volatile state. This is achieved by saving RAM contents and processor context to a file called hiberfil.sys before shutting down inside the root folder of the filesystem drive. When the computer is turned on again, the system restores the volatile state from the saved file. Hibernation files are valuable for digital forensic professionals as they store temporary data from RAM to non-volatile storage, eliminating the requirement for specialized tools on the target device."}),"\n",(0,i.jsx)(t.p,{children:"The Hibernation file structure has evolved in time. In this blog post, we will dive into the structure of the modern Windows hibernation file and propose a new translation layer for the volatility3 framework to create a raw memory image from a hibernation file."}),"\n",(0,i.jsx)(t.h2,{id:"the-structure-of-a-modern-hibernation-file",children:"The structure of a modern hibernation file"}),"\n",(0,i.jsx)(t.p,{children:"The structure of the hibernation file can be divided into two variations:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"From Windows XP to Windows 7 (old)"}),"\n",(0,i.jsx)(t.li,{children:"From Windows 8 to Windows 11 (modern)"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The following image represent the modern structure."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"alt text",src:n(901).A+"",title:"Structure",width:"3585",height:"5621"})}),"\n",(0,i.jsxs)(t.p,{children:["In this blog post we will focus on the modern hibernation structure",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-1-602a43",id:"user-content-fnref-1-602a43","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),", though you\u2019ll notice that the underlying principle remains the same which is to compress and store the physical memory pages of the hibernated system in specific data structures called \u201crestoration sets\u201d.\n\u2003"]}),"\n",(0,i.jsx)(t.h3,{id:"the-file-header",children:"The file header"}),"\n",(0,i.jsxs)(t.p,{children:["The hibernation files start with a header called PO_MEMORY_IMAGE. The structure of this header may differ slightly depending on the operating system version, but its definition is publicly available in the kernel's debugging symbols, which is very nice. The vergiliusproject",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-2-602a43",id:"user-content-fnref-2-602a43","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})," gives us a nice description of this structure for each Windows version. Below is an example of the structure of the header."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"alt text",src:n(4249).A+"",title:"Header",width:"1139",height:"1059"})}),"\n",(0,i.jsxs)(t.p,{children:["The signature of the file for an exploitable hibernation file is \u2018",(0,i.jsx)(t.em,{children:"HIBR"}),"\u2019. The \u2018",(0,i.jsx)(t.em,{children:"RSTR"}),"\u2019 signature indicates that the system is resuming from the file, making it apparently useless when this is the case. Valuable forensics artifacts are available like the system time when it was put into the hibernation state."]}),"\n",(0,i.jsxs)(t.p,{children:["Notice the \u201c",(0,i.jsx)(t.strong,{children:"FirstBootRestorePage"}),"\u201d and \u201c",(0,i.jsx)(t.strong,{children:"FirstKernelRestorePage"}),"\u201d attributes. Those values are storing the page number of the first restoration sets. Mutiplying those values by the size of a Windows x64 page (4096) we get the offset of the sections."]}),"\n",(0,i.jsx)(t.p,{children:"Windows currently divide the storage of the memory pages in 2 locations :"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The boot section."}),"\n",(0,i.jsx)(t.li,{children:"The kernel section."}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"You might notice the \u201cSecureRestorePage\u201d section, however this value seems to be always 0 and there is no publicly available explanation on what those pages are used for. It might be used in the future though to encrypt memory pages so only the host machine can decrypt them via its TPM?"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"To know how many pages are stored for each sections the information can be retrieved from specific attributes:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:['"',(0,i.jsx)(t.strong,{children:"NumPagesForLoader"}),'": The number of pages in the "Boot" section']}),"\n",(0,i.jsxs)(t.li,{children:['"',(0,i.jsx)(t.strong,{children:"PerfInfo->KernelPagesProcessed"}),'": The number of pages in the "Kernel" section']}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Unfortunately for us, the attribute storing the location and number of pages for the Kernel section did change with the Windows OS updates. Below is a table tracking those changes."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Windows Versions"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"FirstKernelRestorePage  offset"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"KernelPagesProcessed offset"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 8/8.1"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x68"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x1C8"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 2016 1507-1511"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x70"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x218"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 2016 1607"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x70"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x220"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 2016 1703 - Windows 11 23H2"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x70"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"0x230"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"the-compression-sets",children:"The compression sets."}),"\n",(0,i.jsxs)(t.p,{children:["A restoration set contains multiple ",(0,i.jsx)(t.strong,{children:"compression sets"}),". Each compression set contains a header structure giving information about how many page descriptors it contains, the compression algorithm used and the size of the compressed concatenated pages of the set."]}),"\n",(0,i.jsx)(t.p,{children:"The compression algorithm used can be one the following:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"None: the pages are stored uncompressed"}),"\n",(0,i.jsxs)(t.li,{children:["Xpress: The pages are stored using the Microsoft Xpress LZ77 Algorithm ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-3-602a43",id:"user-content-fnref-3-602a43","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})]}),"\n",(0,i.jsxs)(t.li,{children:["HuffmanXpress: The pages are stored using the Microsoft Xpress LZ77+Huffman Algorithm ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-3-602a43",id:"user-content-fnref-3-602a43-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})," ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-4-602a43",id:"user-content-fnref-4-602a43","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})})]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"All the page descriptors are located after the header and are describing where the pages reside in the decompressed data."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"alt text",src:n(6128).A+"",title:"Structure",width:"3111",height:"2428"})}),"\n",(0,i.jsx)(t.h2,{id:"creating-a-volatility3-translation-layer",children:"Creating a volatility3 translation layer"}),"\n",(0,i.jsx)(t.p,{children:'To be able to read multiple memory image formats, the volatility3 framework is using what\u2019s called \u201cTranslation Layers\u201d.  Each layer in volatility3 focuses on a particular aspect of memory forensics, such as parsing specific data structures, analyzing various kinds of artifacts, or understanding specific evidence formats. The layers can be seen as individual building blocks that can be stacked on top of each other in a specific order to build the right context before extracting data for analysis. As an example, a memory image with the "vmem" format will induce the stacking of the "VmwareLayer" to be able to read such file format and extract memory pages.'}),"\n",(0,i.jsx)(t.p,{children:"In our case, when the framework is requesting several bytes at a specific physical address, it needs to understand the structure of the hibernation file and how to extract the right pages. For this, we have to indicate to the framework for a given memory \u201csegment\u201d, the corresponding set of pages."}),"\n",(0,i.jsx)(t.p,{children:"The Hibernation layer role is to provide the volatility framework with the following information :"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Check the file header to see if the layer needs to be stacked (check the signature to verify it is a hibernation file)"}),"\n",(0,i.jsx)(t.li,{children:"Build a list of segments: A segment is here to translates a given physical address to an offset inside of the uncompressed data of the relevant compression set."}),"\n",(0,i.jsx)(t.li,{children:"Provide the decompression method for a given segment: Our layer needs to be able to decompress a given compression set and returns the number of bytes requested by the upper layer."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"alt text",src:n(7455).A+"",title:"Structure",width:"2854",height:"2402"})}),"\n",(0,i.jsx)(t.h3,{id:"implementation-of-the-different-compression-algorithms",children:"Implementation of the different compression algorithms"}),"\n",(0,i.jsx)(t.p,{children:"Windows is using two proprietary compression algorithms to compress the pages:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Xpress: The Microsoft Xpress LZ77 Decompression Algorithm ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-3-602a43",id:"user-content-fnref-3-602a43-3","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})]}),"\n",(0,i.jsxs)(t.li,{children:["HuffmanXpress: Microsoft Xpress LZ77+Huffman Decompression Algorithm ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-3-602a43",id:"user-content-fnref-3-602a43-4","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})," ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-4-602a43",id:"user-content-fnref-4-602a43-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})})]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Those two algorithms were implemented and added to the volatility3 framework codecs without the needs of using the Windows API via cstruct (making this layer OS independant). Those algorithms are well documented but python3 is not really the best programming language to perform bitwise operations. Thus the developpement of those two algorithm took time to make sure that the decompressed page using our implementation is giving the same result as the native API ",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-5-602a43",id:"user-content-fnref-5-602a43","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"5"})})]}),"\n",(0,i.jsx)(t.h3,{id:"proof-of-concept",children:"Proof Of Concept"}),"\n",(0,i.jsx)(t.p,{children:"After implementing this new translation layer, it was time to test it against multiple hibernation files. Knowing that we need to do a lot of decompressions operations, the hibernation layer is meant to be combine with the \u201clayerwriter\u201d plugin to create a raw memory image and then analyze it with the windows plugins. Indeed, the decompression of a set takes time and most of the plugin need to scan the entire memory dump pages making a lot of decompression operations thus slowing the framework. Creating a raw memory dump first is the best approach here for performances. To this end, 2 new plugins were added to the volatility3 framework:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"windows.hibernation.Info"})," : Display the basic information about the hibernation file and if it seems exploitable."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"windows.hibernation.Dump"})," : Convert the hibernation file into a raw memory dump (based on the layerwriter plugin)"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The generation of the raw memory file was performed on 8 hibernations files from different versions of Windows:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Version / Target"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"hiberfile size"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Conversion time"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 8 x64 / Laptop"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"8GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~30 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 1507 x64 / Laptop"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"8GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~20 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 1607 x64 / Laptop"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"8GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~20 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 1809 x64 / KVM"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"8GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~10 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 1809 x64 / KVM"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"4GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~5 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 22H02 x64 / Laptop"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"8GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~60 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 10 22H02 x64 / Laptop"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"16GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~100 minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Windows 11 23H02 x64 / Laptop"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"8GB"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"~100 minutes"})]})]})]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Note :"})," On Windows 1809 hiberfile from a KVM, it was found that pages were located only in the boot section and none in the kernel section. The compressed data were either using the Xpress LZ77 compression or were not compressed but the Huffman variant was not identified. On Windows 22H2, most of the pages are located inside the kernel section using both plain LZ77 and LZ77+Huffman compression. It is not clear how Microsoft decides which compression algorithm is used and if both sections are used to store the pages."]}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"usage--conversion",children:"Usage : Conversion"}),"\n",(0,i.jsx)(t.p,{children:"Firstly, we check if the hibernation file seems exploitable :"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"~/work/DFIR/volatility3\xbb ./vol.py -f hiberfil_Win10_1507.sys windows.hibernation.Info\nVolatility 3 Framework 2.5.1\nProgress:  100.00               PDB scanning finished\nVariable        Value\nSignature       b'HIBR'\nPageSize        4096\nComment The hibernation file header signature is correct.\nSystem Time     2023-11-03 20:32:25\nFirstBootRestorePage    0x23\nNumPagesForLoader       32199\n"})}),"\n",(0,i.jsx)(t.p,{children:"Next, we can try to convert the hibernation file to a raw file:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"~/work/DFIR/volatility3\xbb ./vol.py -f hiberfil_Win10_1507.sys windows.hibernation.Dump -h\nusage: volatility windows.hibernation.Dump [-h] --version VERSION\n\noptional arguments:\n  -h, --help         show this help message and exit\n  --version VERSION  The Windows version of the hibernation file :\n        0=>[Windows 10 1703 to Windows 11 23H2]\n        1=>[Windows 8/8.1]\n        2=>[Windows 10 1507 to 1511]\n        3=>[Windows 10 1607]\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"~/work/DFIR/volatility3\xbb ./vol.py -f hiberfil_Win10_1507.sys windows.hibernation.Dump --version 2\nStatus\nProgress:   99.99               Writing layer memory_layer\nThe hibernation file was converted to memory_layer.raw\n"})}),"\n",(0,i.jsx)(t.h4,{id:"example-pslist",children:"Example: pslist"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"~/work/DFIR/volatility3\xbb ./vol.py -f memory_layer.raw windows.pslist\nVolatility 3 Framework 2.5.1\nProgress:  100.00\t\tPDB scanning finished\nPID\tPPID\tImageFileName\tOffset(V)\tThreads\tHandles\tSessionId\tWow64\tCreateTime\tExitTime\tFile output\n\n4\t0\tSystem\t0xe5072e280300\t182\t-\tN/A\tFalse\t2023-09-30 14:52:10.000000 \tN/A\tDisabled\n136\t4\tRegistry\t0xe5072e2ee040\t4\t-\tN/A\tFalse\t2023-09-30 14:52:09.000000 \tN/A\tDisabled\n400\t4\tsmss.exe\t0xe507322aa0c0\t3\t-\tN/A\tFalse\t2023-09-30 14:52:10.000000 \tN/A\tDisabled\n532\t484\tcsrss.exe\t0xe50732242140\t13\t-\t0\tFalse\t2023-09-30 14:52:11.000000 \tN/A\tDisabled\n628\t484\twininit.exe\t0xe50734c6a080\t5\t-\t0\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n636\t620\tcsrss.exe\t0xe50734c6f140\t13\t-\t1\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n700\t628\tservices.exe\t0xe50734cf0100\t17\t-\t0\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n708\t628\tlsass.exe\t0xe50734d25080\t9\t-\t0\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n840\t700\tsvchost.exe\t0xe50734d8e280\t29\t-\t0\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n868\t628\tfontdrvhost.ex\t0xe50734db9180\t5\t-\t0\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n932\t700\tsvchost.exe\t0xe50734b25540\t13\t-\t0\tFalse\t2023-09-30 14:52:12.000000 \tN/A\tDisabled\n[TRUNCATED]\n"})}),"\n",(0,i.jsx)(t.h4,{id:"example--netscan",children:"Example : netscan"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"~/work/DFIR/volatility3\xbb ./vol.py -f memory_layer.raw windows.netscan\nVolatility 3 Framework 2.5.1\nProgress:  100.00\t\tPDB scanning finished\nOffset\tProto\tLocalAddr\tLocalPort\tForeignAddr\tForeignPort\tState\tPID\tOwner\tCreated\n\n0xe507320e1b00\tTCPv4\t127.0.0.1\t49743\t127.0.0.1\t49742\tESTABLISHED\t6660\tRiotClientServ\t2023-09-30 14:52:33.000000\n0xe50733c5ba60\tTCPv4\t192.168.122.74\t49883\t8.247.201.124\t443\tESTABLISHED\t6660\tRiotClientServ\t2023-09-30 14:52:38.000000\n0xe50734ab2d00\tTCPv4\t0.0.0.0\t135\t0.0.0.0\t0\tLISTENING\t932\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe50734ab2d00\tTCPv6\t::\t135\t::\t0\tLISTENING\t932\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe50734ab2e50\tTCPv4\t0.0.0.0\t49664\t0.0.0.0\t0\tLISTENING\t628\twininit.exe\t2023-09-30 14:52:12.000000\n0xe50734ab2e50\tTCPv6\t::\t49664\t::\t0\tLISTENING\t628\twininit.exe\t2023-09-30 14:52:12.000000\n0xe50734ab34e0\tTCPv4\t0.0.0.0\t49664\t0.0.0.0\t0\tLISTENING\t628\twininit.exe\t2023-09-30 14:52:12.000000\n0xe50734ab38d0\tTCPv4\t0.0.0.0\t135\t0.0.0.0\t0\tLISTENING\t932\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe50734d624e0\tTCPv4\t192.168.122.74\t49687\t20.223.46.67\t443\tESTABLISHED\t2552\tMsMpEng.exe\t2023-09-30 14:52:17.000000\n0xe5073540a990\tTCPv4\t192.168.122.74\t139\t0.0.0.0\t0\tLISTENING\t4\tSystem\t2023-09-30 14:52:12.000000\n0xe5073540b410\tTCPv4\t0.0.0.0\t49665\t0.0.0.0\t0\tLISTENING\t952\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe5073540b800\tTCPv4\t0.0.0.0\t49666\t0.0.0.0\t0\tLISTENING\t1416\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe5073540c130\tTCPv4\t0.0.0.0\t49666\t0.0.0.0\t0\tLISTENING\t1416\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe5073540c130\tTCPv6\t::\t49666\t::\t0\tLISTENING\t1416\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe5073540c3d0\tTCPv4\t0.0.0.0\t49665\t0.0.0.0\t0\tLISTENING\t952\tsvchost.exe\t2023-09-30 14:52:12.000000\n0xe5073540c3d0\tTCPv6\t::\t49665\t::\t0\tLISTENING\t952\tsvchost.exe\t2023-09-30 14:52:12.000000\n[TRUNCATED]\n"})}),"\n",(0,i.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(t.p,{children:["For all tested files, the framework was able to extract and decompress all of the pages in each restoration sets. The hibernation layer ",(0,i.jsx)(t.strong,{children:"currently only support Windows 8 x64 to Windows 11 23H2 x64 hibernation files"}),". Windows server hibernation analysis was not tested yet but it will come in time. Hopping the forensics community will also test this new addition and give some feedback to improve this layer. You can find the feature here: ",(0,i.jsx)(t.a,{href:"https://github.com/forensicxlab/volatility3/tree/feature/hibernation-layer",children:"https://github.com/forensicxlab/volatility3/tree/feature/hibernation-layer"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"Hoping this article will bring back the interests of the Digital Forensics community to hibernation files which are very valuable when available."}),"\n",(0,i.jsx)(t.p,{children:"Special thanks to Chad Tilbury @chadtilbury who gave me the motivation to dive into this project and the team of researchers behind the Hibernation file structure analysis (Joe T. Sylve, Vico Marziale, Golden G. Richard III)."}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["Do not hesitate to reach me at ",(0,i.jsx)(t.a,{href:"mailto:felix.guyard@forensicxlab.com",children:"felix.guyard@forensicxlab.com"})," to enhance this article or to comment on the integration to the volatility framework."]}),"\n"]}),"\n","\n",(0,i.jsxs)(t.section,{"data-footnotes":!0,className:"footnotes",children:[(0,i.jsx)(t.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{id:"user-content-fn-1-602a43",children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://www.cct.lsu.edu/~golden/Papers/sylvehiber.pdf",children:"https://www.cct.lsu.edu/~golden/Papers/sylvehiber.pdf"})," ",(0,i.jsx)(t.a,{href:"#user-content-fnref-1-602a43","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{id:"user-content-fn-2-602a43",children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://www.vergiliusproject.com/kernels/x64/Windows%2011/Insider%20Preview%20(Jun%202021)/PO_MEMORY_IMAGE",children:"https://www.vergiliusproject.com/kernels/x64/Windows%2011/Insider%20Preview%20(Jun%202021)/PO_MEMORY_IMAGE"})," ",(0,i.jsx)(t.a,{href:"#user-content-fnref-2-602a43","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{id:"user-content-fn-3-602a43",children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-xca/a8b7cb0a-92a6-4187-a23b-5e14273b96f8",children:"https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-xca/a8b7cb0a-92a6-4187-a23b-5e14273b96f8"})," ",(0,i.jsx)(t.a,{href:"#user-content-fnref-3-602a43","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-3-602a43-2","data-footnote-backref":"","aria-label":"Back to reference 3-2",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"2"})]})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-3-602a43-3","data-footnote-backref":"","aria-label":"Back to reference 3-3",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"3"})]})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-3-602a43-4","data-footnote-backref":"","aria-label":"Back to reference 3-4",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"4"})]})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{id:"user-content-fn-4-602a43",children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://raw.githubusercontent.com/Velocidex/go-prefetch/master/lzxpress.go",children:"https://raw.githubusercontent.com/Velocidex/go-prefetch/master/lzxpress.go"})," ",(0,i.jsx)(t.a,{href:"#user-content-fnref-4-602a43","data-footnote-backref":"","aria-label":"Back to reference 4",className:"data-footnote-backref",children:"\u21a9"})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-4-602a43-2","data-footnote-backref":"","aria-label":"Back to reference 4-2",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{id:"user-content-fn-5-602a43",children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/windows/win32/cmpapi/using-the-compression-api",children:"https://learn.microsoft.com/en-us/windows/win32/cmpapi/using-the-compression-api"})," ",(0,i.jsx)(t.a,{href:"#user-content-fnref-5-602a43","data-footnote-backref":"","aria-label":"Back to reference 5",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},2634:e=>{e.exports=JSON.parse('{"permalink":"/blog/hibernation","source":"@site/blog/2023-10-27-hibernation/index.md","title":"\ud83d\udcd8 Volatility3: Modern Windows Hibernation file analysis","description":"In the Digital Forensics ecosystem, the field of memory forensics can help uncover artifacts that can\u2019t be found anywhere else. That can include deleted files, network connections, running processes, rootkits, code injection, fileless malware and many more.","date":"2023-10-27T00:00:00.000Z","tags":[{"inline":true,"label":"DFIR","permalink":"/blog/tags/dfir"},{"inline":true,"label":"Volatility","permalink":"/blog/tags/volatility"},{"inline":true,"label":"Memory Forensics","permalink":"/blog/tags/memory-forensics"},{"inline":true,"label":"Hibernation","permalink":"/blog/tags/hibernation"}],"readingTime":10.655,"hasTruncateMarker":true,"authors":[{"name":"k1nd0ne","title":"Digital Forensics Spiderman","url":"https://github.com/k1n0ne","page":{"permalink":"/blog/authors/k-1-nd-0-ne"},"socials":{"x":"https://x.com/k1nd0ne","github":"https://github.com/k1nd0ne","bluesky":"https://bsky.app/profile/k1nd0ne.bsky.social"},"imageURL":"https://avatars.githubusercontent.com/u/27780432?v=4","key":"k1nd0ne"}],"frontMatter":{"slug":"hibernation","title":"\ud83d\udcd8 Volatility3: Modern Windows Hibernation file analysis","authors":["k1nd0ne"],"tags":["DFIR","Volatility","Memory Forensics","Hibernation"]},"unlisted":false,"prevItem":{"title":"\ud83d\udce6 Volatility3 : Alternate Data Stream Scan","permalink":"/blog/volads"},"nextItem":{"title":"\ud83d\udcd8 Volatility3 - Remote analysis on cloud object-storage.","permalink":"/blog/vols3"}}')},4249:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/2-5829bdfa225b7b984b67e4f53f213111.png"},6128:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/3-29821d9c21906fce8efff01858ec9f6d.png"},7455:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/4-e402600b47ddbcae56e7987da7377cab.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(6540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);